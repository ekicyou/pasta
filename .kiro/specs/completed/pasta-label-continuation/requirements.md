# Requirements Document

## Introduction
pasta DSLにおいて、グローバルシーンを示す「＊」行でシーン名を省略した場合に、同一DSLファイル内で最後に指定されたグローバルシーン名を継続利用する振る舞いを定義する。また、最初の「＊」行でシーン名を省略した場合には、前回のシーン名を参照できないためエラーとして扱うことを明確化する。

## Requirements

### 1. グローバルシーン名継続解決
**Objective:** シーン名を省略した「＊」行で直近のグローバルシーン名を継続利用し、重複シーン定義を簡潔に記述できるようにする。

#### Acceptance Criteria
1. When Pasta DSLパーサーが、同一ファイル内で少なくとも1つの名前付きグローバルシーンをパース済みの状態で、明示的なシーン名を持たない `＊` 行に遭遇した場合、Pasta DSLパーサー shall 現在のグローバルシーン名を最後に名前付けされたグローバルシーンに設定し、そのシーン名の新しいバリアントとして登録する。
2. While シーン名を持たない複数の連続した `＊` 行をパースしている間、Pasta DSLパーサー shall 最後に解決されたグローバルシーン名を維持し、各連続する無名 `＊` 行にそれを適用する。
3. When ローカルシーン `・` が無名 `＊` 継続の直後にパースされた場合、Pasta DSLパーサー shall そのローカルシーンを継続されたグローバルシーン名に関連付ける。
4. When 属性行またはアクション行が無名 `＊` 継続の後に続く場合、Pasta DSLパーサー shall 記憶されたシーン名を変更せずに、それらの行を継続されたグローバルシーンコンテキストに関連付ける。

### 2. シーン名更新のコンテキスト管理
**Objective:** 明示的なシーン名指定時に継続用コンテキストを正しく更新し、以降の省略時利用を一貫させる。

#### Acceptance Criteria
1. When Pasta DSLパーサーが明示的なシーン名を持つ `＊` 行をパースした場合、Pasta DSLパーサー shall 後続の継続のために、最後に使用されたグローバルシーン名コンテキストをその明示的な名前に更新する。
2. While 非シーン行（コメント、属性、アクション、またはローカルシーン）をパースしている間、Pasta DSLパーサー shall 別の名前付き `＊` が出現するまで、最後に使用されたグローバルシーン名コンテキストを保持する。
3. If 新しいDSLファイルがパースされる場合、Pasta DSLパーサー shall そのファイルの最初の行を処理する前に、最後に使用されたグローバルシーン名コンテキストをリセットする。

### 3. 省略シーン名のエラーハンドリング
**Objective:** シーン名未確定の状態での省略を検出し、診断可能なエラーを報告する。

#### Acceptance Criteria
1. If DSLファイルの最初の `＊` 行がシーン名を省略している場合、Pasta DSLパーサー shall 継続のための事前のグローバルシーン名が存在しないことを示すエラーでそのファイルを拒否する。
2. If 同一ファイル内で名前付きグローバルシーンがまだ正常にパースされていない状態で（先行する行がコメント、空白、またはローカルシーンのみの場合を含む）無名 `＊` 行が出現した場合、Pasta DSLパーサー shall 欠落しているグローバルシーンコンテキストを識別するエラーを出力する。
3. When 利用可能なコンテキストなしで無名 `＊` のエラーを出力する場合、Pasta DSLパーサー shall 行番号と、先行する名前付きグローバルシーンの必要性を指定するメッセージを含める。

### 4. 無名「＊」行のフォーマット制約
**Objective:** 無名「＊」行の許容フォーマットを明確化し、曖昧さを排除する。

#### Acceptance Criteria
1. コメントマーカー（`#` または `＃`）shall 無名 `＊` 行では許可されない。`＊` マーカーの後ろのオプショナルな末尾空白以外の文字 shall 構文エラーとして拒否される。
2. コメント行 shall 行がオプショナルな空白の後にコメントマーカー（`#` または `＃`）で始まる場合にのみ認識される。これはDSL文法と一貫している。インラインの末尾コメントはファイル内のどこでも認識されない。
