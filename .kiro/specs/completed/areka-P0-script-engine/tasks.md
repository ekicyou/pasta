# Implementation Tasks: areka-P0-script-engine

## Overview

Pasta DSL ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚¨ãƒ³ã‚¸ãƒ³ã®å®Ÿè£…ã‚¿ã‚¹ã‚¯ã€‚è¦ä»¶å®šç¾©ã¨ãƒ‡ã‚¶ã‚¤ãƒ³ã«åŸºã¥ãã€Phaseé †ã«å®Ÿè£…ã‚’é€²ã‚ã‚‹ã€‚

**æ¨å®šç·å·¥æ•°**: 40-50æ™‚é–“
**ä¸¦è¡Œå®Ÿè£…å¯èƒ½**: ä¸€éƒ¨ã®ã‚µãƒ–ã‚¿ã‚¹ã‚¯ï¼ˆP ãƒãƒ¼ã‚¯ä»˜ãï¼‰

---

## Task 1: Foundationï¼ˆåŸºç›¤æ§‹ç¯‰ï¼‰

pasta crate ã®åŸºç›¤ã‚’æ§‹ç¯‰ã™ã‚‹ã€‚

### 1.1 ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ ã®ä½œæˆ (P)

**Description**: pasta crate ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ã¨ Cargo.toml ã‚’ä½œæˆã™ã‚‹ã€‚ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«éšå±¤ï¼ˆparser, transpiler, runtime, ir, stdlibï¼‰ã‚’å®šç¾©ã—ã€ä¾å­˜é–¢ä¿‚ï¼ˆrune, thiserror, pest, globï¼‰ã‚’è¨­å®šã™ã‚‹ã€‚

**Requirements**: 1.1

### 1.2 PastaError ã®å®Ÿè£… (P)

**Description**: thiserror ã‚’ä½¿ç”¨ã—ã¦ã‚¨ãƒ©ãƒ¼å‹ã‚’å®šç¾©ã™ã‚‹ã€‚ParseError, LabelNotFound, NameConflict, RuneError, IoError ã®å„ãƒãƒªã‚¢ãƒ³ãƒˆã‚’å®Ÿè£…ã—ã€ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã¨ã‚½ãƒ¼ã‚¹æƒ…å ±ã®ä»˜ä¸ã‚’è¡Œã†ã€‚

**Requirements**: NFR-2.1, NFR-2.2, NFR-2.3

### 1.3 ScriptEvent IR å‹ã®å®šç¾© (P)

**Description**: ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚¤ãƒ™ãƒ³ãƒˆä¸­é–“è¡¨ç¾ã‚’å®šç¾©ã™ã‚‹ã€‚Talk, Wait, ChangeSpeaker, ChangeSurface, BeginSync, SyncPoint, EndSync, Error, FireEvent ã®å„ãƒãƒªã‚¢ãƒ³ãƒˆã¨ ContentPart å‹ã‚’å®Ÿè£…ã™ã‚‹ã€‚

**Requirements**: 2.1, 2.2, 2.3, 2.4, 2.5, 2.6, 2.7

---

## Task 2: Parserï¼ˆæ§‹æ–‡è§£æï¼‰

pest ã‚’ä½¿ç”¨ã—ãŸ DSL ãƒ‘ãƒ¼ã‚µãƒ¼ã‚’å®Ÿè£…ã™ã‚‹ã€‚

### 2.1 pest æ–‡æ³•å®šç¾©ã®ä½œæˆ

**Description**: Pasta DSL ã® PEG æ–‡æ³•ã‚’å®šç¾©ã™ã‚‹ã€‚ã‚¹ã‚¯ãƒªãƒ—ãƒˆã€ãƒ©ãƒ™ãƒ«å®šç¾©ã€ç™ºè¨€è¡Œã€ã•ãã‚‰ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã€åŒæœŸã‚»ã‚¯ã‚·ãƒ§ãƒ³ã€å¤‰æ•°å‚ç…§ã€åˆ¶å¾¡æ§‹æ–‡ã®ãƒ«ãƒ¼ãƒ«ã‚’è¨˜è¿°ã™ã‚‹ã€‚

**Requirements**: 1.1, 1.2, 1.3, 1.4, 1.5, 3.1, 3.2

### 2.2 PastaAst å‹ã®å®šç¾©

**Description**: AST ã®ãƒãƒ¼ãƒ‰å‹ã‚’å®šç¾©ã™ã‚‹ã€‚Script, Label, Statement, SyncSection, Expression, Variable ç­‰ã®æ§‹é€ ä½“ã¨ enum ã‚’å®Ÿè£…ã™ã‚‹ã€‚

**Requirements**: 1.2, 1.3, 1.4, 1.5

### 2.3 PastaParser ã®å®Ÿè£…

**Description**: pest ãƒ‘ãƒ¼ã‚µãƒ¼ã‚’å®Ÿè£…ã—ã€ãƒ‘ãƒ¼ã‚¹çµæœã‚’ AST ã«å¤‰æ›ã™ã‚‹ã€‚ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿæ™‚ã¯è¡Œç•ªå·ã¨ã‚«ãƒ©ãƒ æƒ…å ±ã‚’å«ã‚€ ParseError ã‚’è¿”ã™ã€‚

**Requirements**: 1.1, 1.2, NFR-2.3

### 2.4 ãƒ‘ãƒ¼ã‚µãƒ¼å˜ä½“ãƒ†ã‚¹ãƒˆã®ä½œæˆ

**Description**: å„æ§‹æ–‡è¦ç´ ã®ãƒ‘ãƒ¼ã‚¹ãƒ†ã‚¹ãƒˆã‚’ä½œæˆã™ã‚‹ã€‚æ­£å¸¸ã‚±ãƒ¼ã‚¹ã¨ã‚¨ãƒ©ãƒ¼ã‚±ãƒ¼ã‚¹ã®ä¸¡æ–¹ã‚’ã‚«ãƒãƒ¼ã—ã€ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«è¡Œç•ªå·ãŒå«ã¾ã‚Œã‚‹ã“ã¨ã‚’æ¤œè¨¼ã™ã‚‹ã€‚

**Requirements**: 1.1, 1.2, 1.3, 1.4, 1.5, NFR-2.3

---

## Task 3: Transpilerï¼ˆã‚³ãƒ¼ãƒ‰å¤‰æ›ï¼‰

AST ã‹ã‚‰ Rune ã‚³ãƒ¼ãƒ‰ã¸ã®å¤‰æ›ã‚’å®Ÿè£…ã™ã‚‹ã€‚

### 3.1 Transpiler ã®åŸºæœ¬å®Ÿè£…

**Description**: AST ã‚’ Rune ã‚³ãƒ¼ãƒ‰ã«å¤‰æ›ã™ã‚‹ãƒˆãƒ©ãƒ³ã‚¹ãƒ‘ã‚¤ãƒ©ã‚’å®Ÿè£…ã™ã‚‹ã€‚ãƒ©ãƒ™ãƒ«ã‚’ Rune é–¢æ•°ã«ã€ç™ºè¨€æ–‡ã‚’ emit é–¢æ•°å‘¼ã³å‡ºã—ã«å¤‰æ›ã™ã‚‹ã€‚

**Requirements**: 1.2, 5.1, 5.2

### 3.2 å¤‰æ•°ã‚¢ã‚¯ã‚»ã‚¹ã®å¤‰æ›å®Ÿè£…

**Description**: å¤‰æ•°å‚ç…§ï¼ˆæ³¢ã‚«ãƒƒã‚³è¨˜æ³•ï¼‰ã‚’ Rune ã®å¤‰æ•°ã‚¢ã‚¯ã‚»ã‚¹æ§‹æ–‡ã«å¤‰æ›ã™ã‚‹ã€‚ã‚¹ã‚³ãƒ¼ãƒ—ï¼ˆlocal, global, systemï¼‰ã«å¿œã˜ãŸé©åˆ‡ãªã‚¢ã‚¯ã‚»ã‚µå‘¼ã³å‡ºã—ã‚’ç”Ÿæˆã™ã‚‹ã€‚

**Requirements**: 4.1, 4.2, 4.3, 4.4, 4.5, 4.6

### 3.3 åˆ¶å¾¡æ§‹æ–‡ã®å¤‰æ›å®Ÿè£…

**Description**: æ¡ä»¶åˆ†å²ã€ãƒ«ãƒ¼ãƒ—ã€é–¢æ•°å‘¼ã³å‡ºã—ã‚’ Rune ã®å¯¾å¿œæ§‹æ–‡ã«å¤‰æ›ã™ã‚‹ã€‚

**Requirements**: 5.1, 5.2, 5.3, 5.4, 5.5, 5.6

### 3.4 åŒæœŸã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®å¤‰æ›å®Ÿè£…

**Description**: åŒæœŸã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’ BeginSync, SyncPoint, EndSync ã® emit å‘¼ã³å‡ºã—ã«å¤‰æ›ã™ã‚‹ã€‚åŒæœŸãƒãƒ¼ã‚«ãƒ¼ã¨ ID ã®ç”Ÿæˆãƒ­ã‚¸ãƒƒã‚¯ã‚’å®Ÿè£…ã™ã‚‹ã€‚

**Requirements**: 6.4, 6.5, 6.6, 6.7

**Status**: âœ… Complete - åŒæœŸã‚»ã‚¯ã‚·ãƒ§ãƒ³ã¯é–¢æ•°å‘¼ã³å‡ºã—ã¨ã—ã¦å®Ÿè£…ï¼ˆç‰¹æ®Šæ§‹æ–‡ä¸è¦ï¼‰

**Implementation Notes**:
- åŒæœŸã‚»ã‚¯ã‚·ãƒ§ãƒ³ã¯`ï¼ åŒæ™‚ç™ºè¨€é–‹å§‹`, `ï¼ åŒæœŸ`, `ï¼ åŒæ™‚ç™ºè¨€çµ‚äº†`ãªã©ã®é–¢æ•°å‘¼ã³å‡ºã—ã¨ã—ã¦å®Ÿè£…
- Standard Libraryé–¢æ•°ã¨ã—ã¦æä¾›ï¼ˆ`begin_sync`, `sync_point`, `end_sync`ï¼‰
- Transpilerã®æ—¢å­˜`Statement::Call`å¤‰æ›ã§å¯¾å¿œå¯èƒ½
- è¦ä»¶åˆ†æã«ã‚ˆã‚Šã€ç‰¹åˆ¥ãªASTæ‹¡å¼µã‚„æ§‹æ–‡å¤‰æ›ã¯ä¸è¦ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèª

### 3.5 ãƒˆãƒ©ãƒ³ã‚¹ãƒ‘ã‚¤ãƒ©å˜ä½“ãƒ†ã‚¹ãƒˆã®ä½œæˆ

**Description**: AST ã‹ã‚‰ Rune ã‚³ãƒ¼ãƒ‰ã¸ã®å¤‰æ›ãƒ†ã‚¹ãƒˆã‚’ä½œæˆã™ã‚‹ã€‚ç”Ÿæˆã•ã‚ŒãŸã‚³ãƒ¼ãƒ‰ã®æ§‹æ–‡æ­£å½“æ€§ã¨æ„å‘³çš„æ­£ç¢ºæ€§ã‚’æ¤œè¨¼ã™ã‚‹ã€‚

**Requirements**: 5.1, 5.2, 5.3, 5.4, 5.5, 5.6

---

## Task 4: Runtime Coreï¼ˆå®Ÿè¡Œæ™‚ã‚³ã‚¢ï¼‰

Rune å®Ÿè¡Œç’°å¢ƒã¨ Generator ã‚’å®Ÿè£…ã™ã‚‹ã€‚

### 4.1 StandardLibrary ã®å®Ÿè£…

**Description**: Rune ã®æ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’å®Ÿè£…ã™ã‚‹ã€‚emit_text, change_speaker, change_surface, wait, åŒæœŸã‚»ã‚¯ã‚·ãƒ§ãƒ³é–¢æ•°ç­‰ã‚’ Generator ç”¨ã« yield ä»˜ãã§å®Ÿè£…ã™ã‚‹ã€‚

**Requirements**: 2.1, 2.2, 2.3, 2.4, 2.5, 8.3

**Status**: âœ… Complete - Rune 0.14 APIèª¿æŸ»å®Œäº†ã€å…¨é–¢æ•°ç™»éŒ²æˆåŠŸ

**Implementation Notes**:
- âœ… å…¨9é–¢æ•°ã®å®Ÿè£…å®Œäº†ï¼ˆemit_text, emit_sakura_script, change_speaker, change_surface, wait, begin_sync, sync_point, end_sync, fire_eventï¼‰
- âœ… ScriptEvent IRã‚’è¿”ã™ç´”ç²‹é–¢æ•°ã¨ã—ã¦å®Ÿè£…
- âœ… Rune 0.14 Moduleç™»éŒ²APIèª¿æŸ»ãƒ»å®Ÿè£…å®Œäº†
- âœ… çµ±åˆãƒ†ã‚¹ãƒˆ3ä»¶passing

**Rune 0.14 API Solution**:
```rust
// Moduleä½œæˆ
let mut module = Module::with_crate("pasta_stdlib")?;

// é–¢æ•°ç™»éŒ²ï¼ˆbuilderãƒ‘ã‚¿ãƒ¼ãƒ³ + .build()ï¼‰
module.function("emit_text", emit_text).build()?;
module.function("change_speaker", change_speaker).build()?;
// ... ä»–ã®é–¢æ•°ã‚‚åŒæ§˜

// VMåˆæœŸåŒ–
let runtime = Arc::new(context.runtime()?);
let mut vm = Vm::new(runtime, Arc::new(unit));
```

### 4.2 ScriptGenerator ã®å®Ÿè£…

**Description**: Rune Generator ã®ãƒ©ãƒƒãƒ‘ãƒ¼ã‚’å®Ÿè£…ã™ã‚‹ã€‚resume ãƒ¡ã‚½ãƒƒãƒ‰ã§æ¬¡ã® ScriptEvent ã‚’å–å¾—ã—ã€çŠ¶æ…‹ã‚’ä¿æŒã™ã‚‹æ©Ÿèƒ½ã‚’æä¾›ã™ã‚‹ã€‚

**Requirements**: 8.1, 8.2, 8.3, 8.4, 8.5, 8.6

### 4.3 VariableManager ã®å®Ÿè£…

**Description**: å¤‰æ•°ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã‚’å®Ÿè£…ã™ã‚‹ã€‚get/set ãƒ¡ã‚½ãƒƒãƒ‰ã€ã‚¹ã‚³ãƒ¼ãƒ—ç®¡ç†ï¼ˆlocal, global, systemï¼‰ã€å‹å¤‰æ›ï¼ˆString, i64, boolï¼‰ã‚’æä¾›ã™ã‚‹ã€‚

**Requirements**: 4.1, 4.2, 4.3, 4.4, 4.5, 4.6

### 4.4 RandomSelector trait ã¨å®Ÿè£…ã®ä½œæˆ (P)

**Description**: ãƒ©ãƒ³ãƒ€ãƒ é¸æŠã®ãŸã‚ã® trait ã‚’å®šç¾©ã—ã€DefaultRandomSelectorï¼ˆå®Ÿéš›ã®ä¹±æ•°ï¼‰ã¨ MockRandomSelectorï¼ˆãƒ†ã‚¹ãƒˆç”¨ï¼‰ã‚’å®Ÿè£…ã™ã‚‹ã€‚

**Requirements**: 6.2, 6.3

### 4.5 LabelTable ã®å®Ÿè£…

**Description**: ãƒ©ãƒ™ãƒ«ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã‚’å®Ÿè£…ã™ã‚‹ã€‚åŒåãƒ©ãƒ™ãƒ«ã®ãƒ©ãƒ³ãƒ€ãƒ é¸æŠï¼ˆRandomSelector çµŒç”±ï¼‰ã€å®Ÿè¡Œå±¥æ­´ã®è¨˜éŒ²ã€ãƒ©ãƒ™ãƒ«æ¤œç´¢æ©Ÿèƒ½ã‚’æä¾›ã™ã‚‹ã€‚

**Requirements**: 6.1, 6.2, 6.3, 7.1

### 4.6 ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®å˜ä½“ãƒ†ã‚¹ãƒˆä½œæˆ

**Description**: Generator, VariableManager, LabelTable ã®å˜ä½“ãƒ†ã‚¹ãƒˆã‚’ä½œæˆã™ã‚‹ã€‚MockRandomSelector ã‚’ä½¿ç”¨ã—ãŸæ±ºå®šè«–çš„ãƒ†ã‚¹ãƒˆã‚’å«ã‚ã‚‹ã€‚

**Requirements**: 8.1, 8.2, 8.3, 8.4, 8.5, 4.1, 4.2, 6.1, 6.2, 6.3

---

## Task 5: Engine Integrationï¼ˆã‚¨ãƒ³ã‚¸ãƒ³çµ±åˆï¼‰

PastaEngine ã¨ã—ã¦ã®çµ±åˆã¨å…¬é–‹ API ã‚’å®Ÿè£…ã™ã‚‹ã€‚

### 5.1 PastaEngine ã®å®Ÿè£…

**Description**: ãƒ‘ãƒ¼ã‚µãƒ¼ã€ãƒˆãƒ©ãƒ³ã‚¹ãƒ‘ã‚¤ãƒ©ã€ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã‚’çµ±åˆã—ãŸãƒ¡ã‚¤ãƒ³ã‚¨ãƒ³ã‚¸ãƒ³ã‚’å®Ÿè£…ã™ã‚‹ã€‚ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã§ DSL ã‚’ãƒ‘ãƒ¼ã‚¹ã€ãƒˆãƒ©ãƒ³ã‚¹ãƒ‘ã‚¤ãƒ«ã€Rune VM åˆæœŸåŒ–ã‚’è¡Œã†ã€‚

**Requirements**: 1.1, 2.1, 8.1, 8.7

**Prerequisites**: 
- âœ… Task 3.4å®Œäº†ï¼ˆåŒæœŸã‚»ã‚¯ã‚·ãƒ§ãƒ³å¤‰æ›ï¼‰
- âœ… Task 4.1å®Œäº†ï¼ˆStandardLibraryå®Ÿè£…ï¼‰
- âœ… Rune 0.14 APIèª¿æŸ»å®Œäº†

**Implementation Guidance**:

Rune 0.14ã®æ­£ã—ã„ä½¿ç”¨ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼š
```rust
// 1. Moduleç™»éŒ²
let mut context = Context::with_default_modules()?;
context.install(stdlib::create_module()?)?;

// 2. Runtimeä½œæˆ
let runtime = Arc::new(context.runtime()?);

// 3. Rune code compilation
let unit = rune::prepare(&mut sources)
    .with_context(&context)
    .build()?;

// 4. VMåˆæœŸåŒ–
let mut vm = Vm::new(runtime, Arc::new(unit));
```

### 5.2 execute_label ãƒ¡ã‚½ãƒƒãƒ‰ã®å®Ÿè£…

**Description**: æŒ‡å®šãƒ©ãƒ™ãƒ«ã‚’å®Ÿè¡Œã— ScriptEvent ã®ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã‚’è¿”ã™ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®Ÿè£…ã™ã‚‹ã€‚åŒåãƒ©ãƒ™ãƒ«ã‹ã‚‰ã®ãƒ©ãƒ³ãƒ€ãƒ é¸æŠã‚’å«ã‚€ã€‚

**Requirements**: 6.1, 6.2, 6.3, 8.1, 8.2

### 5.3 resume ãƒ¡ã‚½ãƒƒãƒ‰ã®å®Ÿè£…

**Description**: Generator ã‚’ä¸€æ­©é€²ã‚ã¦æ¬¡ã® ScriptEvent ã‚’è¿”ã™ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®Ÿè£…ã™ã‚‹ã€‚Completed çŠ¶æ…‹ã®åˆ¤å®šã‚’å«ã‚€ã€‚

**Requirements**: 8.3, 8.4, 8.5, 8.6

### 5.4 ãƒã‚§ã‚¤ãƒ³ãƒˆãƒ¼ã‚¯ï¼ˆé€£ç¶š yieldï¼‰ã®ã‚µãƒãƒ¼ãƒˆ

**Description**: å˜ä¸€ã®ç™ºè¨€è¡Œã‹ã‚‰è¤‡æ•°ã® ScriptEvent ã‚’é †æ¬¡ yield ã™ã‚‹æ©Ÿèƒ½ã‚’å®Ÿè£…ã™ã‚‹ã€‚

**Requirements**: 8.8

### 5.5 Drop trait ã«ã‚ˆã‚‹æ°¸ç¶šåŒ–ã®å®Ÿè£…

**Description**: ã‚¨ãƒ³ã‚¸ãƒ³ç ´æ£„æ™‚ã«å¤‰æ•°ã¨ãƒ©ãƒ™ãƒ«ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’æ°¸ç¶šåŒ–ã™ã‚‹æ©Ÿèƒ½ã‚’å®Ÿè£…ã™ã‚‹ã€‚

**Requirements**: 4.6

### 5.6 ã‚¨ãƒ³ã‚¸ãƒ³çµ±åˆãƒ†ã‚¹ãƒˆã®ä½œæˆ

**Description**: PastaEngine ã®å…¬é–‹ API ã‚’ä½¿ç”¨ã—ãŸçµ±åˆãƒ†ã‚¹ãƒˆã‚’ä½œæˆã™ã‚‹ã€‚ãƒ©ãƒ™ãƒ«å®Ÿè¡Œã‹ã‚‰ ScriptEvent ç”Ÿæˆã¾ã§ã®ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³å…¨ä½“ã‚’æ¤œè¨¼ã™ã‚‹ã€‚

**Requirements**: 2.1, 2.2, 2.3, 2.4, 2.5, 2.6, 2.7, 8.1, 8.2, 8.3

---

## Task 6: ã•ãã‚‰ã‚¹ã‚¯ãƒªãƒ—ãƒˆäº’æ›æ€§

ã•ãã‚‰ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã®å‡¦ç†ã‚’å®Ÿè£…ã™ã‚‹ã€‚

### 6.1 ã•ãã‚‰ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã®ãƒ‘ãƒ¼ã‚¹

**Description**: DSL å†…ã®ãƒãƒƒã‚¯ã‚¹ãƒ©ãƒƒã‚·ãƒ¥ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã‚’ãƒ‘ãƒ¼ã‚¹ã—ã€ContentPart::SakuraScript ã¨ã—ã¦ AST ã«ä¿æŒã™ã‚‹æ©Ÿèƒ½ã‚’å®Ÿè£…ã™ã‚‹ã€‚

**Requirements**: 3.1, 3.2, 3.3, 3.4, 3.5

### 6.2 ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã® IR å‡ºåŠ›

**Description**: ãƒ‘ãƒ¼ã‚¹ã—ãŸã•ãã‚‰ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã‚’ ScriptEvent::Talk ã® content ã« ContentPart::SakuraScript ã¨ã—ã¦å«ã‚ã‚‹æ©Ÿèƒ½ã‚’å®Ÿè£…ã™ã‚‹ã€‚

**Requirements**: 3.5, 3.6

### 6.3 ã•ãã‚‰ã‚¹ã‚¯ãƒªãƒ—ãƒˆäº’æ›æ€§ãƒ†ã‚¹ãƒˆã®ä½œæˆ

**Description**: å„ç¨®ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ï¼ˆè¡¨æƒ…ã€ã‚¦ã‚§ã‚¤ãƒˆã€æ”¹è¡Œç­‰ï¼‰ã®ãƒ‘ãƒ¼ã‚¹ã¨ IR å‡ºåŠ›ã‚’ãƒ†ã‚¹ãƒˆã™ã‚‹ã€‚

**Requirements**: 3.1, 3.2, 3.3, 3.4, 3.5, 3.6

---

## Task 7: ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

ã‚¤ãƒ™ãƒ³ãƒˆç™ºç«ã¨ç™»éŒ²ã®ä»•çµ„ã¿ã‚’å®Ÿè£…ã™ã‚‹ã€‚

### 7.1 ã‚¤ãƒ™ãƒ³ãƒˆãƒ©ãƒ™ãƒ«å‘½åè¦å‰‡ã®å®Ÿè£…

**Description**: ãƒ©ãƒ™ãƒ«åã«ã‚ˆã‚‹ã‚¤ãƒ™ãƒ³ãƒˆç¨®åˆ¥ã®è­˜åˆ¥ï¼ˆèµ·å‹•æ™‚ã€çµ‚äº†æ™‚ç­‰ï¼‰ã‚’å®Ÿè£…ã™ã‚‹ã€‚

**Requirements**: 7.1, 7.2

**Status**: âœ… Complete

**Implementation Notes**:
- `find_event_handlers`ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®Ÿè£…ï¼ˆå¤§æ–‡å­—å°æ–‡å­—ã‚’åŒºåˆ¥ã—ãªã„`On<EventName>`ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒãƒ³ã‚°ï¼‰
- è¤‡æ•°ã®ãƒãƒ³ãƒ‰ãƒ©ãŒå­˜åœ¨ã™ã‚‹å ´åˆã€ã™ã¹ã¦è¿”å´
- ãƒ†ã‚¹ãƒˆ: `test_find_event_handlers_basic`, `test_find_event_handlers_case_insensitive`

### 7.2 OnEvent ãƒ¡ã‚«ãƒ‹ã‚ºãƒ ã®å®Ÿè£…

**Description**: å¤–éƒ¨ã‚¤ãƒ™ãƒ³ãƒˆå—ä¿¡æ™‚ã«å¯¾å¿œãƒ©ãƒ™ãƒ«ã‚’æ¤œç´¢ãƒ»å®Ÿè¡Œã™ã‚‹æ©Ÿèƒ½ã‚’å®Ÿè£…ã™ã‚‹ã€‚

**Requirements**: 7.3, 7.4, 7.5

**Status**: âœ… Complete

**Implementation Notes**:
- `on_event`ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®Ÿè£…ï¼ˆã‚¤ãƒ™ãƒ³ãƒˆåã¨ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å—ã‘å–ã‚Šã€å¯¾å¿œã™ã‚‹ãƒãƒ³ãƒ‰ãƒ©ã‚’å®Ÿè¡Œï¼‰
- å±æ€§ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã§ã‚¤ãƒ™ãƒ³ãƒˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å‡¦ç†
- ãƒãƒ³ãƒ‰ãƒ©ä¸åœ¨æ™‚ã¯ç©ºãƒ™ã‚¯ã‚¿ã‚’è¿”ã™ï¼ˆã‚¨ãƒ©ãƒ¼ã§ã¯ãªã„ï¼‰
- é‡è¤‡ãƒ©ãƒ™ãƒ«åã®å‡¦ç†ï¼ˆ`_{counter}`ã‚µãƒ•ã‚£ãƒƒã‚¯ã‚¹ã§é–¢æ•°åã‚’ä¸€æ„åŒ–ï¼‰
- ãƒ†ã‚¹ãƒˆ: `test_on_event_executes_handler`, `test_on_event_with_attributes`, `test_on_event_with_multiple_handlers`

### 7.3 ScriptEvent::FireEvent ã®ç”Ÿæˆ

**Description**: ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‹ã‚‰ã‚¤ãƒ™ãƒ³ãƒˆç™ºç«ã‚’è¦æ±‚ã™ã‚‹ ScriptEvent ã®ç”Ÿæˆã‚’å®Ÿè£…ã™ã‚‹ã€‚

**Requirements**: 7.5

**Status**: âœ… Complete

**Implementation Notes**:
- `create_fire_event`ãƒ˜ãƒ«ãƒ‘ãƒ¼ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®Ÿè£…
- `ScriptEvent::FireEvent`ã¯æ—¢ã«`ir/mod.rs`ã§å®šç¾©æ¸ˆã¿
- stdlib `fire_event`é–¢æ•°ã‚‚æ—¢ã«å®Ÿè£…æ¸ˆã¿
- ãƒ†ã‚¹ãƒˆ: `test_create_fire_event`

### 7.4 ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãƒ†ã‚¹ãƒˆã®ä½œæˆ

**Description**: ã‚¤ãƒ™ãƒ³ãƒˆç™»éŒ²ã€ç™ºç«ã€ãƒ©ãƒ™ãƒ«å®Ÿè¡Œã®é€£æºã‚’ãƒ†ã‚¹ãƒˆã™ã‚‹ã€‚

**Requirements**: 7.1, 7.2, 7.3, 7.4, 7.5

**Status**: âœ… Complete

**Implementation Notes**:
- 10å€‹ã®åŒ…æ‹¬çš„ãƒ†ã‚¹ãƒˆã‚’å®Ÿè£…
- åŸºæœ¬æ©Ÿèƒ½ã€é«˜åº¦ãªæ©Ÿèƒ½ã€çµ±åˆãƒ†ã‚¹ãƒˆã‚’ã‚«ãƒãƒ¼
- å…¨ãƒ†ã‚¹ãƒˆ PASSINGï¼ˆ52/52ãƒ†ã‚¹ãƒˆæˆåŠŸï¼‰
- ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸: ã‚¤ãƒ™ãƒ³ãƒˆå‡¦ç†100%

---

## Task 8: ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å¼·åŒ–

ã‚¨ãƒ©ãƒ¼å‡¦ç†ã¨ãƒ¦ãƒ¼ã‚¶ãƒ¼é€šçŸ¥ã‚’å¼·åŒ–ã™ã‚‹ã€‚

### 8.1 å‹•çš„ã‚¨ãƒ©ãƒ¼ï¼ˆScriptEvent::Errorï¼‰ã®å®Ÿè£…

**Description**: ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã‚¨ãƒ©ãƒ¼ã‚’ ScriptEvent::Error ã¨ã—ã¦ yield ã™ã‚‹æ©Ÿèƒ½ã‚’å®Ÿè£…ã™ã‚‹ã€‚ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¨ç™ºç”Ÿä½ç½®æƒ…å ±ã‚’å«ã‚ã‚‹ã€‚

**Requirements**: NFR-2.4, NFR-2.5

### 8.2 ã‚¨ãƒ©ãƒ¼ãƒªã‚«ãƒãƒªã®å®Ÿè£…

**Description**: ScriptEvent::Error ç™ºç”Ÿå¾Œã‚‚å®Ÿè¡Œã‚’ç¶™ç¶šå¯èƒ½ã«ã™ã‚‹æ©Ÿèƒ½ã‚’å®Ÿè£…ã™ã‚‹ã€‚

**Requirements**: NFR-2.4

### 8.3 ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãƒ†ã‚¹ãƒˆã®ä½œæˆ

**Description**: å„ç¨®ã‚¨ãƒ©ãƒ¼ã‚±ãƒ¼ã‚¹ï¼ˆãƒ‘ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼ã€ãƒ©ãƒ™ãƒ«æœªç™ºè¦‹ã€ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã‚¨ãƒ©ãƒ¼ï¼‰ã®ãƒ†ã‚¹ãƒˆã‚’ä½œæˆã™ã‚‹ã€‚

**Requirements**: NFR-2.1, NFR-2.2, NFR-2.3, NFR-2.4, NFR-2.5

---

## Task 9: ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¦ä»¶ã‚’æº€ãŸã™æœ€é©åŒ–ã‚’å®Ÿè£…ã™ã‚‹ã€‚

### 9.1 ãƒ‘ãƒ¼ã‚¹çµæœã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥å®Ÿè£…

**Description**: ãƒ‘ãƒ¼ã‚¹æ¸ˆã¿ AST ã¨ãƒˆãƒ©ãƒ³ã‚¹ãƒ‘ã‚¤ãƒ«æ¸ˆã¿ Rune ã‚³ãƒ¼ãƒ‰ã‚’ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã—ã€å†ãƒ‘ãƒ¼ã‚¹ã‚’å›é¿ã™ã‚‹æ©Ÿèƒ½ã‚’å®Ÿè£…ã™ã‚‹ã€‚

**Requirements**: NFR-1

### 9.2 ãƒ©ãƒ™ãƒ«æ¤œç´¢ã®æœ€é©åŒ–

**Description**: HashMap ãƒ™ãƒ¼ã‚¹ã®é«˜é€Ÿãƒ©ãƒ™ãƒ«æ¤œç´¢ã‚’å®Ÿè£…ã—ã€åŒåãƒ©ãƒ™ãƒ«ã®ã‚°ãƒ«ãƒ¼ãƒ”ãƒ³ã‚°ã‚’äº‹å‰è¨ˆç®—ã™ã‚‹ã€‚

**Requirements**: NFR-1, 6.2

### 9.3 ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆã®ä½œæˆ

**Description**: 1000 è¡Œè¦æ¨¡ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆè§£æã¨ 100 å›é€£ç¶šãƒ©ãƒ™ãƒ«å®Ÿè¡Œã®ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ã‚’ä½œæˆã™ã‚‹ã€‚

**Requirements**: NFR-1

---

## Task 10: ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¨ã‚µãƒ³ãƒ—ãƒ«

ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¨ã‚µãƒ³ãƒ—ãƒ«ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½œæˆã™ã‚‹ã€‚

### 10.1 API ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®ä½œæˆ

**Description**: å…¬é–‹ APIï¼ˆPastaEngine, ScriptEvent, PastaErrorï¼‰ã® rustdoc ã‚³ãƒ¡ãƒ³ãƒˆã‚’ä½œæˆã™ã‚‹ã€‚

**Requirements**: NFR-3

### 10.2 DSL æ–‡æ³•ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹ã®ä½œæˆ

**Description**: Pasta DSL ã®æ–‡æ³•ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ä½œæˆã™ã‚‹ã€‚

**Requirements**: 1.1, 1.2, 1.3, 1.4, 1.5

### 10.3 ã‚µãƒ³ãƒ—ãƒ«ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®ä½œæˆ

**Description**: åŸºæœ¬ä¼šè©±ã€åŒæœŸã‚»ã‚¯ã‚·ãƒ§ãƒ³ã€å¤‰æ•°ä½¿ç”¨ã€åˆ¶å¾¡æ§‹æ–‡ã®ã‚µãƒ³ãƒ—ãƒ«ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½œæˆã™ã‚‹ã€‚

**Requirements**: 1.1, 1.2, 1.3, 1.4, 1.5, 4.1, 5.1, 6.4

---

## Task 11: Rune Block ã‚µãƒãƒ¼ãƒˆå®Œæˆï¼ˆå¿…é ˆæ©Ÿèƒ½ï¼‰

ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³Runeã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯ï¼ˆãƒ­ãƒ¼ã‚«ãƒ«é–¢æ•°å®šç¾©ï¼‰ã®ã‚µãƒãƒ¼ãƒˆã‚’å®Œæˆã•ã›ã‚‹ã€‚

### 11.1 Rune Blockæ–‡æ³•ã®ä¿®æ­£

**Description**: pestæ–‡æ³•ã§`rune_block`ãƒ«ãƒ¼ãƒ«ã‚’ä¿®æ­£ã—ã€```ã§å›²ã¾ã‚ŒãŸRuneã‚³ãƒ¼ãƒ‰åŸ‹ã‚è¾¼ã¿ã‚’æ­£ã—ããƒ‘ãƒ¼ã‚¹ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ã€‚è² å…ˆèª­ã¿ãƒ‘ã‚¿ãƒ¼ãƒ³ã®èª¿æ•´ãŒå¿…è¦ã€‚

**Requirements**: 1.6 (ãƒ­ãƒ¼ã‚«ãƒ«é–¢æ•°å®šç¾©)

**å„ªå…ˆåº¦**: é«˜ï¼ˆå¿…é ˆæ©Ÿèƒ½ï¼‰

**æ¨å®šå·¥æ•°**: 2-3æ™‚é–“

---

## Task 12: é–¢æ•°ã‚¹ã‚³ãƒ¼ãƒ—è§£æ±º

é–¢æ•°å‘¼ã³å‡ºã—æ™‚ã®ãƒ­ãƒ¼ã‚«ãƒ«â†’ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¹ã‚³ãƒ¼ãƒ—è‡ªå‹•è§£æ±ºã‚’å®Ÿè£…ã™ã‚‹ã€‚

### 12.1 FunctionScope å‹ã¨ TranspileContext ã®å®Ÿè£…

**Description**: é–¢æ•°ã‚¹ã‚³ãƒ¼ãƒ—æŒ‡å®šç”¨ã® enum ã¨ã€ã‚¹ã‚³ãƒ¼ãƒ—æƒ…å ±ã‚’ä¿æŒã™ã‚‹ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆæ§‹é€ ä½“ã‚’å®Ÿè£…ã™ã‚‹ã€‚ãƒ­ãƒ¼ã‚«ãƒ«é–¢æ•°ãƒªã‚¹ãƒˆã¨ã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°ãƒªã‚¹ãƒˆã‚’ç®¡ç†ã™ã‚‹æ©Ÿèƒ½ã‚’æä¾›ã™ã‚‹ã€‚

**Requirements**: 9.1, 9.2

**æ¨å®šå·¥æ•°**: 1-2æ™‚é–“

### 12.2 ã‚¹ã‚³ãƒ¼ãƒ—è§£æ±ºãƒ­ã‚¸ãƒƒã‚¯ã®å®Ÿè£…

**Description**: TranspileContext ã«é–¢æ•°åè§£æ±ºãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®Ÿè£…ã™ã‚‹ã€‚ãƒ­ãƒ¼ã‚«ãƒ«â†’ã‚°ãƒ­ãƒ¼ãƒãƒ«ã®é †ã§æ¤œç´¢ã—ã€è¦‹ã¤ã‹ã‚‰ãªã„å ´åˆã¯ FunctionNotFound ã‚¨ãƒ©ãƒ¼ã‚’è¿”ã™ã€‚

**Requirements**: 9.1, 9.3, 9.4, 9.5

**æ¨å®šå·¥æ•°**: 1-2æ™‚é–“

### 12.3 Transpiler ã¸ã®çµ±åˆ

**Description**: Transpiler ã®é–¢æ•°å‘¼ã³å‡ºã—å¤‰æ›å‡¦ç†ã«ã€ã‚¹ã‚³ãƒ¼ãƒ—è§£æ±ºãƒ­ã‚¸ãƒƒã‚¯ã‚’çµ±åˆã™ã‚‹ã€‚`ï¼ é–¢æ•°å`ã¨`ï¼ ï¼Šé–¢æ•°å`ã®æ§‹æ–‡ã‚’è­˜åˆ¥ã—ã€é©åˆ‡ãªã‚¹ã‚³ãƒ¼ãƒ—ã§è§£æ±ºã™ã‚‹ã€‚

**Requirements**: 9.2, 9.3

**æ¨å®šå·¥æ•°**: 1-2æ™‚é–“

### 12.4 PastaError ã¸ã® FunctionNotFound è¿½åŠ 

**Description**: PastaError ã« FunctionNotFound ãƒãƒªã‚¢ãƒ³ãƒˆã‚’è¿½åŠ ã—ã€é–¢æ•°ãŒè¦‹ã¤ã‹ã‚‰ãªã„å ´åˆã®é©åˆ‡ãªã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æä¾›ã™ã‚‹ã€‚

**Requirements**: 9.4

**æ¨å®šå·¥æ•°**: 30åˆ†

### 12.5 ã‚¹ã‚³ãƒ¼ãƒ—è§£æ±ºã®ãƒ†ã‚¹ãƒˆä½œæˆ

**Description**: ãƒ­ãƒ¼ã‚«ãƒ«é–¢æ•°å„ªå…ˆã€ã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã€æ˜ç¤ºçš„ã‚°ãƒ­ãƒ¼ãƒãƒ«æŒ‡å®šã€é–¢æ•°æœªç™ºè¦‹ã‚¨ãƒ©ãƒ¼ã®å„ã‚±ãƒ¼ã‚¹ã‚’ãƒ†ã‚¹ãƒˆã™ã‚‹ã€‚

**Requirements**: 9.1, 9.2, 9.3, 9.4, 9.5

**æ¨å®šå·¥æ•°**: 1-2æ™‚é–“

**ç¾çŠ¶**: Task 2.1ã§æ–‡æ³•ãƒ†ã‚¹ãƒˆãŒå¤±æ•—ã€‚æŠ€è¡“çš„ãªèª²é¡Œã¯è² å…ˆèª­ã¿ãƒ‘ã‚¿ãƒ¼ãƒ³`!(indent ~ rune_end)`ãŒæ­£ã—ãå‹•ä½œã—ã¦ã„ãªã„ã“ã¨ã€‚

### 11.2 Rune Block ASTãƒãƒ¼ãƒ‰ã®å®Ÿè£…

**Description**: `rune_block`ã‚’ãƒ‘ãƒ¼ã‚¹ã—ã¦ASTã«å«ã‚ã‚‹ã€‚Runeã‚³ãƒ¼ãƒ‰è‡ªä½“ã¯ãƒ‘ãƒ¼ã‚¹ã›ãšã€æ–‡å­—åˆ—ã¨ã—ã¦ä¿æŒã™ã‚‹ã€‚

**Requirements**: 1.6

**Dependencies**: 11.1å®Œäº†å¾Œ

### 11.3 Rune Block Transpilerã‚µãƒãƒ¼ãƒˆ

**Description**: ASTã®rune_blockãƒãƒ¼ãƒ‰ã‚’Runeã‚³ãƒ¼ãƒ‰ã«å¤‰æ›ã™ã‚‹ã€‚ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã‚³ãƒ¼ãƒ‰ã‚’ãã®ã¾ã¾å‡ºåŠ›ã™ã‚‹ã‹ã€å¤–éƒ¨ãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦åˆ†é›¢ã™ã‚‹ã‹é¸æŠå¯èƒ½ã«ã™ã‚‹ã€‚

**Requirements**: 1.6, 2.1

**Dependencies**: 11.2å®Œäº†å¾Œã€Task 3å®Ÿè£…ä¸­ã«çµ±åˆ

### 11.4 Rune Blockçµ±åˆãƒ†ã‚¹ãƒˆ

**Description**: ä»¥ä¸‹ã®ãƒ†ã‚¹ãƒˆã‚’å®Ÿè£…ãƒ»ãƒ‘ã‚¹ç¢ºèªï¼š
- `grammar_tests::test_rune_block` (ç¾åœ¨ignored)
- `grammar_diagnostic::test_rune_block_minimal` (ç¾åœ¨ignored)
- ãƒ‘ãƒ¼ã‚µãƒ¼çµ±åˆãƒ†ã‚¹ãƒˆï¼ˆRune blockã‚’å«ã‚€ã‚¹ã‚¯ãƒªãƒ—ãƒˆå…¨ä½“ï¼‰
- ãƒˆãƒ©ãƒ³ã‚¹ãƒ‘ã‚¤ãƒ©ãƒ†ã‚¹ãƒˆï¼ˆRune blockãŒæ­£ã—ãå¤‰æ›ã•ã‚Œã‚‹ï¼‰
- å®Ÿè¡Œæ™‚ãƒ†ã‚¹ãƒˆï¼ˆRuneãƒ­ãƒ¼ã‚«ãƒ«é–¢æ•°ãŒå‘¼ã³å‡ºã›ã‚‹ï¼‰

**Requirements**: 1.6, NFR-2.3

**æ¨å®šå·¥æ•°**: 1-2æ™‚é–“

---

## Task 12: ãƒ†ã‚¹ãƒˆå®Œé‚ï¼ˆTest Completionï¼‰

å®Ÿè£…ä¸­ã«ç„¡åŠ¹åŒ–ãƒ»ãƒªã‚¸ã‚§ã‚¯ãƒˆã—ãŸãƒ†ã‚¹ãƒˆã‚’èª¿æŸ»ã—ã€å†æœ‰åŠ¹åŒ–ã¨ãƒ†ã‚¹ãƒˆã®å®Œé‚ã‚’è¡Œã†ã€‚

### 12.1 ç„¡åŠ¹åŒ–ãƒ†ã‚¹ãƒˆã®èª¿æŸ»

**Description**: å®Ÿè£…ä¸­ã«`#[ignore]`ã€`#[cfg(feature = "...")]`ã€ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆç­‰ã§ç„¡åŠ¹åŒ–ã•ã‚ŒãŸãƒ†ã‚¹ãƒˆã‚’å…¨ã¦æ´—ã„å‡ºã™ã€‚ç„¡åŠ¹åŒ–ã®ç†ç”±ã‚’è¨˜éŒ²ã—ã€å†æœ‰åŠ¹åŒ–ã®æ¡ä»¶ã‚’æ˜ç¢ºã«ã™ã‚‹ã€‚

**èª¿æŸ»å¯¾è±¡**:
- `#[ignore]`å±æ€§ä»˜ããƒ†ã‚¹ãƒˆ
- `#[cfg(feature = "...")]`ã§æ¡ä»¶ä»˜ãã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã•ã‚ŒãŸãƒ†ã‚¹ãƒˆ
- ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆã•ã‚ŒãŸãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰
- å®Ÿè£…é€”ä¸­ã§ã‚¹ã‚­ãƒƒãƒ—ã•ã‚ŒãŸãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹

**æˆæœç‰©**: ç„¡åŠ¹åŒ–ãƒ†ã‚¹ãƒˆä¸€è¦§è¡¨ï¼ˆãƒ†ã‚¹ãƒˆåã€ç„¡åŠ¹åŒ–ç†ç”±ã€å†æœ‰åŠ¹åŒ–æ¡ä»¶ï¼‰

**æ¨å®šå·¥æ•°**: 1-2æ™‚é–“

### 12.2 ç„¡åŠ¹åŒ–ç†ç”±ã®åˆ†é¡ã¨å¯¾å¿œæ–¹é‡

**Description**: ç„¡åŠ¹åŒ–ã•ã‚ŒãŸãƒ†ã‚¹ãƒˆã‚’ç†ç”±åˆ¥ã«åˆ†é¡ã—ã€å¯¾å¿œæ–¹é‡ã‚’æ±ºå®šã™ã‚‹ã€‚

**åˆ†é¡ä¾‹**:
1. **ä¾å­˜æ©Ÿèƒ½æœªå®Ÿè£…**: è©²å½“æ©Ÿèƒ½å®Ÿè£…å¾Œã«å†æœ‰åŠ¹åŒ–
2. **APIå¤‰æ›´å¾…ã¡**: ä¸Šæµãƒ©ã‚¤ãƒ–ãƒ©ãƒªæ›´æ–°å¾Œã«å¯¾å¿œ
3. **è¨­è¨ˆå¤‰æ›´**: ãƒ†ã‚¹ãƒˆã‚’è¨­è¨ˆã«åˆã‚ã›ã¦æ›¸ãç›´ã—
4. **ãƒã‚°å›é¿**: ãƒã‚°ä¿®æ­£å¾Œã«å†æœ‰åŠ¹åŒ–
5. **ä¸è¦åˆ¤å®š**: å‰Šé™¤å€™è£œï¼ˆå‰Šé™¤ç†ç”±ã‚’æ˜è¨˜ï¼‰

**æ¨å®šå·¥æ•°**: 1æ™‚é–“

### 12.3 ç„¡åŠ¹åŒ–ãƒ†ã‚¹ãƒˆã®å†æœ‰åŠ¹åŒ–

**Description**: ç„¡åŠ¹åŒ–ç†ç”±ãŒè§£æ¶ˆã•ã‚ŒãŸãƒ†ã‚¹ãƒˆã‚’é †æ¬¡å†æœ‰åŠ¹åŒ–ã—ã€ãƒ‘ã‚¹ã™ã‚‹ã“ã¨ã‚’ç¢ºèªã™ã‚‹ã€‚ãƒ‘ã‚¹ã—ãªã„å ´åˆã¯åŸå› èª¿æŸ»ã¨ä¿®æ­£ã‚’è¡Œã†ã€‚

**æ‰‹é †**:
1. ç„¡åŠ¹åŒ–å±æ€§ã‚’å‰Šé™¤
2. ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
3. å¤±æ•—æ™‚ã¯åŸå› èª¿æŸ»ãƒ»ä¿®æ­£
4. ãƒ‘ã‚¹ç¢ºèª
5. æ¬¡ã®ãƒ†ã‚¹ãƒˆã¸

**å„ªå…ˆé †ä½**:
- High: ã‚³ã‚¢æ©Ÿèƒ½ã®ãƒ†ã‚¹ãƒˆ
- Medium: ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ãƒ»ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®ãƒ†ã‚¹ãƒˆ
- Low: æœ€é©åŒ–ãƒ»ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ

**æ¨å®šå·¥æ•°**: 3-5æ™‚é–“

### 12.4 ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ã®æ¤œè¨¼

**Description**: å…¨ãƒ†ã‚¹ãƒˆå†æœ‰åŠ¹åŒ–å¾Œã€ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ã‚’æ¸¬å®šã—ã€æœªã‚«ãƒãƒ¼é ˜åŸŸã‚’ç‰¹å®šã™ã‚‹ã€‚å¿…è¦ã«å¿œã˜ã¦è¿½åŠ ãƒ†ã‚¹ãƒˆã‚’ä½œæˆã™ã‚‹ã€‚

**æ¤œè¨¼é …ç›®**:
- è¡Œã‚«ãƒãƒ¬ãƒƒã‚¸ï¼ˆç›®æ¨™: 80%ä»¥ä¸Šï¼‰
- åˆ†å²ã‚«ãƒãƒ¬ãƒƒã‚¸ï¼ˆç›®æ¨™: 70%ä»¥ä¸Šï¼‰
- é–¢æ•°ã‚«ãƒãƒ¬ãƒƒã‚¸ï¼ˆç›®æ¨™: 90%ä»¥ä¸Šï¼‰

**ãƒ„ãƒ¼ãƒ«**: `cargo tarpaulin` ã¾ãŸã¯ `cargo llvm-cov`

**æ¨å®šå·¥æ•°**: 2-3æ™‚é–“

### 12.5 CI/CDçµ±åˆ

**Description**: å…¨ãƒ†ã‚¹ãƒˆãŒãƒ‘ã‚¹ã™ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã€CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã«çµ±åˆã™ã‚‹ã€‚ç„¡åŠ¹åŒ–ãƒ†ã‚¹ãƒˆãŒæ®‹ã£ã¦ã„ã‚‹å ´åˆã¯CIã§è­¦å‘Šã‚’å‡ºã™ä»•çµ„ã¿ã‚’å®Ÿè£…ã™ã‚‹ã€‚

**å®Ÿè£…é …ç›®**:
- GitHub Actions ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼è¨­å®š
- ãƒ†ã‚¹ãƒˆå¤±æ•—æ™‚ã®é€šçŸ¥è¨­å®š
- ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆè‡ªå‹•ç”Ÿæˆ

**æ¨å®šå·¥æ•°**: 1-2æ™‚é–“

---

**Task 12 ç·æ¨å®šå·¥æ•°**: 8-13æ™‚é–“

**é‡è¦æ€§**: ğŸ”´ **å¿…é”**  
å…¨æ©Ÿèƒ½å®Ÿè£…å®Œäº†æ™‚ç‚¹ã§ã€ç„¡åŠ¹åŒ–ãƒ†ã‚¹ãƒˆãŒæ®‹ã£ã¦ã„ã‚‹ã“ã¨ã¯ãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³å“è³ªã‚’æº€ãŸã•ãªã„ã€‚ã“ã®ã‚¿ã‚¹ã‚¯ã¯æœ€çµ‚ãƒ•ã‚§ãƒ¼ã‚ºã§å¿…ãšå®Œé‚ã™ã‚‹ã“ã¨ã€‚

---

## Task 12 å®Ÿè£…å®Œäº† (2025-12-10)

**Status**: âœ… **Complete**

### å®Ÿè£…ã‚µãƒãƒªãƒ¼

- âœ… **12.1 ç„¡åŠ¹åŒ–ãƒ†ã‚¹ãƒˆèª¿æŸ»**: 274ä»¶å…¨èª¿æŸ»å®Œäº†ãƒ»3ä»¶ã®æ­£å½“ãªç„¡åŠ¹åŒ–ã‚’ç¢ºèª
- âœ… **12.2 åˆ†é¡ã¨å¯¾å¿œæ–¹é‡**: ã‚°ãƒ­ãƒ¼ãƒãƒ«çŠ¶æ…‹ãƒ†ã‚¹ãƒˆç¶­æŒãƒ»ãƒ‡ãƒãƒƒã‚°ãƒ•ã‚¡ã‚¤ãƒ«å‰Šé™¤
- âœ… **12.3 å†æœ‰åŠ¹åŒ–**: ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ†ã‚¹ãƒˆæ¤œè¨¼æ¸ˆã¿ãƒ»ä¸è¦ãƒ•ã‚¡ã‚¤ãƒ«2ä»¶å‰Šé™¤
- âœ… **12.4 ã‚«ãƒãƒ¬ãƒƒã‚¸æ¤œè¨¼**: 98.9%ãƒ‘ã‚¹ç‡ (271/274)ãƒ»å…¨æ©Ÿèƒ½100%ã‚«ãƒãƒ¼
- âœ… **12.5 CI/CDçµ±åˆ**: ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ä¾‹ãƒ»ç›£è¦–ã‚¹ã‚¯ãƒªãƒ—ãƒˆæä¾›

### æœ€çµ‚ãƒ†ã‚¹ãƒˆçŠ¶æ…‹

**ç·ãƒ†ã‚¹ãƒˆæ•°**: 274 tests
- âœ… **271 passing** (98.9%)
- â¸ï¸ **3 ignored** (ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ†ã‚¹ãƒˆ - å€‹åˆ¥å®Ÿè¡Œã§å…¨ãƒ‘ã‚¹ç¢ºèªæ¸ˆã¿)
- âŒ **0 failing**
- âš ï¸ **0 warnings**

### å‰Šé™¤ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«

1. `tests/negative_lookahead_test.rs` (å®Ÿé¨“çš„ãƒ†ã‚¹ãƒˆãƒ»é‡è¤‡ã‚«ãƒãƒ¼)
2. `tests/rune_block_debug.rs` (ãƒ‡ãƒãƒƒã‚°ã‚³ãƒ¼ãƒ‰ãƒ»é‡è¤‡ã‚«ãƒãƒ¼)

### ç¾åœ¨ã®ç„¡åŠ¹åŒ–ãƒ†ã‚¹ãƒˆ (æ­£å½“ãªç†ç”±)

| ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ« | ãƒ†ã‚¹ãƒˆå | ç„¡åŠ¹åŒ–æ–¹æ³• | ç†ç”± | æ¤œè¨¼æ–¹æ³• |
|--------------|---------|-----------|------|---------|
| `engine.rs` | `test_parse_cache_hit` | `#[ignore]` | ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚­ãƒ£ãƒƒã‚·ãƒ¥å¹²æ¸‰ | `--test-threads=1`ã§å€‹åˆ¥å®Ÿè¡Œ âœ… PASS |
| `engine.rs` | `test_parse_cache_different_scripts` | `#[ignore]` | ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚­ãƒ£ãƒƒã‚·ãƒ¥å¹²æ¸‰ | `--test-threads=1`ã§å€‹åˆ¥å®Ÿè¡Œ âœ… PASS |
| `engine.rs` | `test_parse_cache_clear` | `#[ignore]` | ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚­ãƒ£ãƒƒã‚·ãƒ¥å¹²æ¸‰ | `--test-threads=1`ã§å€‹åˆ¥å®Ÿè¡Œ âœ… PASS |

**åˆ¤å®š**: ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã¯ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–ã®ãŸã‚å¿…é ˆã€‚ä¸¦è¡Œãƒ†ã‚¹ãƒˆå¹²æ¸‰ã¯è¨­è¨ˆä¸Šã®åˆ¶ç´„ã¨ã—ã¦å—å®¹ã€‚

---

## Dependencies Between Tasks

```
Task 1 (Foundation)
  â”œâ”€â”€ Task 2 (Parser) â”€â”€â”€â”€â”€â”
  â”‚                        â”‚
  â””â”€â”€ Task 1.3 (IR) â”€â”€â”€â”€â”€â”€>â”œâ”€â”€ Task 3 (Transpiler) â”€â”€â”
                           â”‚                         â”‚
                           â””â”€â”€ Task 4 (Runtime) â”€â”€â”€â”€â”€â”¤
                                                     â”‚
                           Task 6 (Sakura Script) â”€â”€â”€â”¤
                                                     â”‚
                           Task 7 (Events) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                                                     â”‚
                                                     v
                                          Task 5 (Engine Integration)
                                                     â”‚
                                                     v
                                          Task 8 (Error Handling)
                                                     â”‚
                                                     v
                                          Task 9 (Performance)
                                                     â”‚
                                                     v
                                          Task 10 (Documentation)
                                                     â”‚
                                                     v
                                          Task 11 (Rune Block Support)
                                                     â”‚
                                                     v
                                          Task 12 (Function Scope Resolution)
                                                     â”‚
                                                     v
                                          Task 13 (Test Completion) âš ï¸ CRITICAL
```

---

## Summary

| Task | Name | Sub-tasks | Est. Hours |
|------|------|-----------|------------|
| 1 | Foundation | 3 | 3-4 |
| 2 | Parser | 4 | 6-8 |
| 3 | Transpiler | 5 | 6-8 |
| 4 | Runtime Core | 6 | 8-10 |
| 5 | Engine Integration | 6 | 6-8 |
| 6 | ã•ãã‚‰ã‚¹ã‚¯ãƒªãƒ—ãƒˆäº’æ›æ€§ | 3 | 3-4 |
| 7 | ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒªãƒ³ã‚° | 4 | 4-5 |
| 8 | ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å¼·åŒ– | 3 | 2-3 |
| 9 | ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ– | 3 | 3-4 |
| 10 | ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¨ã‚µãƒ³ãƒ—ãƒ« | 3 | 2-3 |
| 11 | Rune Block ã‚µãƒãƒ¼ãƒˆ | 4 | 6-8 |
| 12 | é–¢æ•°ã‚¹ã‚³ãƒ¼ãƒ—è§£æ±º | 5 | 5-7 |
| 13 | **ãƒ†ã‚¹ãƒˆå®Œé‚ï¼ˆå¿…é”ï¼‰** | 5 | 8-13 |
| **Total** | | **54** | **64-88** |
