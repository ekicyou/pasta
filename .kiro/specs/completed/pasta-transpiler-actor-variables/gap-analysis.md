# Implementation Gap Analysis: pasta-transpiler-actor-variables

| é …ç›® | å†…å®¹ |
|------|------|
| **Feature** | pasta-transpiler-actor-variables |
| **Analysis Date** | 2025-12-14 |
| **Analyzer** | GitHub Copilot |
| **Status** | Complete |

---

## Analysis Summary

- **ã‚¹ã‚³ãƒ¼ãƒ—**: Pastaãƒˆãƒ©ãƒ³ã‚¹ãƒ‘ã‚¤ãƒ©ãƒ¼ã®3ç®‡æ‰€ã‚’ä¿®æ­£ï¼ˆã‚¢ã‚¯ã‚¿ãƒ¼å¤‰æ•°å‚ç…§ã€useæ–‡ç”Ÿæˆã€pastaé–¢æ•°çŸ­ç¸®å½¢ï¼‰
- **ä¸»ãªèª²é¡Œ**: æ–‡å­—åˆ—ãƒªãƒ†ãƒ©ãƒ«ã‹ã‚‰å¤‰æ•°å‚ç…§ã¸ã®å¤‰æ›ã€3ã¤ã®useæ–‡ã®è¿½åŠ ã€ãƒ‘ã‚¹ä¿®é£¾ã®å‰Šé™¤
- **æ¨å¥¨ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ**: Option Aï¼ˆæ—¢å­˜ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆæ‹¡å¼µï¼‰ - `transpiler/mod.rs`ã®ç›´æ¥ä¿®æ­£
- **è¤‡é›‘åº¦**: Sï¼ˆ1-3æ—¥ï¼‰ - æ˜ç¢ºãªä¿®æ­£ç®‡æ‰€ã€æ—¢å­˜ãƒ‘ã‚¿ãƒ¼ãƒ³ã®è¸è¥²
- **ãƒªã‚¹ã‚¯**: Low - æ—¢çŸ¥ã®æŠ€è¡“ã€æ˜ç¢ºãªã‚¹ã‚³ãƒ¼ãƒ—ã€åŒ…æ‹¬çš„ãªãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆ

---

## 1. Current State Investigation

### 1.1 Key Files and Directory Layout

**Pastaãƒˆãƒ©ãƒ³ã‚¹ãƒ‘ã‚¤ãƒ©ãƒ¼ã®æ§‹é€ **:
```
crates/pasta/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ transpiler/
â”‚   â”‚   â”œâ”€â”€ mod.rs              â† ğŸ¯ ä¸»è¦ä¿®æ­£å¯¾è±¡ï¼ˆPass 1ç”Ÿæˆï¼‰
â”‚   â”‚   â””â”€â”€ label_registry.rs   â† LabelRegistryï¼ˆå¤‰æ›´ä¸è¦ï¼‰
â”‚   â”œâ”€â”€ stdlib/
â”‚   â”‚   â””â”€â”€ mod.rs              â† Actoré–¢æ•°å®šç¾©ï¼ˆå¤‰æ›´ä¸è¦ï¼‰
â”‚   â”œâ”€â”€ ir/
â”‚   â”‚   â””â”€â”€ mod.rs              â† ScriptEventå®šç¾©ï¼ˆå¤‰æ›´ä¸è¦ï¼‰
â”‚   â””â”€â”€ lib.rs
â””â”€â”€ tests/
    â”œâ”€â”€ fixtures/
    â”‚   â”œâ”€â”€ comprehensive_control_flow.rn          â† å‚ç…§å®Ÿè£…
    â”‚   â”œâ”€â”€ comprehensive_control_flow.transpiled.rn â† å†ç”Ÿæˆå¯¾è±¡
    â”‚   â””â”€â”€ test-project/main.rn                   â† ã‚¢ã‚¯ã‚¿ãƒ¼å®šç¾©ä¿®æ­£å¯¾è±¡
    â”œâ”€â”€ transpile_comprehensive_test.rs
    â”œâ”€â”€ rune_compile_test.rs
    â””â”€â”€ actor_assignment_test.rs

**Note**: wintfãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆï¼ˆECSã€DirectCompositionï¼‰ã¨ã¯ç‹¬ç«‹ã—ãŸPasta DSLãƒˆãƒ©ãƒ³ã‚¹ãƒ‘ã‚¤ãƒ©ãƒ¼
```

### 1.2 Reusable Components and Services

**åˆ©ç”¨å¯èƒ½ãªæ—¢å­˜ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ**:

1. **`Transpiler::transpile_statement_to_writer()`** (`mod.rs:334-424`)
   - å½¹å‰²: Statementï¼ˆASTï¼‰ã‚’Runeå‡ºåŠ›ã«å¤‰æ›
   - ä¿®æ­£ç®‡æ‰€: `Statement::Speech` ãƒ–ãƒ©ãƒ³ãƒï¼ˆ346-362è¡Œç›®ï¼‰
   - ç¾åœ¨ã®ãƒ­ã‚¸ãƒƒã‚¯:
     ```rust
     writeln!(writer, "        ctx.actor = \"{}\";", speaker)  // æ–‡å­—åˆ—ãƒªãƒ†ãƒ©ãƒ«
     writeln!(writer, "        yield Actor(\"{}\");", speaker)  // æ–‡å­—åˆ—ãƒªãƒ†ãƒ©ãƒ«
     ```

2. **`Transpiler::transpile_global_label()`** (`mod.rs:259-304`)
   - å½¹å‰²: ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒ©ãƒ™ãƒ«ã‚’ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¨ã—ã¦ç”Ÿæˆ
   - ä¿®æ­£ç®‡æ‰€: 276è¡Œç›®ã®useæ–‡ç”Ÿæˆ
    - ç¾åœ¨ã®ãƒ­ã‚¸ãƒƒã‚¯:
     ```rust
     writeln!(writer, "    use pasta_stdlib::*;")  // 1ã¤ã®ã¿
     ```

3. **`Transpiler::transpile_local_label()`** (`mod.rs:306-332`)
   - å½¹å‰²: ãƒ­ãƒ¼ã‚«ãƒ«ãƒ©ãƒ™ãƒ«ã‚’é–¢æ•°ã¨ã—ã¦ç”Ÿæˆ
   - ä¿®æ­£ç®‡æ‰€: ãªã—ï¼ˆãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å†…é–¢æ•°ã®ãŸã‚useæ–‡ä¸è¦ï¼‰4. **`pasta_stdlib::actor_event(name: String)`** (`stdlib/mod.rs:108-110`)
   - å½¹å‰²: `ScriptEvent::ChangeSpeaker { name }` ã‚’è¿”ã™Rusté–¢æ•°
   - å¤‰æ›´ä¸è¦: Runeå´ã‹ã‚‰ `Actor(name)` ã¨ã—ã¦å‘¼ã³å‡ºã•ã‚Œã‚‹

### 1.3 Dominant Architecture Patterns

**ãƒˆãƒ©ãƒ³ã‚¹ãƒ‘ã‚¤ãƒ©ãƒ¼ã®ãƒ‘ã‚¿ãƒ¼ãƒ³**:
- **Two-Pass Architecture**: Pass 1ï¼ˆãƒ©ãƒ™ãƒ«ç”Ÿæˆï¼‰+ Pass 2ï¼ˆãƒ©ãƒ™ãƒ«ã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼ç”Ÿæˆï¼‰
- **String-based Code Generation**: `std::io::Write` ã‚’ä½¿ã£ãŸãƒ†ã‚­ã‚¹ãƒˆå‡ºåŠ›
- **Registry Pattern**: `LabelRegistry` ã§ãƒ©ãƒ™ãƒ«æƒ…å ±ã‚’ä¸€å…ƒç®¡ç†
- **Context Propagation**: `TranspileContext` ã§ã‚¹ã‚³ãƒ¼ãƒ—æƒ…å ±ã‚’ä¼æ’­

**å‘½åè¦å‰‡**:
- ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å: `ãƒ©ãƒ™ãƒ«å_N` (N=ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼)
- é–¢æ•°å: `__start__`, `ãƒ­ãƒ¼ã‚«ãƒ«ãƒ©ãƒ™ãƒ«_N`
- ã‚µãƒ‹ã‚¿ã‚¤ã‚º: æ—¥æœ¬èªè­˜åˆ¥å­ã‚’ãã®ã¾ã¾ä½¿ç”¨ï¼ˆRuneå¯¾å¿œï¼‰

### 1.4 Integration Surfaces

**Rune VM Integration**:
- `pasta_stdlib` ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«: Rusté–¢æ•°ã‚’Rune VMã«ç™»éŒ²
- `Actor(name)` é–¢æ•°: `name: String` ã‚’å—ã‘å–ã‚Š `ScriptEvent::ChangeSpeaker` ã‚’è¿”ã™
- `Talk(text)` é–¢æ•°: `text: String` ã‚’å—ã‘å–ã‚Š `ScriptEvent::Talk` ã‚’è¿”ã™

**main.rn Integration**:
- ã‚¢ã‚¯ã‚¿ãƒ¼å®šç¾©ã¯ `main.rn` ã«æ‰‹å‹•é…ç½®ï¼ˆãƒˆãƒ©ãƒ³ã‚¹ãƒ‘ã‚¤ãƒ©ãƒ¼ã¯ç”Ÿæˆã—ãªã„ï¼‰
- æœŸå¾…ã•ã‚Œã‚‹æ§‹é€ :
  ```rune
  pub mod actors {
      pub const ã•ãã‚‰ = #{ name: "ã•ãã‚‰", id: "sakura" };
  }
  ```

---

## 2. Requirements Feasibility Analysis

### 2.1 Technical Needs from Requirements

| Requirement | Technical Need | Existing Asset | Gap Status |
|-------------|---------------|----------------|------------|
| **Req 1**: ã‚¢ã‚¯ã‚¿ãƒ¼å¤‰æ•°å‚ç…§ | `ctx.actor = ã•ãã‚‰;` å‡ºåŠ› | `transpile_statement_to_writer()` | âœ… Extend (353è¡Œç›®) |
| **Req 2**: Actor ã‚¤ãƒ™ãƒ³ãƒˆç”Ÿæˆ | `yield Actor(ctx.actor.name);` å‡ºåŠ› | `transpile_statement_to_writer()` | âœ… Extend (355è¡Œç›®) |
| **Req 3**: useæ–‡ç”Ÿæˆ | 3ã¤ã®useæ–‡å‡ºåŠ› | `transpile_global_label()` | âœ… Extend (276è¡Œç›®ç›´å¾Œ) |
| **Req 4**: pastaé–¢æ•°çŸ­ç¸®å½¢ | `call(...)` / `jump(...)` å‡ºåŠ› | `transpile_statement_to_writer()` | âœ… Extend (375, 390è¡Œç›®) |
| **Req 5**: ãƒ†ã‚¹ãƒˆæ¤œè¨¼ | ç”Ÿæˆã‚³ãƒ¼ãƒ‰æ¤œè¨¼ãƒ‘ã‚¿ãƒ¼ãƒ³ | `transpile_comprehensive_test.rs` | âœ… Update |
| **Req 6**: (å‰Šé™¤æ¸ˆã¿) | - | - | - |

### 2.2 Missing Capabilities

**Missing**: ãªã—ï¼ˆå…¨ã¦ã®æ©Ÿèƒ½ãŒæ—¢å­˜ã‚³ãƒ¼ãƒ‰ã®æ‹¡å¼µã§å®Ÿç¾å¯èƒ½ï¼‰

### 2.3 Unknowns and Research Needs

**Research Needed**: ãªã—ï¼ˆå…¨ã¦ã®æŠ€è¡“è¦ç´ ãŒæ—¢çŸ¥ï¼‰

### 2.4 Constraints from Existing Architecture

**åˆ¶ç´„äº‹é …**:
1. **Two-Pass Structure**: Pass 1ã®ã¿ã‚’ä¿®æ­£ï¼ˆPass 2ã¯å½±éŸ¿ãªã—ï¼‰
2. **String-based Generation**: ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚¨ãƒ³ã‚¸ãƒ³ä¸ä½¿ç”¨ã€ç›´æ¥æ–‡å­—åˆ—å‡ºåŠ›
3. **Actor Definition Manual**: `main.rn` ã®ã‚¢ã‚¯ã‚¿ãƒ¼å®šç¾©ã¯æ‰‹å‹•ç®¡ç†ï¼ˆè‡ªå‹•ç”Ÿæˆã—ãªã„ï¼‰
4. **Test Fixture Updates**: å‚ç…§å®Ÿè£…ã¨ã®æ•´åˆæ€§ç¶­æŒãŒå¿…è¦

### 2.5 Non-Functional Requirements

| NFR | Current State | Feasibility |
|-----|---------------|-------------|
| **Performance** | æ–‡å­—åˆ—ç”Ÿæˆã®ã¿ | âœ… å½±éŸ¿ãªã— |
| **Backward Compatibility** | æ–°å½¢å¼ã®ã¿å¯¾å¿œ | âœ… è¦ä»¶ã«æ˜è¨˜æ¸ˆã¿ |
| **Security** | N/A | - |
| **Reliability** | 268ãƒ†ã‚¹ãƒˆå­˜åœ¨ | âœ… ãƒ†ã‚¹ãƒˆæ›´æ–°ã§ä¿è¨¼ |

---

## 3. Implementation Approach Options

### Option A: Extend Existing Components (æ¨å¥¨)

**æ¦‚è¦**: `transpiler/mod.rs` ã®3ã¤ã®é–¢æ•°ã‚’ç›´æ¥ä¿®æ­£

#### ä¿®æ­£å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«

**1. `transpile_statement_to_writer()` (334-424è¡Œç›®)**

ä¿®æ­£ç®‡æ‰€1ï¼ˆ353è¡Œç›®ï¼‰:
```rust
// ç¾åœ¨
writeln!(writer, "        ctx.actor = \"{}\";", speaker)

// ä¿®æ­£å¾Œ
writeln!(writer, "        ctx.actor = {};", speaker)  // ãƒ€ãƒ–ãƒ«ã‚¯ã‚©ãƒ¼ãƒˆå‰Šé™¤
```

ä¿®æ­£ç®‡æ‰€2ï¼ˆ355è¡Œç›®ï¼‰:
```rust
// ç¾åœ¨
writeln!(writer, "        yield Actor(\"{}\");", speaker)

// ä¿®æ­£å¾Œ
writeln!(writer, "        yield Actor(ctx.actor.name);")  // å›ºå®šæ–‡å­—åˆ—
```

ä¿®æ­£ç®‡æ‰€3ï¼ˆ375è¡Œç›®ï¼‰:
```rust
// ç¾åœ¨
"        for a in crate::pasta::call(ctx, \"{}\", {}, [{}]) {{ yield a; }}"

// ä¿®æ­£å¾Œ
"        for a in call(ctx, \"{}\", {}, [{}]) {{ yield a; }}"  // crate::pasta:: å‰Šé™¤
```

ä¿®æ­£ç®‡æ‰€4ï¼ˆ390è¡Œç›®ï¼‰:
```rust
// ç¾åœ¨
"        for a in crate::pasta::jump(ctx, \"{}\", {}, []) {{ yield a; }}"

// ä¿®æ­£å¾Œ
"        for a in jump(ctx, \"{}\", {}, []) {{ yield a; }}"  // crate::pasta:: å‰Šé™¤
```

**2. `transpile_global_label()` (259-304è¡Œç›®)**

ä¿®æ­£ç®‡æ‰€ï¼ˆ276è¡Œç›®ç›´å¾Œï¼‰:
```rust
// ç¾åœ¨
writeln!(writer, "    use pasta_stdlib::*;")

// ä¿®æ­£å¾Œ
writeln!(writer, "    use pasta::*;")?;
writeln!(writer, "    use pasta_stdlib::*;")?;
writeln!(writer, "    use crate::actors::*;")
```

**3. `transpile_local_label()` (306-332è¡Œç›®)**

ä¿®æ­£ä¸è¦:
- ãƒ­ãƒ¼ã‚«ãƒ«ãƒ©ãƒ™ãƒ«ã¯åŒã˜ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å†…ã®é–¢æ•°ã¨ã—ã¦ç”Ÿæˆ
- ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒ¬ãƒ™ãƒ«ã®useæ–‡ã‚’ç¶™æ‰¿ã™ã‚‹ãŸã‚ã€å€‹åˆ¥ã®useæ–‡ç”Ÿæˆã¯ä¸è¦
- ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒ©ãƒ™ãƒ«ã®useæ–‡ã§ååˆ†

#### äº’æ›æ€§è©•ä¾¡

**âœ… å¾Œæ–¹äº’æ›æ€§**: è¦ä»¶ã«ã‚ˆã‚Šæ–°å½¢å¼ã®ã¿å¯¾å¿œï¼ˆå¤ã„å½¢å¼ã¯å»ƒæ­¢ï¼‰

**âœ… æ¶ˆè²»è€…ã¸ã®å½±éŸ¿ãªã—**:
- ãƒˆãƒ©ãƒ³ã‚¹ãƒ‘ã‚¤ãƒ©ãƒ¼ã®å‡ºåŠ›å½¢å¼å¤‰æ›´ã®ã¿
- Rust APIã¯ä¸å¤‰ï¼ˆ`Transpiler::transpile_to_string()`ï¼‰

**âœ… ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸**:
- æ—¢å­˜ãƒ†ã‚¹ãƒˆ: 268ãƒ†ã‚¹ãƒˆï¼ˆå…¨ã¦æ›´æ–°å¯¾è±¡ï¼‰
- ä¸»è¦ãƒ†ã‚¹ãƒˆ: `transpile_comprehensive_test.rs`, `rune_compile_test.rs`

#### è¤‡é›‘åº¦ã¨ä¿å®ˆæ€§

**âœ… èªçŸ¥è² è·**: ä½
- æ—¢å­˜ã‚³ãƒ¼ãƒ‰ã®å°è¦æ¨¡ä¿®æ­£ï¼ˆ5ç®‡æ‰€ã€åˆè¨ˆ10è¡Œæœªæº€ï¼‰
- æ—¢å­˜ãƒ‘ã‚¿ãƒ¼ãƒ³ã®è¸è¥²

**âœ… å˜ä¸€è²¬ä»»åŸå‰‡**: ç¶­æŒ
- ãƒˆãƒ©ãƒ³ã‚¹ãƒ‘ã‚¤ãƒ©ãƒ¼ã®è²¬å‹™ã¯ä¸å¤‰ï¼ˆASTâ†’Runeã‚³ãƒ¼ãƒ‰å¤‰æ›ï¼‰

**âœ… ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚º**: å•é¡Œãªã—
- `mod.rs` ã¯904è¡Œï¼ˆä¿®æ­£å¾Œã‚‚910è¡Œç¨‹åº¦ï¼‰

#### Trade-offs

| é …ç›® | è©•ä¾¡ |
|------|------|
| âœ… æœ€å°é™ã®æ–°è¦ãƒ•ã‚¡ã‚¤ãƒ« | å¤‰æ›´ä¸è¦ |
| âœ… æ—¢å­˜ãƒ‘ã‚¿ãƒ¼ãƒ³æ´»ç”¨ | Two-Passæ§‹é€ ç¶­æŒ |
| âœ… è¿…é€ŸãªåˆæœŸé–‹ç™º | æ˜ç¢ºãªä¿®æ­£ç®‡æ‰€ |
| âŒ æ—¢å­˜ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆè‚¥å¤§åŒ– | ãƒªã‚¹ã‚¯ãªã—ï¼ˆ10è¡Œæœªæº€ã®è¿½åŠ ï¼‰ |
| âŒ æ—¢å­˜ãƒ­ã‚¸ãƒƒã‚¯ã®è¤‡é›‘åŒ– | ãƒªã‚¹ã‚¯ãªã—ï¼ˆå˜ç´”ãªæ–‡å­—åˆ—ç½®æ›ï¼‰ |

---

### Option B: Create New Components

**è©•ä¾¡**: ä¸æ¡ç”¨

**ç†ç”±**:
- æ–°è¦ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆä½œæˆã®æ­£å½“æ€§ãŒãªã„ï¼ˆæ©Ÿèƒ½ã¯æ—¢å­˜é–¢æ•°ã®å°ä¿®æ­£ã§å®Ÿç¾å¯èƒ½ï¼‰
- æ—¢å­˜ã® `transpile_statement_to_writer()` ã¯è¤‡é›‘åŒ–ã—ã¦ã„ãªã„ï¼ˆ424è¡Œã€æ˜ç¢ºãªæ§‹é€ ï¼‰
- æ–°è¦ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ä½œæˆã«ã‚ˆã‚‹ã‚ªãƒ¼ãƒãƒ¼ãƒ˜ãƒƒãƒ‰ï¼ˆã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹è¨­è¨ˆã€çµ±åˆãƒ†ã‚¹ãƒˆï¼‰ãŒä¸è¦

---

### Option C: Hybrid Approach

**è©•ä¾¡**: ä¸æ¡ç”¨

**ç†ç”±**:
- æœ¬æ©Ÿèƒ½ã¯å˜ç´”ãªä¿®æ­£ã§ã‚ã‚Šã€æ®µéšçš„ãªå®Ÿè£…ã¯ä¸è¦
- ãƒ•ã‚£ãƒ¼ãƒãƒ£ãƒ¼ãƒ•ãƒ©ã‚°ã¯è¦ä»¶ã§æ˜ç¤ºçš„ã«é™¤å¤–æ¸ˆã¿
- ãƒªã‚¹ã‚¯ãŒä½ã„ãŸã‚ã€ã‚¤ãƒ³ã‚¯ãƒªãƒ¡ãƒ³ã‚¿ãƒ«ãƒ­ãƒ¼ãƒ«ã‚¢ã‚¦ãƒˆã¯éå‰°

---

## 4. Implementation Complexity & Risk

### 4.1 Effort Estimation

**Size**: S (1-3æ—¥)

**æ ¹æ‹ **:
- ä¿®æ­£ç®‡æ‰€: 5ç®‡æ‰€ï¼ˆå„1-2è¡Œã€åˆè¨ˆ10è¡Œæœªæº€ï¼‰
- ãƒ†ã‚¹ãƒˆæ›´æ–°: ç´„10ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆæ¤œè¨¼ãƒ‘ã‚¿ãƒ¼ãƒ³ã®æ›´æ–°ï¼‰
- ãƒ•ã‚£ã‚¯ã‚¹ãƒãƒ£å†ç”Ÿæˆ: 2ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ`comprehensive_control_flow.transpiled.rn`, `main.rn`ï¼‰
- æ—¢å­˜ãƒ‘ã‚¿ãƒ¼ãƒ³ã®è¸è¥²: Two-Passæ§‹é€ ã¯ä¸å¤‰
- æ–°è¦å­¦ç¿’ãªã—: å…¨æŠ€è¡“è¦ç´ ãŒæ—¢çŸ¥

### 4.2 Risk Assessment

**Risk**: Low

**æ ¹æ‹ **:
- âœ… æ—¢çŸ¥ã®æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯ï¼ˆRustã€Runeã€æ–‡å­—åˆ—ç”Ÿæˆï¼‰
- âœ… æ˜ç¢ºãªã‚¹ã‚³ãƒ¼ãƒ—ï¼ˆ5ç®‡æ‰€ã®ä¿®æ­£ã€å½±éŸ¿ç¯„å›²ãŒé™å®šçš„ï¼‰
- âœ… åŒ…æ‹¬çš„ãªãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆï¼ˆ268ãƒ†ã‚¹ãƒˆã€ä¿®æ­£ã‚’æ—©æœŸæ¤œå‡ºï¼‰
- âœ… çµ±åˆãƒã‚¤ãƒ³ãƒˆãŒæ˜ç¢ºï¼ˆ`pasta_stdlib::Actor` ã¯æ—¢å­˜ã€å¤‰æ›´ä¸è¦ï¼‰
- âœ… ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã¸ã®å½±éŸ¿ãªã—ï¼ˆæ–‡å­—åˆ—ç”Ÿæˆã®è»½å¾®ãªå¤‰æ›´ï¼‰

**ãƒªã‚¹ã‚¯è¦å› **:
- âš ï¸ ãƒ†ã‚¹ãƒˆãƒ•ã‚£ã‚¯ã‚¹ãƒãƒ£ã®æ›´æ–°æ¼ã‚Œ â†’ ãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆã§æ¤œå‡ºå¯èƒ½
- âš ï¸ ãƒ­ãƒ¼ã‚«ãƒ«ãƒ©ãƒ™ãƒ«ã®useæ–‡è¦å¦ â†’ è¨­è¨ˆãƒ•ã‚§ãƒ¼ã‚ºã§æ¤œè¨¼

---

## 5. Requirement-to-Asset Map

| Requirement | Asset | Modification Type | Complexity | Notes |
|-------------|-------|-------------------|------------|-------|
| **Req 1**: ã‚¢ã‚¯ã‚¿ãƒ¼å¤‰æ•°å‚ç…§ | `transpile_statement_to_writer()` L353 | Extend (1è¡Œ) | Trivial | ãƒ€ãƒ–ãƒ«ã‚¯ã‚©ãƒ¼ãƒˆå‰Šé™¤ |
| **Req 2**: Actor ã‚¤ãƒ™ãƒ³ãƒˆ | `transpile_statement_to_writer()` L355 | Extend (1è¡Œ) | Trivial | å›ºå®šæ–‡å­—åˆ—ã«å¤‰æ›´ |
| **Req 3**: useæ–‡ç”Ÿæˆ | `transpile_global_label()` L276ç›´å¾Œ | Extend (3è¡Œ) | Simple | 3ã¤ã®useæ–‡ã‚’é †ã«å‡ºåŠ› |
| **Req 4**: callçŸ­ç¸®å½¢ | `transpile_statement_to_writer()` L375 | Extend (1è¡Œ) | Trivial | `crate::pasta::` å‰Šé™¤ |
| **Req 4**: jumpçŸ­ç¸®å½¢ | `transpile_statement_to_writer()` L390 | Extend (1è¡Œ) | Trivial | `crate::pasta::` å‰Šé™¤ |
| **Req 5**: ãƒ†ã‚¹ãƒˆæ¤œè¨¼ | `transpile_comprehensive_test.rs` ä»– | Update | Simple | æ¤œè¨¼ãƒ‘ã‚¿ãƒ¼ãƒ³æ›´æ–° |
| **ãƒ•ã‚£ã‚¯ã‚¹ãƒãƒ£** | `comprehensive_control_flow.transpiled.rn` | Regenerate | Trivial | ãƒˆãƒ©ãƒ³ã‚¹ãƒ‘ã‚¤ãƒ©ãƒ¼å®Ÿè¡Œ |
| **ã‚¢ã‚¯ã‚¿ãƒ¼å®šç¾©** | `test-project/main.rn` | Update | Simple | `pub mod actors` æ§‹é€  |

**Legend**:
- **Trivial**: 1-2è¡Œã®å¤‰æ›´ã€ãƒ­ã‚¸ãƒƒã‚¯ä¸è¦
- **Simple**: 3-10è¡Œã®å¤‰æ›´ã€å˜ç´”ãªãƒ­ã‚¸ãƒƒã‚¯

---

## 6. Recommendations for Design Phase

### 6.1 Preferred Approach

**Option A: Extend Existing Components**

**ç†ç”±**:
1. æœ€å°é™ã®å¤‰æ›´ã§è¦ä»¶ã‚’å®Ÿç¾ï¼ˆ10è¡Œæœªæº€ã®è¿½åŠ ï¼‰
2. æ—¢å­˜ã®Two-Passæ§‹é€ ã‚’ç¶­æŒ
3. ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ãŒæ—¢ã«å……å®Ÿï¼ˆ268ãƒ†ã‚¹ãƒˆï¼‰
4. ãƒªã‚¹ã‚¯ãŒä½ãã€é–‹ç™ºæœŸé–“ãŒçŸ­ã„ï¼ˆ1-3æ—¥ï¼‰

### 6.2 Key Decisions for Design

1. **ãƒ­ãƒ¼ã‚«ãƒ«ãƒ©ãƒ™ãƒ«ã®useæ–‡**:
   - æ±ºå®š: ãƒ­ãƒ¼ã‚«ãƒ«ãƒ©ãƒ™ãƒ«é–¢æ•°ã«ã¯ use æ–‡ä¸è¦
   - ç†ç”±: ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å†…é–¢æ•°ã¨ã—ã¦ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒ©ãƒ™ãƒ«ã®useæ–‡ã‚’ç¶™æ‰¿
   - å®Ÿè£…: ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒ©ãƒ™ãƒ«ã®ã¿ `transpile_global_label()` ã§ use æ–‡ç”Ÿæˆ

2. **ã‚¢ã‚¯ã‚¿ãƒ¼åãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ã‚¢ã‚¯ã‚»ã‚¹**:
   - æ±ºå®šæ¸ˆã¿: `ctx.actor.name` ã§ã‚¢ã‚¯ã‚»ã‚¹
   - å‰æ: ã‚¢ã‚¯ã‚¿ãƒ¼å®šç¾©ã« `name` ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒå­˜åœ¨
   - æ¤œè¨¼: Rune VMã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ãƒ†ã‚¹ãƒˆã§ç¢ºèª

3. **ãƒ†ã‚¹ãƒˆæˆ¦ç•¥**:
   - å˜ä½“ãƒ†ã‚¹ãƒˆ: ç”Ÿæˆã‚³ãƒ¼ãƒ‰ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒãƒ³ã‚°
   - çµ±åˆãƒ†ã‚¹ãƒˆ: Rune VMã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æˆåŠŸç¢ºèª
   - ãƒ•ã‚£ã‚¯ã‚¹ãƒãƒ£: `comprehensive_control_flow.transpiled.rn` ã®å†ç”Ÿæˆ

### 6.3 Research Items

**ãªã—**: å…¨ã¦ã®æŠ€è¡“è¦ç´ ãŒæ—¢çŸ¥ã§ã‚ã‚Šã€è¿½åŠ èª¿æŸ»ã¯ä¸è¦

---

## 7. Next Steps

### 7.1 Design Phase

**å®Ÿè¡Œã‚³ãƒãƒ³ãƒ‰**:
```bash
/kiro-spec-design pasta-transpiler-actor-variables -y
```

**è¨­è¨ˆã§æ±ºå®šã™ã¹ãäº‹é …**:
1. ãƒ­ãƒ¼ã‚«ãƒ«ãƒ©ãƒ™ãƒ«é–¢æ•°ã®useæ–‡ç”Ÿæˆè¦å¦
2. ãƒ†ã‚¹ãƒˆæ¤œè¨¼ãƒ‘ã‚¿ãƒ¼ãƒ³ã®å…·ä½“çš„ãªå®Ÿè£…
3. ãƒ•ã‚£ã‚¯ã‚¹ãƒãƒ£æ›´æ–°ã®æ‰‹é †

### 7.2 Implementation Phase

**æ¨å¥¨é †åº**:
1. Pass 1ã®ä¿®æ­£ï¼ˆ5ç®‡æ‰€ï¼‰
2. ãƒ†ã‚¹ãƒˆãƒ•ã‚£ã‚¯ã‚¹ãƒãƒ£ã®æ›´æ–°ï¼ˆ`main.rn`ï¼‰
3. ãƒˆãƒ©ãƒ³ã‚¹ãƒ‘ã‚¤ãƒ©ãƒ¼å®Ÿè¡Œã§ãƒ•ã‚£ã‚¯ã‚¹ãƒãƒ£å†ç”Ÿæˆ
4. ãƒ†ã‚¹ãƒˆæ¤œè¨¼ãƒ‘ã‚¿ãƒ¼ãƒ³ã®æ›´æ–°
5. å…¨ãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œã¨æ¤œè¨¼

---

## 8. Conclusion

**Summary**:
- âœ… å…¨è¦ä»¶ãŒæ—¢å­˜ã‚³ãƒ¼ãƒ‰æ‹¡å¼µã§å®Ÿç¾å¯èƒ½
- âœ… è¤‡é›‘åº¦ Sï¼ˆ1-3æ—¥ï¼‰ã€ãƒªã‚¹ã‚¯ Low
- âœ… æ¨å¥¨ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ: Option Aï¼ˆæ—¢å­˜ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆæ‹¡å¼µï¼‰
- âœ… è¿½åŠ èª¿æŸ»ä¸è¦ã€è¨­è¨ˆãƒ•ã‚§ãƒ¼ã‚ºã¸ç›´ã¡ã«ç§»è¡Œå¯èƒ½

**Confidence Level**: High - æ—¢çŸ¥ã®æŠ€è¡“ã€æ˜ç¢ºãªã‚¹ã‚³ãƒ¼ãƒ—ã€åŒ…æ‹¬çš„ãªãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆ
