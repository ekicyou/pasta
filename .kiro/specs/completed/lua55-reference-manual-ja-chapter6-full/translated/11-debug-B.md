## 6.11 – デバッグライブラリ（パートB: getmetatable-setlocal）

---

### debug.getmetatable (value)

指定された `value` のメタテーブルを返すか、メタテーブルがない場合は **nil** を返します。

---

### debug.getregistry ()

レジストリテーブルを返します（[§4.3](#43--レジストリ) 参照）。

---

### debug.getupvalue (f, up)

この関数は、関数 `f` のインデックス `up` を持つ上位値の名前と値を返します。関数は指定されたインデックスを持つ上位値がない場合は **fail** を返します。

（Lua関数の場合、上位値は関数が使用する外部ローカル変数であり、したがってそのクロージャに含まれます。）

C関数の場合、この関数はすべての上位値の名前として空文字列 `""` を使用します。

変数名 '`?`'（疑問符）は既知の名前がない変数を表します（デバッグ情報なしで保存されたチャンクからの変数）。

---

### debug.getuservalue (u, n)

ユーザーデータ `u` に関連付けられた `n` 番目のユーザー値とブール値を返します。ユーザーデータがその値を持たない場合は **false** を返します。

---

### debug.sethook ([thread,] hook, mask [, count])

指定された関数をデバッグフックとして設定します。文字列 `mask` と数値 `count` は、フックがいつ呼び出されるかを記述します。文字列 mask は以下の文字の任意の組み合わせを持つことができ、それぞれの意味があります：

| マスク | 説明 |
|--------|------|
| `'c'` | Luaが関数を呼び出すたびにフックが呼び出される |
| `'r'` | Luaが関数から戻るたびにフックが呼び出される |
| `'l'` | Luaがコードの新しい行に入るたびにフックが呼び出される |

さらに、`count` がゼロと異なる場合、フックは `count` 命令ごとにも呼び出されます。

引数なしで呼び出された場合、[`debug.sethook`](#debugsethook-thread-hook-mask--count) はフックをオフにします。

フックが呼び出されたとき、その最初のパラメータは呼び出しをトリガーしたイベントを説明する文字列です：`"call"`、`"tail call"`、`"return"`、`"line"`、および `"count"`。行イベントの場合、フックは2番目のパラメータとして新しい行番号も取得します。フック内では、レベル 2 で `getinfo` を呼び出して実行中の関数についての詳細情報を取得できます。（レベル 0 は `getinfo` 関数であり、レベル 1 はフック関数です。）

---

### debug.setlocal ([thread,] level, local, value)

この関数は、値 `value` をスタックのレベル `level` の関数のインデックス `local` を持つローカル変数に代入します。関数は指定されたインデックスを持つローカル変数がない場合は **fail** を返し、範囲外の `level` で呼び出された場合はエラーを発生させます。（レベルが有効かどうかを確認するには `getinfo` を呼び出すことができます。）それ以外の場合、ローカル変数の名前を返します。

変数のインデックスと名前についての詳細は [`debug.getlocal`](#debuggetlocal-thread-f-local) を参照してください。
