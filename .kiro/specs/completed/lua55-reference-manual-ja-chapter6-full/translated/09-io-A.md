## 6.9 – 入出力機能

I/Oライブラリはファイル操作のために2つの異なるスタイルを提供します。最初のスタイルは暗黙のファイルハンドルを使用します。つまり、デフォルトの入力ファイルとデフォルトの出力ファイルを設定する操作があり、すべての入出力操作はこれらのデフォルトファイルに対して行われます。2番目のスタイルは明示的なファイルハンドルを使用します。

暗黙のファイルハンドルを使用する場合、すべての操作はテーブル `io` によって提供されます。明示的なファイルハンドルを使用する場合、操作 [`io.open`](#ioopen-filename--mode) がファイルハンドルを返し、すべての操作はファイルハンドルのメソッドとして提供されます。

ファイルハンドルのメタテーブルは、呼び出されたときにファイルを閉じようとする `__gc` と `__close` のメタメソッドを提供します。

テーブル `io` は、Cから通常の意味を持つ3つの事前定義されたファイルハンドルも提供します：`io.stdin`、`io.stdout`、`io.stderr`。I/Oライブラリはこれらのファイルを閉じることはありません。

特に明記されない限り、すべてのI/O関数は失敗時に **fail** を返し、2番目の結果としてエラーメッセージ、3番目の結果としてシステム依存のエラーコードを返し、成功時には何らかの false でない値を返します。非POSIXシステムでは、エラー時のエラーメッセージとエラーコードの計算は、グローバルC変数 `errno` に依存するため、スレッドセーフでない場合があります。

---

### io.close ([file])

`file:close()` と等価です。`file` が指定されていない場合、デフォルトの出力ファイルを閉じます。

---

### io.flush ()

`io.output():flush()` と等価です。

---

### io.input ([file])

ファイル名で呼び出された場合、指定されたファイルを（テキストモードで）開き、そのハンドルをデフォルトの入力ファイルとして設定します。ファイルハンドルで呼び出された場合、単にこのファイルハンドルをデフォルトの入力ファイルとして設定します。引数なしで呼び出された場合、現在のデフォルトの入力ファイルを返します。

エラーの場合、この関数はエラーコードを返す代わりにエラーを発生させます。

---

### io.lines ([filename, ···])

指定されたファイル名を読み取りモードで開き、開かれたファイルに対して `file:lines(···)` のように動作するイテレータ関数を返します。イテレータ関数が値を読み取れなかった場合、自動的にファイルを閉じます。イテレータ関数に加えて、`io.lines` は3つの他の値を返します：2つの **nil** 値をプレースホルダーとして、および作成されたファイルハンドル。したがって、汎用 **for** ループで使用する場合、ループがエラーまたは **break** によって中断された場合もファイルは閉じられます。

呼び出し `io.lines()`（ファイル名なし）は `io.input():lines("l")` と等価です。つまり、デフォルトの入力ファイルの行に対して反復します。この場合、イテレータはループが終了してもファイルを閉じません。

ファイルを開く際のエラーの場合、この関数はエラーコードを返す代わりにエラーを発生させます。
