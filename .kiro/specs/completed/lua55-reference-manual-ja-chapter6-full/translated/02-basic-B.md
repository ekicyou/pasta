## 6.2 – 基本関数（パートB: _G-loadfile）

---

### _G

グローバル環境を保持するグローバル変数（関数ではありません）（[§2.2](02-basic-concepts.md#22--環境とグローバル環境) 参照）。Lua自体はこの変数を使用しません。この値を変更しても環境に影響せず、その逆も同様です。

---

### getmetatable (object)

`object` がメタテーブルを持たない場合、**nil** を返します。そうでなければ、オブジェクトのメタテーブルに `__metatable` フィールドがある場合、関連付けられた値を返します。そうでなければ、与えられたオブジェクトのメタテーブルを返します。

---

### ipairs (t)

以下の構文が

```lua
for i,v in ipairs(t) do body end
```

キー・値ペア (`1,t[1]`), (`2,t[2]`), ... を最初の存在しないインデックスまで反復するように、3つの値（イテレータ関数、値 `t`、0）を返します。

---

### load (chunk [, chunkname [, mode [, env]]])

チャンクをロードします。

`chunk` が文字列の場合、チャンクはこの文字列です。`chunk` が関数の場合、`load` はチャンクの断片を取得するために繰り返し呼び出します。`chunk` への各呼び出しは、以前の結果と連結する文字列を返す必要があります。空文字列、**nil**、または値なしのリターンはチャンクの終了を示します。

構文エラーがなければ、`load` はコンパイルされたチャンクを関数として返します。そうでなければ、**fail** とエラーメッセージを返します。

メインチャンクをロードする場合、結果の関数は常に正確に1つのアップバリュー、`_ENV` 変数を持ちます（[§2.2](02-basic-concepts.md#22--環境とグローバル環境) 参照）。しかし、関数から作成されたバイナリチャンクをロードする場合（[`string.dump`](#pdf-stringdump) 参照）、結果の関数は任意の数のアップバリューを持つことができ、最初のアップバリューが `_ENV` 変数である保証はありません。（非メイン関数は `_ENV` アップバリューを持たないこともあります。）

いずれにせよ、結果の関数がアップバリューを持つ場合、そのパラメータが指定されていれば最初のアップバリューは `env` の値に設定され、そうでなければグローバル環境の値に設定されます。他のアップバリューは **nil** で初期化されます。すべてのアップバリューはフレッシュであり、他の関数と共有されません。

`chunkname` はエラーメッセージとデバッグ情報のチャンク名として使用されます（[§4.7](04-the-application-program-interface.md#47--デバッグインターフェース) 参照）。省略された場合、`chunk` が文字列ならば `chunk` がデフォルトになり、そうでなければ "`=(load)`" がデフォルトになります。

文字列 `mode` はチャンクがテキストかバイナリ（つまりプリコンパイルされたチャンク）かを制御します。"`b`"（バイナリチャンクのみ）、"`t`"（テキストチャンクのみ）、または "`bt`"（バイナリとテキストの両方）のいずれかです。デフォルトは "`bt`" です。

Luaはバイナリチャンクの整合性をチェックしません。悪意を持って作成されたバイナリチャンクはインタプリタをクラッシュさせる可能性があります。`mode` パラメータを使用してバイナリチャンクのロードを防ぐことができます。

---

### loadfile ([filename [, mode [, env]]])

[`load`](#load-chunk--chunkname--mode--env) に似ていますが、チャンクをファイル `filename` から取得します。ファイル名が指定されない場合は標準入力から取得します。
