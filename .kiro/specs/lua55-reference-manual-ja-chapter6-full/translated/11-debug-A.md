## 6.11 – デバッグライブラリ

このライブラリは、Luaプログラムにデバッグインタフェース（[§4.7](#47--デバッグインタフェース) 参照）の機能を提供します。このライブラリを使用する際は注意が必要です。いくつかの関数はLuaコードに関する基本的な前提に違反し（例えば、関数にローカルな変数は外部からアクセスできない、ユーザーデータのメタテーブルはLuaコードで変更できない、Luaプログラムはクラッシュしないなど）、そのため安全なコードを危険にさらす可能性があります。さらに、このライブラリの一部の関数は遅い場合があります。

このライブラリのすべての関数は `debug` テーブル内に提供されます。スレッド上で動作するすべての関数は、動作対象のスレッドをオプションの最初の引数として持ちます。デフォルトは常に現在のスレッドです。

---

### debug.debug ()

ユーザーとの対話モードに入り、ユーザーが入力する各文字列を実行します。単純なコマンドやその他のデバッグ機能を使用して、ユーザーはグローバル変数とローカル変数を検査し、その値を変更し、式を評価することなどができます。単語 `cont` のみを含む行でこの関数は終了し、呼び出し元が実行を継続します。

`debug.debug` のコマンドは字句的にどの関数内にもネストされていないため、ローカル変数への直接アクセスはないことに注意してください。

---

### debug.gethook ([thread])

スレッドの現在のフック設定を3つの値として返します：現在のフック関数、現在のフックマスク、および [`debug.sethook`](#debugsethook-thread-hook-mask--count) 関数で設定された現在のフックカウント。

アクティブなフックがない場合は **fail** を返します。

---

### debug.getinfo ([thread,] f [, what])

関数に関する情報を含むテーブルを返します。関数を直接与えるか、`f` の値として数値を与えることができます。数値は、指定されたスレッドのコールスタックのレベル `f` で実行されている関数を意味します：レベル 0 は現在の関数（`getinfo` 自身）、レベル 1 は `getinfo` を呼び出した関数（テールコールはスタックにカウントされません）、などとなります。`f` がアクティブな関数の数より大きい数値の場合、`getinfo` は **fail** を返します。

返されるテーブルには [`lua_getinfo`](#lua_getinfo) が返すすべてのフィールドを含めることができ、文字列 `what` がどのフィールドを埋めるかを記述します。`what` のデフォルトは、有効な行のテーブルを除くすべての利用可能な情報を取得します。オプション '`f`' は関数自体を含む `func` という名前のフィールドを追加します。オプション '`L`' は、関数がLua関数の場合、有効な行のテーブルを含む `activelines` という名前のフィールドを追加します。関数にデバッグ情報がない場合、テーブルは空です。

例えば、式 `debug.getinfo(1,"n").name` は、合理的な名前が見つかれば現在の関数の名前を返し、式 `debug.getinfo(print)` は [`print`](#print-) 関数に関するすべての利用可能な情報を含むテーブルを返します。

---

### debug.getlocal ([thread,] f, local)

この関数は、スタックのレベル `f` の関数のインデックス `local` を持つローカル変数の名前と値を返します。この関数は明示的なローカル変数だけでなく、パラメータや一時的な値にもアクセスします。

最初のパラメータまたはローカル変数はインデックス 1 を持ち、コード内で宣言された順序に従い、関数の現在のスコープでアクティブな変数のみをカウントします。コンパイル時定数はコンパイラによって最適化された場合、このリストに表示されない場合があります。負のインデックスは可変引数を参照します。-1 は最初の可変引数です。これらの負のインデックスは可変引数テーブルが最適化された場合にのみ利用可能です。そうでなければ、可変引数は可変引数テーブル内で利用可能です。

関数は指定されたインデックスを持つ変数がない場合は **fail** を返し、範囲外のレベルで呼び出された場合はエラーを発生させます。（レベルが有効かどうかを確認するには [`debug.getinfo`](#debuggetinfo-thread-f--what) を呼び出すことができます。）

'`(`'（開き括弧）で始まる変数名は、既知の名前がない変数を表します（ループ制御変数などの内部変数や、デバッグ情報なしで保存されたチャンクからの変数）。

パラメータ `f` は関数であることもあります。その場合、`getlocal` は関数パラメータの名前のみを返します。
