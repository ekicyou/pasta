## 6.9 – 入出力機能（パートD: file:メソッド）

---

### file:close ()

`file` を閉じます。ファイルはハンドルがガベージコレクションされるときに自動的に閉じられますが、それがいつ起こるかは予測できないことに注意してください。

[`io.popen`](#iopopen-prog--mode) で作成されたファイルハンドルを閉じる場合、[`file:close`](#fileclose-) は [`os.execute`](#osecute-command) が返す値と同じ値を返します。

---

### file:flush ()

書き込まれたデータを `file` に保存します。

---

### file:lines (···)

呼び出されるたびに、指定されたフォーマットに従ってファイルを読み取るイテレータ関数を返します。フォーマットが指定されていない場合、デフォルトとして "`l`" を使用します。例えば、以下の構文

```lua
for c in file:lines(1) do body end
```

は、現在の位置から開始して、ファイルのすべての文字に対して反復します。[`io.lines`](#iolines-filename-) と異なり、この関数はループが終了してもファイルを閉じません。

---

### file:read (···)

指定されたフォーマットに従ってファイル `file` を読み取ります。フォーマットは何を読み取るかを指定します。各フォーマットに対して、関数は読み取った文字を含む文字列または数値を返すか、指定されたフォーマットでデータを読み取れない場合は **fail** を返します。（後者の場合、関数は後続のフォーマットを読み取りません。）引数なしで呼び出された場合、次の行を読み取るデフォルトのフォーマットを使用します。

利用可能なフォーマット：

| フォーマット | 説明 |
|-------------|------|
| `"n"` | 数値を読み取り、Luaの字句規則に従って浮動小数点数または整数として返す。（数値は先頭に空白と符号を持つことができます。）有効な数値の接頭辞となる最長の入力シーケンスを常に読み取ります。その接頭辞が有効な数値を形成しない場合（例：空文字列、"`0x`"、"`3.4e-`"）または長すぎる場合（200文字以上）、破棄されて **fail** を返します。 |
| `"a"` | 現在の位置からファイル全体を読み取ります。ファイル終端で空文字列を返します。このフォーマットは失敗しません。 |
| `"l"` | 次の行を行末をスキップして読み取り、ファイル終端で **fail** を返します。これがデフォルトのフォーマットです。 |
| `"L"` | 次の行を行末文字（存在する場合）を保持して読み取り、ファイル終端で **fail** を返します。 |
| *number* | このバイト数までの文字列を読み取り、ファイル終端で **fail** を返します。`number` が 0 の場合、何も読み取らず空文字列を返すか、ファイル終端で **fail** を返します。 |

フォーマット "`l`" と "`L`" はテキストファイルでのみ使用すべきです。

---

### file:seek ([whence [, offset]])

ファイル位置を、ファイルの先頭から測定して、`offset` に文字列 `whence` で指定された基準を加えた位置に設定および取得します：

| whence | 説明 |
|--------|------|
| `"set"` | 基準は位置 0（ファイルの先頭） |
| `"cur"` | 基準は現在の位置 |
| `"end"` | 基準はファイルの終端 |

成功した場合、`seek` はファイルの先頭からバイト単位で測定した最終的なファイル位置を返します。`seek` が失敗した場合、**fail** とエラーを説明する文字列を返します。

`whence` のデフォルト値は `"cur"`、`offset` のデフォルト値は 0 です。したがって、呼び出し `file:seek()` は現在のファイル位置を変更せずに返します。呼び出し `file:seek("set")` は位置をファイルの先頭に設定し（0 を返します）、呼び出し `file:seek("end")` は位置をファイルの終端に設定し、そのサイズを返します。

---

### file:setvbuf (mode [, size])

ファイルのバッファリングモードを設定します。3つの利用可能なモードがあります：

| モード | 説明 |
|--------|------|
| `"no"` | バッファリングなし |
| `"full"` | 完全バッファリング |
| `"line"` | 行バッファリング |

後者の2つの場合、`size` はバッファのサイズのヒント（バイト単位）です。デフォルトは適切なサイズです。

各モードの具体的な動作は移植性がありません。詳細はプラットフォームの基盤となるISO C関数 `setvbuf` を確認してください。

---

### file:write (···)

各引数の値を `file` に書き込みます。引数は文字列または数値でなければなりません。

成功した場合、この関数は `file` を返します。そうでなければ、4つの値を返します：**fail**、エラーメッセージ、エラーコード、書き込むことができたバイト数。
