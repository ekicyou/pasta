# Technical Design: release-workflow

## Overview

**Purpose**: æœ¬è¨­è¨ˆã¯ã€pasta ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã® crates.io å…¬é–‹ãƒ»GitHub Release ä½œæˆã‚’å«ã‚€ãƒªãƒªãƒ¼ã‚¹ä½œæ¥­ã‚’ã€LLM ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒç¹°ã‚Šè¿”ã—å®Ÿè¡Œã™ã‚‹ãŸã‚ã®ã‚ªãƒšãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³è¨­è¨ˆã‚’å®šç¾©ã™ã‚‹ã€‚

**Users**: é–‹ç™ºè€…ï¼ˆekicyouï¼‰ãŒ `/kiro-spec-impl release-workflow` ã‚’å®Ÿè¡Œã™ã‚‹ãŸã³ã«ã€LLM ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒæœ¬è¨­è¨ˆã«å¾“ã£ã¦ãƒªãƒªãƒ¼ã‚¹ä½œæ¥­ã‚’é‚è¡Œã™ã‚‹ã€‚

**Impact**: æ‰‹å‹•ãƒªãƒªãƒ¼ã‚¹æ‰‹é †ï¼ˆ`RELEASE.md`ï¼‰ã‚’ä½“ç³»åŒ–ã—ã€ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ã‹ã‚‰ GitHub Release ä½œæˆã¾ã§ã®å…¨å·¥ç¨‹ã‚’ä¸€è²«ã—ãŸå“è³ªã§ç¹°ã‚Šè¿”ã—å®Ÿè¡Œå¯èƒ½ã«ã™ã‚‹ã€‚

### Goals
- Cargo.toml ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³æ›´æ–°ã‹ã‚‰ GitHub Release ä½œæˆã¾ã§ã®å…¨å·¥ç¨‹ã‚’ LLM ãŒé€æ¬¡å®Ÿè¡Œã™ã‚‹
- å„ã‚¹ãƒ†ãƒƒãƒ—ã§ã‚¨ãƒ©ãƒ¼æ¤œå‡ºãƒ»ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒ»é–‹ç™ºè€…ç¢ºèªã‚’é©åˆ‡ã«è¡Œã†
- Conventional Commits ã«åŸºã¥ãæ•´å½¢æ¸ˆã¿ãƒã‚§ãƒ³ã‚¸ãƒ­ã‚°ã‚’è‡ªå‹•ç”Ÿæˆã™ã‚‹
- ç¹°ã‚Šè¿”ã—å®Ÿè¡Œå¯èƒ½ãªè¨­è¨ˆã‚’ç¶­æŒã™ã‚‹ï¼ˆä»•æ§˜ã¯ `completed` ã«é·ç§»ã—ãªã„ï¼‰

### Non-Goals
- ãƒªãƒªãƒ¼ã‚¹è‡ªå‹•åŒ–ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®æ–°è¦ä½œæˆï¼ˆLLM ã«ã‚ˆã‚‹å¯¾è©±çš„å®Ÿè¡Œã§ä»£æ›¿ï¼‰
- CI/CD ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã¸ã®çµ±åˆï¼ˆãƒ­ãƒ¼ã‚«ãƒ«å®Ÿè¡Œå‰æï¼‰
- ã‚¯ãƒ­ã‚¹ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ å¯¾å¿œï¼ˆWindows + PowerShell ç’°å¢ƒé™å®šï¼‰
- `cargo publish` èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³ã®è‡ªå‹•è¨­å®šï¼ˆã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¸Šã€æ‰‹å‹•è¨­å®šã‚’å‰æã¨ã™ã‚‹ï¼‰

## Architecture

### Existing Architecture Analysis

æœ¬ä»•æ§˜ã¯ã‚³ãƒ¼ãƒ‰ã®æ–°è¦ä½œæˆãƒ»å¤‰æ›´ã‚’ä¼´ã‚ãªã„**ã‚ªãƒšãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ä»•æ§˜**ã§ã‚ã‚‹ã€‚æ—¢å­˜ã®ãƒ„ãƒ¼ãƒ«ç¾¤ã‚’çµ„ã¿åˆã‚ã›ã¦ LLM ãŒé€æ¬¡å®Ÿè¡Œã™ã‚‹ã€‚

**æ—¢å­˜ã‚¢ã‚»ãƒƒãƒˆ**:

| ã‚¢ã‚»ãƒƒãƒˆ | çŠ¶æ…‹ | æœ¬è¨­è¨ˆã§ã®å½¹å‰² |
|----------|------|----------------|
| `Cargo.toml`ï¼ˆãƒ«ãƒ¼ãƒˆï¼‰ | âœ… ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹é›†ä¸­ç®¡ç† | ãƒãƒ¼ã‚¸ãƒ§ãƒ³æ›´æ–°å¯¾è±¡ï¼ˆ4ç®‡æ‰€ï¼‰ |
| `release.ps1` | âœ… æˆç†Ÿã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼ˆ387è¡Œï¼‰ | ã‚´ãƒ¼ã‚¹ãƒˆãƒ“ãƒ«ãƒ‰å®Ÿè¡Œ |
| `gh` CLI | âœ… èªè¨¼æ¸ˆã¿ï¼ˆekicyouï¼‰ | GitHub Release ä½œæˆ |
| `cargo` | âœ… åˆ©ç”¨å¯èƒ½ | ãƒ†ã‚¹ãƒˆãƒ»ãƒ“ãƒ«ãƒ‰ãƒ»å…¬é–‹ |
| `git` | âœ… åˆ©ç”¨å¯èƒ½ | ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ãƒ»ã‚¿ã‚°ãƒ»ãƒ—ãƒƒã‚·ãƒ¥ |

**ä¿æŒã™ã¹ããƒ‘ã‚¿ãƒ¼ãƒ³**:
- ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ãƒ«ãƒ¼ãƒˆ `Cargo.toml` ã«ã‚ˆã‚‹é›†ä¸­ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†
- `release.ps1` ã®ãã®ã¾ã¾ã®åˆ©ç”¨ï¼ˆå¤‰æ›´ä¸è¦ï¼‰
- Conventional Commits ã«ã‚ˆã‚‹ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¦ç´„

### Architecture Pattern & Boundary Map

**é¸æŠãƒ‘ã‚¿ãƒ¼ãƒ³**: Sequential Pipeline â€” LLM ãŒå„ãƒ•ã‚§ãƒ¼ã‚ºã®ã‚¹ãƒ†ãƒƒãƒ—ã‚’é€æ¬¡å®Ÿè¡Œã—ã€çµæœã‚’ç¢ºèªã—ã¦æ¬¡ã®ãƒ•ã‚§ãƒ¼ã‚ºã«é€²ã‚€ã€‚

```mermaid
graph TB
    subgraph Phase0 [Phase 0: å‰ææ¡ä»¶ç¢ºèª]
        P0_1[cargo credentials ç¢ºèª]
        P0_2[gh auth ç¢ºèª]
    end

    subgraph Phase1 [Phase 1: äº‹å‰æ¤œè¨¼]
        P1_1[ãƒãƒ¼ã‚¸ãƒ§ãƒ³æ±ºå®š]
        P1_2[æœªã‚³ãƒŸãƒƒãƒˆå¤‰æ›´ã®è‡ªå‹•ã‚³ãƒŸãƒƒãƒˆ]
        P1_3[cargo test å®Ÿè¡Œ]
    end

    subgraph Phase2 [Phase 2: ãƒãƒ¼ã‚¸ãƒ§ãƒ³æ›´æ–°]
        P2_1[Cargo.toml 4ç®‡æ‰€æ›´æ–°]
        P2_2[cargo build æ¤œè¨¼]
        P2_3[ãƒãƒ¼ã‚¸ãƒ§ãƒ³æ›´æ–°ã‚³ãƒŸãƒƒãƒˆ]
    end

    subgraph Phase3 [Phase 3: crates.io å…¬é–‹]
        P3_1[pasta_core publish]
        P3_2[10ç§’å¾…æ©Ÿ]
        P3_3[pasta_lua publish]
        P3_4[10ç§’å¾…æ©Ÿ]
        P3_5[pasta_shiori publish]
    end

    subgraph Phase4 [Phase 4: ã‚´ãƒ¼ã‚¹ãƒˆãƒ“ãƒ«ãƒ‰]
        P4_1[release.ps1 å®Ÿè¡Œ]
        P4_2[æˆæœç‰©ç¢ºèª]
        P4_3[ãƒ“ãƒ«ãƒ‰ã‚³ãƒŸãƒƒãƒˆ]
    end

    subgraph Phase5 [Phase 5: ã‚¿ã‚°ã¨ãƒ—ãƒƒã‚·ãƒ¥]
        P5_1[git tag ä½œæˆ]
        P5_2[git push --tags]
    end

    subgraph Phase6 [Phase 6: GitHub Release]
        P6_1[git log ã§ã‚³ãƒŸãƒƒãƒˆå±¥æ­´å–å¾—]
        P6_2[LLM ãƒã‚§ãƒ³ã‚¸ãƒ­ã‚°æ•´å½¢]
        P6_3[gh release create]
    end

    Phase0 --> Phase1
    Phase1 --> Phase2
    Phase2 --> Phase3
    Phase3 --> Phase4
    Phase4 --> Phase5
    Phase5 --> Phase6
```

**ãƒ‰ãƒ¡ã‚¤ãƒ³å¢ƒç•Œ**:
- å„ãƒ•ã‚§ãƒ¼ã‚ºã¯ç‹¬ç«‹ã—ãŸã‚²ãƒ¼ãƒˆã‚’æŒã¡ã€å¤±æ•—æ™‚ã¯ãã®ãƒ•ã‚§ãƒ¼ã‚ºã§åœæ­¢
- Phase 0ã€œ1 ã¯æ¤œè¨¼ãƒ•ã‚§ãƒ¼ã‚ºï¼ˆãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ä¸è¦ï¼‰
- Phase 2ã€œ6 ã¯å®Ÿè¡Œãƒ•ã‚§ãƒ¼ã‚ºï¼ˆã‚¨ãƒ©ãƒ¼æ™‚ã®ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯æˆ¦ç•¥ãŒå®šç¾©æ¸ˆã¿ï¼‰

**Steering æº–æ‹ **:
- workflow.md ã®ã€Œå±é™ºãª Git æ“ä½œã®ç¦æ­¢ã€ãƒãƒªã‚·ãƒ¼ã«æº–æ‹ ï¼ˆ`git reset --hard` ç­‰ã¯ä½¿ç”¨ã—ãªã„ï¼‰
- tech.md ã®ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯ãƒãƒ¼ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°æº–æ‹ 
- Conventional Commits ã«ã‚ˆã‚‹ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¦ç´„

### Technology Stack

| Layer | Choice / Version | Role in Feature | Notes |
|-------|------------------|-----------------|-------|
| CLI | `cargo` (Rust toolchain) | ãƒ†ã‚¹ãƒˆãƒ»ãƒ“ãƒ«ãƒ‰ãƒ»crates.io å…¬é–‹ | `cargo publish -p <crate>` |
| CLI | `git` | ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ãƒ»ã‚¿ã‚°ãƒ»ãƒ—ãƒƒã‚·ãƒ¥ | ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã‚¿ã‚°ä½¿ç”¨ |
| CLI | `gh` (GitHub CLI) | GitHub Release ä½œæˆãƒ»ã‚¢ã‚»ãƒƒãƒˆæ·»ä»˜ | èªè¨¼æ¸ˆã¿ï¼ˆekicyouï¼‰ |
| Script | `release.ps1` (PowerShell) | x86 DLL ãƒ“ãƒ«ãƒ‰ + .nar ç”Ÿæˆ | æ—¢å­˜æˆç†Ÿã‚¹ã‚¯ãƒªãƒ—ãƒˆ |
| Editor | LLM ã‚¨ãƒ‡ã‚£ã‚¿ãƒ„ãƒ¼ãƒ« | `Cargo.toml` ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç·¨é›† | `replace_string_in_file` |
| Runtime | Windows + PowerShell | å®Ÿè¡Œç’°å¢ƒ | `i686-pc-windows-msvc` ã‚¿ãƒ¼ã‚²ãƒƒãƒˆå¿…é ˆ |

## System Flows

### ãƒ¡ã‚¤ãƒ³ãƒªãƒªãƒ¼ã‚¹ãƒ•ãƒ­ãƒ¼

```mermaid
sequenceDiagram
    participant Dev as é–‹ç™ºè€…
    participant LLM as LLM Agent
    participant Term as Terminal
    participant FS as File System
    participant GH as GitHub

    Note over Dev,GH: Phase 0: å‰ææ¡ä»¶ç¢ºèª
    LLM->>Term: Test-Path credentials.toml
    Term-->>LLM: çµæœ
    alt èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³æœªè¨­å®š
        LLM->>Dev: cargo login ã®ã‚¬ã‚¤ãƒ€ãƒ³ã‚¹æç¤º
        Dev-->>LLM: ãƒˆãƒ¼ã‚¯ãƒ³è¨­å®šå®Œäº†
    end

    Note over Dev,GH: Phase 1: äº‹å‰æ¤œè¨¼
    LLM->>Dev: ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç•ªå·ç¢ºèªï¼ˆPATCH+1 ææ¡ˆï¼‰
    Dev-->>LLM: ãƒãƒ¼ã‚¸ãƒ§ãƒ³æ‰¿èª
    LLM->>Term: git status
    alt æœªã‚³ãƒŸãƒƒãƒˆå¤‰æ›´ã‚ã‚Š
        LLM->>Term: git add -A && git commit
    end
    LLM->>Term: cargo test --all
    alt ãƒ†ã‚¹ãƒˆå¤±æ•—
        LLM->>Dev: ã‚¨ãƒ©ãƒ¼å ±å‘Šãƒ»ä¸­æ­¢
    end

    Note over Dev,GH: Phase 2: ãƒãƒ¼ã‚¸ãƒ§ãƒ³æ›´æ–°
    LLM->>FS: Cargo.toml 4ç®‡æ‰€æ›´æ–°
    LLM->>Term: cargo build --workspace
    alt ãƒ“ãƒ«ãƒ‰å¤±æ•—
        LLM->>Term: git restore Cargo.toml
        LLM->>Dev: ã‚¨ãƒ©ãƒ¼å ±å‘Šãƒ»ä¸­æ­¢
    end
    LLM->>Term: git commit

    Note over Dev,GH: Phase 3: crates.io å…¬é–‹
    loop pasta_core, pasta_lua, pasta_shiori
        LLM->>Term: cargo publish -p crate
        alt å¤±æ•—ï¼ˆæœ€å¤§2å›ãƒªãƒˆãƒ©ã‚¤ï¼‰
            LLM->>Dev: ã‚¨ãƒ©ãƒ¼å ±å‘Šãƒ»ä¸­æ–­
        end
        LLM->>Term: Start-Sleep 10
    end

    Note over Dev,GH: Phase 4: ã‚´ãƒ¼ã‚¹ãƒˆãƒ“ãƒ«ãƒ‰
    LLM->>Term: release.ps1
    LLM->>Term: git commit

    Note over Dev,GH: Phase 5: ã‚¿ã‚°ã¨ãƒ—ãƒƒã‚·ãƒ¥
    LLM->>Term: git tag -a vX.Y.Z
    LLM->>Term: git push origin main --tags

    Note over Dev,GH: Phase 6: GitHub Release
    LLM->>Term: git log å‰å›ã‚¿ã‚°..HEAD
    LLM->>LLM: ãƒã‚§ãƒ³ã‚¸ãƒ­ã‚°æ•´å½¢
    LLM->>Term: gh release create
    LLM->>Dev: ãƒªãƒªãƒ¼ã‚¹å®Œäº†ã‚µãƒãƒªãƒ¼
```

### ã‚¨ãƒ©ãƒ¼æ™‚ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒ•ãƒ­ãƒ¼

```mermaid
flowchart TD
    A{ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿãƒ•ã‚§ãƒ¼ã‚º} --> B{Phase 0-1}
    A --> C{Phase 2}
    A --> D{Phase 3}
    A --> E{Phase 4}
    A --> F{Phase 5-6}

    B --> B1[ä½œæ¥­ä¸è¦ - å¤‰æ›´ãªã—]
    C --> C1[git restore Cargo.toml]
    D --> D1[ä¸­æ–­ã®ã¿ - æ—¢å…¬é–‹ã‚¯ãƒ¬ãƒ¼ãƒˆã¯æ®‹ã™]
    D1 --> D2[æ¬¡å›ãƒªãƒªãƒ¼ã‚¹ã§å¯¾å‡¦]
    E --> E1[ã‚¨ãƒ©ãƒ¼å ±å‘Š - æ‰‹å‹•å¯¾å¿œ]
    F --> F1[ã‚¨ãƒ©ãƒ¼å ±å‘Š - æ‰‹å‹•å¯¾å¿œ]
```

## Requirements Traceability

| Requirement | Summary | Components | Flows |
|-------------|---------|------------|-------|
| 1.1 | ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç•ªå·æŒ‡å®šæ™‚ã«ä½¿ç”¨ | Phase 1 | ãƒ¡ã‚¤ãƒ³ãƒ•ãƒ­ãƒ¼: ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç¢ºèª |
| 1.2 | PATCH è‡ªå‹•ã‚¤ãƒ³ã‚¯ãƒªãƒ¡ãƒ³ãƒˆ | Phase 1 | ãƒ¡ã‚¤ãƒ³ãƒ•ãƒ­ãƒ¼: ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç¢ºèª |
| 1.3 | ææ¡ˆãƒãƒ¼ã‚¸ãƒ§ãƒ³æ‰¿èªç¢ºèª | Phase 1 | ãƒ¡ã‚¤ãƒ³ãƒ•ãƒ­ãƒ¼: ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç¢ºèª |
| 1.4 | æ‰¿èªæ‹’å¦æ™‚ã®å†å…¥åŠ› | Phase 1 | ãƒ¡ã‚¤ãƒ³ãƒ•ãƒ­ãƒ¼: ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç¢ºèª |
| 1.5 | semver å¦¥å½“æ€§æ¤œè¨¼ | Phase 1 | ãƒ¡ã‚¤ãƒ³ãƒ•ãƒ­ãƒ¼: ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç¢ºèª |
| 1.6 | semver å½¢å¼ã‚¨ãƒ©ãƒ¼å ±å‘Š | Phase 1 | ãƒ¡ã‚¤ãƒ³ãƒ•ãƒ­ãƒ¼: ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç¢ºèª |
| 1.7 | git status ç¢ºèª | Phase 1 | ãƒ¡ã‚¤ãƒ³ãƒ•ãƒ­ãƒ¼: äº‹å‰æ¤œè¨¼ |
| 1.8 | æœªã‚³ãƒŸãƒƒãƒˆå¤‰æ›´ã®è‡ªå‹•ã‚³ãƒŸãƒƒãƒˆ | Phase 1 | ãƒ¡ã‚¤ãƒ³ãƒ•ãƒ­ãƒ¼: äº‹å‰æ¤œè¨¼ |
| 1.9 | cargo test å®Ÿè¡Œ | Phase 1 | ãƒ¡ã‚¤ãƒ³ãƒ•ãƒ­ãƒ¼: äº‹å‰æ¤œè¨¼ |
| 1.10 | ãƒ†ã‚¹ãƒˆå¤±æ•—æ™‚ä¸­æ­¢ | Phase 1 | ã‚¨ãƒ©ãƒ¼ãƒ•ãƒ­ãƒ¼: Phase 0-1 |
| 2.1 | workspace.package.version æ›´æ–° | Phase 2 | ãƒ¡ã‚¤ãƒ³ãƒ•ãƒ­ãƒ¼: ãƒãƒ¼ã‚¸ãƒ§ãƒ³æ›´æ–° |
| 2.2 | workspace.dependencies å†…éƒ¨ã‚¯ãƒ¬ãƒ¼ãƒˆå‚ç…§æ›´æ–° | Phase 2 | ãƒ¡ã‚¤ãƒ³ãƒ•ãƒ­ãƒ¼: ãƒãƒ¼ã‚¸ãƒ§ãƒ³æ›´æ–° |
| 2.3 | cargo build æ¤œè¨¼ | Phase 2 | ãƒ¡ã‚¤ãƒ³ãƒ•ãƒ­ãƒ¼: ãƒãƒ¼ã‚¸ãƒ§ãƒ³æ›´æ–° |
| 2.4 | ãƒ“ãƒ«ãƒ‰å¤±æ•—æ™‚ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ | Phase 2 | ã‚¨ãƒ©ãƒ¼ãƒ•ãƒ­ãƒ¼: Phase 2 |
| 2.5 | ãƒãƒ¼ã‚¸ãƒ§ãƒ³æ›´æ–°ã‚³ãƒŸãƒƒãƒˆ | Phase 2 | ãƒ¡ã‚¤ãƒ³ãƒ•ãƒ­ãƒ¼: ãƒãƒ¼ã‚¸ãƒ§ãƒ³æ›´æ–° |
| 3.1 | ä¾å­˜é–¢ä¿‚é † cargo publish | Phase 3 | ãƒ¡ã‚¤ãƒ³ãƒ•ãƒ­ãƒ¼: crates.io å…¬é–‹ |
| 3.2 | å…¬é–‹æˆåŠŸç¢ºèªå¾Œã«æ¬¡ã‚¯ãƒ¬ãƒ¼ãƒˆ | Phase 3 | ãƒ¡ã‚¤ãƒ³ãƒ•ãƒ­ãƒ¼: crates.io å…¬é–‹ |
| 3.3 | æœ€å¤§2å›ãƒªãƒˆãƒ©ã‚¤ | Phase 3 | ãƒ¡ã‚¤ãƒ³ãƒ•ãƒ­ãƒ¼: crates.io å…¬é–‹ |
| 3.4 | ãƒªãƒˆãƒ©ã‚¤å¾Œå¤±æ•—æ™‚ä¸­æ–­ | Phase 3 | ã‚¨ãƒ©ãƒ¼ãƒ•ãƒ­ãƒ¼: Phase 3 |
| 3.5 | pasta_sample_ghost ã‚¹ã‚­ãƒƒãƒ— | Phase 3 | ãƒ¡ã‚¤ãƒ³ãƒ•ãƒ­ãƒ¼: crates.io å…¬é–‹ |
| 3.6 | å…¬é–‹é–“10ç§’å¾…æ©Ÿ | Phase 3 | ãƒ¡ã‚¤ãƒ³ãƒ•ãƒ­ãƒ¼: crates.io å…¬é–‹ |
| 4.1 | release.ps1 å®Ÿè¡Œ | Phase 4 | ãƒ¡ã‚¤ãƒ³ãƒ•ãƒ­ãƒ¼: ã‚´ãƒ¼ã‚¹ãƒˆãƒ“ãƒ«ãƒ‰ |
| 4.2 | hello-pasta.nar ç¢ºèª | Phase 4 | ãƒ¡ã‚¤ãƒ³ãƒ•ãƒ­ãƒ¼: ã‚´ãƒ¼ã‚¹ãƒˆãƒ“ãƒ«ãƒ‰ |
| 4.3 | pasta.dll ç¢ºèª | Phase 4 | ãƒ¡ã‚¤ãƒ³ãƒ•ãƒ­ãƒ¼: ã‚´ãƒ¼ã‚¹ãƒˆãƒ“ãƒ«ãƒ‰ |
| 4.4 | release.ps1 å¤±æ•—æ™‚ä¸­æ–­ | Phase 4 | ã‚¨ãƒ©ãƒ¼ãƒ•ãƒ­ãƒ¼: Phase 4 |
| 4.5 | ã‚´ãƒ¼ã‚¹ãƒˆãƒ“ãƒ«ãƒ‰ã‚³ãƒŸãƒƒãƒˆ | Phase 4 | ãƒ¡ã‚¤ãƒ³ãƒ•ãƒ­ãƒ¼: ã‚´ãƒ¼ã‚¹ãƒˆãƒ“ãƒ«ãƒ‰ |
| 5.1 | ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã‚¿ã‚°ä½œæˆ | Phase 5 | ãƒ¡ã‚¤ãƒ³ãƒ•ãƒ­ãƒ¼: ã‚¿ã‚°ã¨ãƒ—ãƒƒã‚·ãƒ¥ |
| 5.2 | ã‚¿ã‚°ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¨­å®š | Phase 5 | ãƒ¡ã‚¤ãƒ³ãƒ•ãƒ­ãƒ¼: ã‚¿ã‚°ã¨ãƒ—ãƒƒã‚·ãƒ¥ |
| 5.3 | æ—¢å­˜ã‚¿ã‚°ç«¶åˆæ™‚ã‚¨ãƒ©ãƒ¼ | Phase 5 | ã‚¨ãƒ©ãƒ¼ãƒ•ãƒ­ãƒ¼: Phase 5-6 |
| 5.4 | git push origin main --tags | Phase 5 | ãƒ¡ã‚¤ãƒ³ãƒ•ãƒ­ãƒ¼: ã‚¿ã‚°ã¨ãƒ—ãƒƒã‚·ãƒ¥ |
| 5.5 | ãƒ—ãƒƒã‚·ãƒ¥å¤±æ•—æ™‚å ±å‘Š | Phase 5 | ã‚¨ãƒ©ãƒ¼ãƒ•ãƒ­ãƒ¼: Phase 5-6 |
| 6.1 | git log ã§å±¥æ­´å–å¾— | Phase 6 | ãƒ¡ã‚¤ãƒ³ãƒ•ãƒ­ãƒ¼: GitHub Release |
| 6.2 | Conventional Commits åˆ†é¡ | Phase 6 | ãƒ¡ã‚¤ãƒ³ãƒ•ãƒ­ãƒ¼: GitHub Release |
| 6.3 | ã‚°ãƒ«ãƒ¼ãƒ—åˆ¥ãƒã‚§ãƒ³ã‚¸ãƒ­ã‚°æ•´å½¢ | Phase 6 | ãƒ¡ã‚¤ãƒ³ãƒ•ãƒ­ãƒ¼: GitHub Release |
| 6.4 | gh release create å®Ÿè¡Œ | Phase 6 | ãƒ¡ã‚¤ãƒ³ãƒ•ãƒ­ãƒ¼: GitHub Release |
| 6.5 | ã‚¿ã‚¤ãƒˆãƒ«è¨­å®š | Phase 6 | ãƒ¡ã‚¤ãƒ³ãƒ•ãƒ­ãƒ¼: GitHub Release |
| 6.6 | ãƒã‚§ãƒ³ã‚¸ãƒ­ã‚°ã‚’ãƒªãƒªãƒ¼ã‚¹ãƒãƒ¼ãƒˆã«å«ã‚ã‚‹ | Phase 6 | ãƒ¡ã‚¤ãƒ³ãƒ•ãƒ­ãƒ¼: GitHub Release |
| 6.7 | ã‚¢ã‚»ãƒƒãƒˆæ·»ä»˜ï¼ˆpasta.dll, hello-pasta.narï¼‰ | Phase 6 | ãƒ¡ã‚¤ãƒ³ãƒ•ãƒ­ãƒ¼: GitHub Release |
| 6.8 | gh å¤±æ•—æ™‚æ‰‹å‹•æ‰‹é †æ¡ˆå†… | Phase 6 | ã‚¨ãƒ©ãƒ¼ãƒ•ãƒ­ãƒ¼: Phase 5-6 |
| 6.9 | åˆå›ãƒªãƒªãƒ¼ã‚¹æ™‚ã®å…¨å±¥æ­´ä½¿ç”¨ | Phase 6 | ãƒ¡ã‚¤ãƒ³ãƒ•ãƒ­ãƒ¼: GitHub Release |
| 7.1 | ã‚¿ã‚¹ã‚¯çŠ¶æ…‹åˆæœŸåŒ– | â€” | ç¹°ã‚Šè¿”ã—å®Ÿè¡Œã®ä»•æ§˜ç‰¹æ€§ |
| 7.2 | phase ã‚’ completed ã«ã—ãªã„ | â€” | ç¹°ã‚Šè¿”ã—å®Ÿè¡Œã®ä»•æ§˜ç‰¹æ€§ |
| 7.3 | ç‹¬ç«‹ã—ãŸä½œæ¥­ã¨ã—ã¦å‹•ä½œ | â€” | ç¹°ã‚Šè¿”ã—å®Ÿè¡Œã®ä»•æ§˜ç‰¹æ€§ |
| 7.4 | å®Œäº†ã‚µãƒãƒªãƒ¼å ±å‘Š | Phase 6 | ãƒ¡ã‚¤ãƒ³ãƒ•ãƒ­ãƒ¼: æœ€çµ‚å ±å‘Š |

## Components and Interfaces

| Component | Domain/Layer | Intent | Req Coverage | Key Dependencies | Contracts |
|-----------|-------------|--------|--------------|-----------------|-----------|
| Phase 0: Prerequisites | æ¤œè¨¼ | å‰ææ¡ä»¶ã®ç¢ºèª | â€” | cargo credentials (P0), gh auth (P0) | â€” |
| Phase 1: Validation | æ¤œè¨¼ | ãƒãƒ¼ã‚¸ãƒ§ãƒ³æ±ºå®šã¨äº‹å‰æ¤œè¨¼ | 1.1â€“1.10 | Cargo.toml (P0), cargo test (P0), git (P0) | â€” |
| Phase 2: VersionBump | å®Ÿè¡Œ | Cargo.toml ãƒãƒ¼ã‚¸ãƒ§ãƒ³æ›´æ–° | 2.1â€“2.5 | Cargo.toml (P0), cargo build (P0) | â€” |
| Phase 3: Publish | å®Ÿè¡Œ | crates.io å…¬é–‹ | 3.1â€“3.6 | cargo publish (P0), crates.io index (P1) | â€” |
| Phase 4: GhostBuild | å®Ÿè¡Œ | ã‚µãƒ³ãƒ—ãƒ«ã‚´ãƒ¼ã‚¹ãƒˆãƒ“ãƒ«ãƒ‰ | 4.1â€“4.5 | release.ps1 (P0), i686-pc-windows-msvc (P0) | â€” |
| Phase 5: TagPush | å®Ÿè¡Œ | Git ã‚¿ã‚°ä½œæˆã¨ãƒ—ãƒƒã‚·ãƒ¥ | 5.1â€“5.5 | git (P0), GitHub remote (P0) | â€” |
| Phase 6: Release | å®Ÿè¡Œ | GitHub Release ä½œæˆ | 6.1â€“6.9, 7.4 | gh CLI (P0), git log (P0) | â€” |

### æ¤œè¨¼ãƒ¬ã‚¤ãƒ¤ãƒ¼

#### Phase 0: Prerequisites

| Field | Detail |
|-------|--------|
| Intent | ãƒªãƒªãƒ¼ã‚¹å®Ÿè¡Œã«å¿…è¦ãªå¤–éƒ¨ãƒ„ãƒ¼ãƒ«ã®èªè¨¼çŠ¶æ…‹ã‚’ç¢ºèªã™ã‚‹ |
| Requirements | â€” ï¼ˆæš—é»™çš„å‰ææ¡ä»¶ï¼‰ |

**Responsibilities & Constraints**
- `cargo publish` ã®èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³ï¼ˆ`~/.cargo/credentials.toml`ï¼‰ã®å­˜åœ¨ç¢ºèª
- `gh auth status` ã«ã‚ˆã‚‹ GitHub CLI ã®èªè¨¼çŠ¶æ…‹ç¢ºèª
- æœªè¨­å®šæ™‚ã¯ã‚¬ã‚¤ãƒ€ãƒ³ã‚¹ã‚’æç¤ºã—ã€è¨­å®šå®Œäº†ã‚’å¾…ã¤

**Dependencies**
- External: `~/.cargo/credentials.toml` â€” cargo publish èªè¨¼ (P0)
- External: `gh` CLI èªè¨¼ â€” GitHub Release ä½œæˆ (P0)

**å®Ÿè¡Œæ‰‹é †**

1. **cargo credentials ç¢ºèª**:
   ```
   Test-Path "$env:USERPROFILE\.cargo\credentials.toml"
   ```
   - `False` ã®å ´åˆ: ã€Œ`cargo login` ã‚’å®Ÿè¡Œã—ã¦ crates.io ã®APIãƒˆãƒ¼ã‚¯ãƒ³ã‚’è¨­å®šã—ã¦ãã ã•ã„ã€ã¨ã‚¬ã‚¤ãƒ€ãƒ³ã‚¹
   - ãƒˆãƒ¼ã‚¯ãƒ³å–å¾—å…ˆ: https://crates.io/settings/tokens

2. **gh auth ç¢ºèª**:
   ```
   gh auth status
   ```
   - èªè¨¼æ¸ˆã¿ãªã‚‰ç¶šè¡Œ
   - æœªèªè¨¼ã®å ´åˆ: ã€Œ`gh auth login` ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€ã¨ã‚¬ã‚¤ãƒ€ãƒ³ã‚¹

#### Phase 1: Validation

| Field | Detail |
|-------|--------|
| Intent | ãƒªãƒªãƒ¼ã‚¹ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’æ±ºå®šã—ã€ãƒ¯ãƒ¼ã‚¯ãƒ„ãƒªãƒ¼ã¨ãƒ†ã‚¹ãƒˆã®å¥å…¨æ€§ã‚’æ¤œè¨¼ã™ã‚‹ |
| Requirements | 1.1, 1.2, 1.3, 1.4, 1.5, 1.6, 1.7, 1.8, 1.9, 1.10 |

**Responsibilities & Constraints**
- ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç•ªå·ã®æ±ºå®šï¼ˆæŒ‡å®š or PATCH+1 è‡ªå‹•ææ¡ˆï¼‰
- semver å½¢å¼ã®å¦¥å½“æ€§æ¤œè¨¼
- æœªã‚³ãƒŸãƒƒãƒˆå¤‰æ›´ã®è‡ªå‹•ã‚³ãƒŸãƒƒãƒˆï¼ˆå®‰å…¨ãªãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯åŸºç›¤ã®ç¢ºç«‹ï¼‰
- å…¨ãƒ†ã‚¹ãƒˆã®é€šéç¢ºèª

**Dependencies**
- Inbound: Phase 0 ã®å‰ææ¡ä»¶å……è¶³ (P0)
- External: `Cargo.toml` â€” ç¾åœ¨ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®èª­ã¿å–ã‚Š (P0)
- External: `cargo test` â€” ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ (P0)
- External: `git` â€” ãƒ¯ãƒ¼ã‚¯ãƒ„ãƒªãƒ¼çŠ¶æ…‹ç¢ºèª (P0)

**å®Ÿè¡Œæ‰‹é †**

1. **ãƒãƒ¼ã‚¸ãƒ§ãƒ³æ±ºå®š** (1.1â€“1.6):
   - é–‹ç™ºè€…ã‹ã‚‰ãƒãƒ¼ã‚¸ãƒ§ãƒ³æŒ‡å®šãŒã‚ã‚‹å ´åˆ â†’ ãã®ã¾ã¾ä½¿ç”¨ (1.1)
   - æŒ‡å®šãŒãªã„å ´åˆ â†’ `Cargo.toml` ã® `[workspace.package].version` ã‚’èª­ã¿å–ã‚Šã€PATCH ã‚’ +1 (1.2)
   - ææ¡ˆå½¢å¼: ã€Œv0.1.2 ã‹ã‚‰ v0.1.3 ã«æ›´æ–°ã—ã¾ã™ã€‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿã€ (1.3)
   - æ‹’å¦ã•ã‚ŒãŸå ´åˆ â†’ å¸Œæœ›ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®å…¥åŠ›ã‚’æ±‚ã‚ã‚‹ (1.4)
   - semver å½¢å¼ãƒã‚§ãƒƒã‚¯: `X.Y.Z` ã®æ•°å€¤3çµ„ï¼ˆ`^[0-9]+\.[0-9]+\.[0-9]+$`ï¼‰ (1.5, 1.6)

2. **ãƒ¯ãƒ¼ã‚¯ãƒ„ãƒªãƒ¼æ•´ç†** (1.7, 1.8):
   ```
   git status --porcelain
   ```
   - å‡ºåŠ›ãŒã‚ã‚‹å ´åˆ:
     ```
     git add -A
     git commit -m "chore(release): prepare release vX.Y.Z"
     ```
   - å‡ºåŠ›ãŒç©ºã®å ´åˆ: ã‚¹ã‚­ãƒƒãƒ—

3. **ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ** (1.9, 1.10):
   ```
   cargo test --all
   ```
   - æˆåŠŸ: æ¬¡ã®ãƒ•ã‚§ãƒ¼ã‚ºã¸
   - å¤±æ•—: ã‚¨ãƒ©ãƒ¼å†…å®¹ã‚’å ±å‘Šã—ã€ãƒªãƒªãƒ¼ã‚¹ä½œæ¥­ã‚’ä¸­æ­¢

### å®Ÿè¡Œãƒ¬ã‚¤ãƒ¤ãƒ¼

#### Phase 2: VersionBump

| Field | Detail |
|-------|--------|
| Intent | ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹å…¨ä½“ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«ä¸€æ‹¬æ›´æ–°ã—ã€ãƒ“ãƒ«ãƒ‰æ¤œè¨¼ã™ã‚‹ |
| Requirements | 2.1, 2.2, 2.3, 2.4, 2.5 |

**Responsibilities & Constraints**
- `Cargo.toml` ã®4ç®‡æ‰€ã‚’æ­£ç¢ºã«æ›´æ–°
- ãƒ“ãƒ«ãƒ‰æ¤œè¨¼ã«ã‚ˆã‚‹ãƒãƒ¼ã‚¸ãƒ§ãƒ³æ•´åˆæ€§ã®ç¢ºèª
- å¤±æ•—æ™‚ã¯ `git restore Cargo.toml` ã§å®‰å…¨ã«ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯

**Dependencies**
- Inbound: Phase 1 ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç¢ºå®š (P0)
- External: `Cargo.toml`ï¼ˆãƒ«ãƒ¼ãƒˆï¼‰ â€” ç·¨é›†å¯¾è±¡ (P0)
- External: `cargo build` â€” ãƒ“ãƒ«ãƒ‰æ¤œè¨¼ (P0)

**å®Ÿè¡Œæ‰‹é †**

1. **Cargo.toml æ›´æ–°** (2.1, 2.2):
   - `replace_string_in_file` ã§ä»¥ä¸‹ã®4ç®‡æ‰€ã‚’æ›´æ–°:
     - `[workspace.package]` ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã® `version = "<OLD>"` â†’ `version = "<NEW>"`
     - `pasta_core = { path = "crates/pasta_core", version = "<OLD>" }` â†’ `version = "<NEW>"`
     - `pasta_lua = { path = "crates/pasta_lua", version = "<OLD>" }` â†’ `version = "<NEW>"`
     - `pasta_shiori = { path = "crates/pasta_shiori", version = "<OLD>" }` â†’ `version = "<NEW>"`

2. **ãƒ“ãƒ«ãƒ‰æ¤œè¨¼** (2.3):
   ```
   cargo build --workspace
   ```

3. **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°** (2.4):
   - ãƒ“ãƒ«ãƒ‰å¤±æ•—æ™‚:
     ```
     git restore Cargo.toml
     ```
   - ã‚¨ãƒ©ãƒ¼å†…å®¹ã‚’å ±å‘Šã—ä¸­æ­¢

4. **ã‚³ãƒŸãƒƒãƒˆ** (2.5):
   ```
   git add Cargo.toml
   git commit -m "chore(release): bump version to vX.Y.Z"
   ```

#### Phase 3: Publish

| Field | Detail |
|-------|--------|
| Intent | ä¾å­˜é–¢ä¿‚é †ã«3ã‚¯ãƒ¬ãƒ¼ãƒˆã‚’ crates.io ã«å…¬é–‹ã™ã‚‹ |
| Requirements | 3.1, 3.2, 3.3, 3.4, 3.5, 3.6 |

**Responsibilities & Constraints**
- ä¾å­˜é–¢ä¿‚é †ï¼ˆ`pasta_core` â†’ `pasta_lua` â†’ `pasta_shiori`ï¼‰ã‚’å³å®ˆ
- å„ã‚¯ãƒ¬ãƒ¼ãƒˆå…¬é–‹å¾Œã«10ç§’å¾…æ©Ÿï¼ˆcrates.io ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹æ›´æ–°å¾…ã¡ï¼‰
- å¤±æ•—æ™‚ã¯æœ€å¤§2å›ãƒªãƒˆãƒ©ã‚¤ã€ãã‚Œã§ã‚‚å¤±æ•—ãªã‚‰ä¸­æ–­
- `pasta_sample_ghost`ï¼ˆ`publish = false`ï¼‰ã¯ã‚¹ã‚­ãƒƒãƒ—

**Dependencies**
- Inbound: Phase 2 ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³æ›´æ–°ã‚³ãƒŸãƒƒãƒˆ (P0)
- External: `cargo publish` â€” crates.io å…¬é–‹ (P0)
- External: crates.io index â€” ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹æ›´æ–°å¾…ã¡ (P1)
- External: `~/.cargo/credentials.toml` â€” èªè¨¼ (P0)

**å®Ÿè¡Œæ‰‹é †**

å…¬é–‹å¯¾è±¡ã‚¯ãƒ¬ãƒ¼ãƒˆãƒªã‚¹ãƒˆï¼ˆé †åºå›ºå®šï¼‰:
1. `pasta_core`
2. `pasta_lua`
3. `pasta_shiori`

å„ã‚¯ãƒ¬ãƒ¼ãƒˆã«å¯¾ã—ã¦ä»¥ä¸‹ã‚’å®Ÿè¡Œ:

1. **å…¬é–‹** (3.1, 3.2):
   ```
   cargo publish -p <crate_name>
   ```

2. **ãƒªãƒˆãƒ©ã‚¤** (3.3, 3.4):
   - å¤±æ•—æ™‚: æœ€å¤§2å›ãƒªãƒˆãƒ©ã‚¤ï¼ˆåˆè¨ˆ3å›è©¦è¡Œï¼‰
   - 3å›å¤±æ•—:
     - ã‚¨ãƒ©ãƒ¼ã‚’å ±å‘Š
     - æ—¢ã«å…¬é–‹æ¸ˆã¿ã®ã‚¯ãƒ¬ãƒ¼ãƒˆã¯ãã®ã¾ã¾æ®‹ã™
     - ä»¥é™ã®å…¬é–‹ã‚’ä¸­æ–­
     - ã€Œæ‰‹å‹• yank ã¾ãŸã¯æ¬¡å›ãƒªãƒªãƒ¼ã‚¹ã§å¯¾å‡¦ã—ã¦ãã ã•ã„ã€ã¨æ¡ˆå†…

3. **å¾…æ©Ÿ** (3.6):
   ```
   Start-Sleep -Seconds 10
   ```
   - æœ€å¾Œã®ã‚¯ãƒ¬ãƒ¼ãƒˆï¼ˆ`pasta_shiori`ï¼‰å…¬é–‹å¾Œã¯å¾…æ©Ÿä¸è¦

#### Phase 4: GhostBuild

| Field | Detail |
|-------|--------|
| Intent | x86 ãƒªãƒªãƒ¼ã‚¹ãƒ“ãƒ«ãƒ‰ã® pasta.dll ã¨ã‚µãƒ³ãƒ—ãƒ«ã‚´ãƒ¼ã‚¹ãƒˆ hello-pasta.nar ã‚’ç”Ÿæˆã™ã‚‹ |
| Requirements | 4.1, 4.2, 4.3, 4.4, 4.5 |

**Responsibilities & Constraints**
- `release.ps1` ã‚’ `crates/pasta_sample_ghost/` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§å®Ÿè¡Œ
- æˆæœç‰©ï¼ˆ`hello-pasta.nar`, `pasta.dll`ï¼‰ã®å­˜åœ¨ç¢ºèª
- å¤±æ•—æ™‚ã¯ãƒªãƒªãƒ¼ã‚¹ä½œæ¥­ä¸­æ–­

**Dependencies**
- Inbound: Phase 3 ã® crates.io å…¬é–‹å®Œäº† (P0)
- External: `release.ps1` â€” ã‚´ãƒ¼ã‚¹ãƒˆãƒ“ãƒ«ãƒ‰ã‚¹ã‚¯ãƒªãƒ—ãƒˆ (P0)
- External: `i686-pc-windows-msvc` â€” 32bit ãƒ“ãƒ«ãƒ‰ã‚¿ãƒ¼ã‚²ãƒƒãƒˆ (P0)

**å®Ÿè¡Œæ‰‹é †**

1. **ãƒ“ãƒ«ãƒ‰å®Ÿè¡Œ** (4.1):
   ```
   Push-Location crates/pasta_sample_ghost
   PowerShell -ExecutionPolicy Bypass -File release.ps1
   Pop-Location
   ```

2. **æˆæœç‰©ç¢ºèª** (4.2, 4.3):
   ```
   Test-Path "crates/pasta_sample_ghost/hello-pasta.nar"
   Test-Path "target/i686-pc-windows-msvc/release/pasta.dll"
   ```
   - ã„ãšã‚Œã‹ãŒ `False`: ã‚¨ãƒ©ãƒ¼å ±å‘Šã—ä¸­æ–­ (4.4)

3. **ã‚³ãƒŸãƒƒãƒˆ** (4.5):
   ```
   git add -A
   git commit -m "chore(release): build hello-pasta vX.Y.Z"
   ```

#### Phase 5: TagPush

| Field | Detail |
|-------|--------|
| Intent | ãƒªãƒªãƒ¼ã‚¹ãƒã‚¤ãƒ³ãƒˆã‚’ Git ã‚¿ã‚°ã§è¨˜éŒ²ã—ã€ãƒªãƒ¢ãƒ¼ãƒˆã«åæ˜ ã™ã‚‹ |
| Requirements | 5.1, 5.2, 5.3, 5.4, 5.5 |

**Responsibilities & Constraints**
- ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã‚¿ã‚°ï¼ˆ`-a`ï¼‰ã‚’ä½¿ç”¨
- æ—¢å­˜ã‚¿ã‚°ç«¶åˆæ™‚ã¯è‡ªå‹•å‰Šé™¤ã›ãšã€é–‹ç™ºè€…ã«ç¢ºèª
- ãƒ—ãƒƒã‚·ãƒ¥å¤±æ•—æ™‚ã¯æ‰‹å‹•å¯¾å¿œã‚’æ¡ˆå†…

**Dependencies**
- Inbound: Phase 4 ã®ã‚´ãƒ¼ã‚¹ãƒˆãƒ“ãƒ«ãƒ‰ã‚³ãƒŸãƒƒãƒˆ (P0)
- External: `git` â€” ã‚¿ã‚°ãƒ»ãƒ—ãƒƒã‚·ãƒ¥ (P0)
- External: GitHub remote â€” ãƒ—ãƒƒã‚·ãƒ¥å…ˆ (P0)

**å®Ÿè¡Œæ‰‹é †**

1. **æ—¢å­˜ã‚¿ã‚°ç¢ºèª** (5.3):
   ```
   git tag -l "vX.Y.Z"
   ```
   - å‡ºåŠ›ãŒã‚ã‚‹å ´åˆ: ã€Œã‚¿ã‚° vX.Y.Z ã¯æ—¢ã«å­˜åœ¨ã—ã¾ã™ã€‚æ—¢å­˜ã‚¿ã‚°ã®å‰Šé™¤ãŒå¿…è¦ã§ã™ã€‚æ‰‹å‹•ã§ `git tag -d vX.Y.Z` ã‚’å®Ÿè¡Œã—ã¾ã™ã‹ï¼Ÿã€ã¨ç¢ºèª

2. **ã‚¿ã‚°ä½œæˆ** (5.1, 5.2):
   ```
   git tag -a vX.Y.Z -m "Release vX.Y.Z"
   ```

3. **ãƒ—ãƒƒã‚·ãƒ¥** (5.4, 5.5):
   ```
   git push origin main --tags
   ```
   - å¤±æ•—æ™‚: ã‚¨ãƒ©ãƒ¼å ±å‘Šã—ã€Œæ‰‹å‹•ã§ `git push origin main --tags` ã‚’å†å®Ÿè¡Œã—ã¦ãã ã•ã„ã€ã¨æ¡ˆå†…

#### Phase 6: Release

| Field | Detail |
|-------|--------|
| Intent | ãƒã‚§ãƒ³ã‚¸ãƒ­ã‚°ä»˜ãã® GitHub Release ã‚’ä½œæˆã—ã€ãƒ“ãƒ«ãƒ‰æˆæœç‰©ã‚’æ·»ä»˜ã™ã‚‹ |
| Requirements | 6.1, 6.2, 6.3, 6.4, 6.5, 6.6, 6.7, 6.8, 6.9, 7.4 |

**Responsibilities & Constraints**
- `git log` ã‹ã‚‰ã‚³ãƒŸãƒƒãƒˆå±¥æ­´ã‚’å–å¾—ã—ã€LLM ãŒ Conventional Commits å½¢å¼ã§åˆ†é¡ãƒ»æ•´å½¢
- ä»•æ§˜ç®¡ç†ã‚³ãƒŸãƒƒãƒˆï¼ˆ`chore(spec):`, `docs(spec):` ç­‰ï¼‰ã¯ãƒã‚§ãƒ³ã‚¸ãƒ­ã‚°ã‹ã‚‰é™¤å¤–
- GitHub Release ã«ãƒªãƒªãƒ¼ã‚¹ãƒãƒ¼ãƒˆã¨ã‚¢ã‚»ãƒƒãƒˆï¼ˆ2ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰ã‚’æ·»ä»˜

**Dependencies**
- Inbound: Phase 5 ã®ã‚¿ã‚°ãƒ—ãƒƒã‚·ãƒ¥å®Œäº† (P0)
- External: `git log` â€” ã‚³ãƒŸãƒƒãƒˆå±¥æ­´å–å¾— (P0)
- External: `gh` CLI â€” GitHub Release ä½œæˆ (P0)

**å®Ÿè¡Œæ‰‹é †**

1. **ã‚³ãƒŸãƒƒãƒˆå±¥æ­´å–å¾—** (6.1, 6.9):
   ```
   git tag -l "v*" --sort=-version:refname
   ```
   - å‰å›ã‚¿ã‚°ãŒå­˜åœ¨ã™ã‚‹å ´åˆ:
     ```
     git log <å‰å›ã‚¿ã‚°>..vX.Y.Z --oneline --no-merges
     ```
   - å‰å›ã‚¿ã‚°ãŒå­˜åœ¨ã—ãªã„å ´åˆï¼ˆåˆå›ãƒªãƒªãƒ¼ã‚¹ï¼‰:
     ```
     git log --oneline --no-merges
     ```

2. **ãƒã‚§ãƒ³ã‚¸ãƒ­ã‚°æ•´å½¢** (6.2, 6.3):
   LLM ãŒä»¥ä¸‹ã®ãƒ«ãƒ¼ãƒ«ã§ã‚³ãƒŸãƒƒãƒˆã‚’åˆ†é¡:

   **åˆ†é¡ãƒãƒƒãƒ”ãƒ³ã‚°**:

   | Conventional Prefix | ãƒã‚§ãƒ³ã‚¸ãƒ­ã‚°è¦‹å‡ºã— |
   |--------------------|--------------------|
   | `feat:` / `feat(*)` | âœ¨ Features |
   | `fix:` / `fix(*)` | ğŸ› Bug Fixes |
   | `refactor:` / `refactor(*)` | â™»ï¸ Refactoring |
   | `docs:` / `docs(*)` | ğŸ“ Documentation |
   | `test:` / `test(*)` | ğŸ§ª Tests |
   | `chore:` / `chore(*)` | ğŸ”§ Maintenance |

   **é™¤å¤–ãƒ«ãƒ¼ãƒ«**:
   - ã‚¹ã‚³ãƒ¼ãƒ—ãŒ `spec` ã®ã‚³ãƒŸãƒƒãƒˆï¼ˆ`chore(spec):`, `docs(spec):` ç­‰ï¼‰ã¯é™¤å¤–
   - ç©ºã«ãªã£ãŸã‚°ãƒ«ãƒ¼ãƒ—ã¯è¦‹å‡ºã—ã”ã¨çœç•¥

   **å‡ºåŠ›ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ**:
   ```markdown
   ## What's Changed

   ### âœ¨ Features
   - ã‚³ãƒŸãƒƒãƒˆã‚µãƒãƒªãƒ¼ (@author)

   ### ğŸ› Bug Fixes
   - ã‚³ãƒŸãƒƒãƒˆã‚µãƒãƒªãƒ¼ (@author)

   ### â™»ï¸ Refactoring
   - ã‚³ãƒŸãƒƒãƒˆã‚µãƒãƒªãƒ¼ (@author)

   ...

   **Full Changelog**: https://github.com/ekicyou/pasta/compare/<å‰å›ã‚¿ã‚°>...vX.Y.Z
   ```

3. **ãƒªãƒªãƒ¼ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ**:
   - ãƒã‚§ãƒ³ã‚¸ãƒ­ã‚°ã‚’ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«ã«æ›¸ãå‡ºã—ï¼ˆ`release-notes-vX.Y.Z.md`ï¼‰

4. **GitHub Release ä½œæˆ** (6.4, 6.5, 6.6, 6.7):
   ```
   gh release create vX.Y.Z `
     "target/i686-pc-windows-msvc/release/pasta.dll" `
     "crates/pasta_sample_ghost/hello-pasta.nar" `
     --title "pasta vX.Y.Z" `
     --notes-file release-notes-vX.Y.Z.md
   ```

5. **ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«å‰Šé™¤**:
   ```
   Remove-Item release-notes-vX.Y.Z.md
   ```

6. **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°** (6.8):
   - `gh` å¤±æ•—æ™‚:
     - ã‚¨ãƒ©ãƒ¼å ±å‘Š
     - æ‰‹å‹•æ‰‹é †ã‚’æ¡ˆå†…:
       ```
       gh release create vX.Y.Z ^
         "target/i686-pc-windows-msvc/release/pasta.dll" ^
         "crates/pasta_sample_ghost/hello-pasta.nar" ^
         --title "pasta vX.Y.Z" ^
         --notes-file release-notes-vX.Y.Z.md
       ```

7. **å®Œäº†ã‚µãƒãƒªãƒ¼** (7.4):
   - ãƒãƒ¼ã‚¸ãƒ§ãƒ³: `vX.Y.Z`
   - å…¬é–‹ã‚¯ãƒ¬ãƒ¼ãƒˆ: `pasta_core`, `pasta_lua`, `pasta_shiori`
   - Release URL: `https://github.com/ekicyou/pasta/releases/tag/vX.Y.Z`

## Error Handling

### Error Strategy

å„ãƒ•ã‚§ãƒ¼ã‚ºã¯**ã‚²ãƒ¼ãƒˆæ–¹å¼**ã§åˆ¶å¾¡ã•ã‚Œã€å¤±æ•—æ™‚ã¯ãã®ãƒ•ã‚§ãƒ¼ã‚ºã§åœæ­¢ã™ã‚‹ã€‚å¾Œç¶šãƒ•ã‚§ãƒ¼ã‚ºã¯å®Ÿè¡Œã•ã‚Œãªã„ã€‚

### Error Categories and Responses

| ãƒ•ã‚§ãƒ¼ã‚º | ã‚¨ãƒ©ãƒ¼ç¨®åˆ¥ | å¯¾å¿œ | ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ |
|---------|-----------|------|-------------|
| Phase 0 | èªè¨¼æœªè¨­å®š | ã‚¬ã‚¤ãƒ€ãƒ³ã‚¹æç¤º â†’ è¨­å®šå¾…ã¡ | ä¸è¦ |
| Phase 1 | ãƒ†ã‚¹ãƒˆå¤±æ•— | ã‚¨ãƒ©ãƒ¼å ±å‘Šãƒ»ä¸­æ­¢ | ä¸è¦ï¼ˆå¤‰æ›´ãªã—ï¼‰ |
| Phase 2 | ãƒ“ãƒ«ãƒ‰å¤±æ•— | `git restore Cargo.toml` | Cargo.toml å¾©å…ƒ |
| Phase 3 | cargo publish å¤±æ•— | æœ€å¤§2å›ãƒªãƒˆãƒ©ã‚¤ â†’ ä¸­æ–­ | æ—¢å…¬é–‹ã‚¯ãƒ¬ãƒ¼ãƒˆã¯æ®‹ã™ |
| Phase 4 | release.ps1 å¤±æ•— | ã‚¨ãƒ©ãƒ¼å ±å‘Šãƒ»ä¸­æ–­ | æ‰‹å‹•å¯¾å¿œ |
| Phase 5 | ã‚¿ã‚°ç«¶åˆ | é–‹ç™ºè€…ã«ç¢ºèª | æ‰‹å‹•å¯¾å¿œ |
| Phase 5 | ãƒ—ãƒƒã‚·ãƒ¥å¤±æ•— | ã‚¨ãƒ©ãƒ¼å ±å‘Š | æ‰‹å‹•ãƒªãƒˆãƒ©ã‚¤ |
| Phase 6 | gh å¤±æ•— | æ‰‹å‹•æ‰‹é †æ¡ˆå†… | æ‰‹å‹•å®Ÿè¡Œ |

### ã‚»ãƒƒã‚·ãƒ§ãƒ³ä¸­æ–­ã‹ã‚‰ã®å¾©æ—§

LLM ã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒé€”ä¸­ã§åˆ‡æ–­ã•ã‚ŒãŸå ´åˆã®å¾©æ—§æ‰‹é †:

1. `git log --oneline -5` ã§æœ€å¾Œã®ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç¢ºèª
2. ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‹ã‚‰é€²æ—ã‚’åˆ¤æ–­:
   - `chore(release): prepare release vX.Y.Z` â†’ Phase 1 å®Œäº†
   - `chore(release): bump version to vX.Y.Z` â†’ Phase 2 å®Œäº†
   - `chore(release): build hello-pasta vX.Y.Z` â†’ Phase 4 å®Œäº†
3. å®Œäº†æ¸ˆã¿ãƒ•ã‚§ãƒ¼ã‚ºã‚’ã‚¹ã‚­ãƒƒãƒ—ã—ã¦å†é–‹

## Testing Strategy

æœ¬ä»•æ§˜ã¯ã‚ªãƒšãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ä»•æ§˜ã§ã‚ã‚Šã€è‡ªå‹•ãƒ†ã‚¹ãƒˆã®å¯¾è±¡å¤–ã§ã‚ã‚‹ã€‚å“è³ªã¯ä»¥ä¸‹ã§æ‹…ä¿ã™ã‚‹:

- **Phase 1**: `cargo test --all` ã«ã‚ˆã‚‹å…¨ãƒ†ã‚¹ãƒˆé€šéã®ç¢ºèª
- **Phase 2**: `cargo build --workspace` ã«ã‚ˆã‚‹ãƒ“ãƒ«ãƒ‰æ¤œè¨¼
- **Phase 4**: `release.ps1` ã«ã‚ˆã‚‹æˆæœç‰©ç”Ÿæˆã¨å­˜åœ¨ç¢ºèª
- **Phase 6**: GitHub Release ã®ä½œæˆæˆåŠŸç¢ºèª

### æ‰‹å‹•æ¤œè¨¼é …ç›®

| ç¢ºèªé …ç›® | ç¢ºèªæ–¹æ³• | ã‚¿ã‚¤ãƒŸãƒ³ã‚° |
|----------|---------|-----------|
| crates.io ã«ã‚¯ãƒ¬ãƒ¼ãƒˆãŒå…¬é–‹ã•ã‚ŒãŸã‹ | https://crates.io/crates/pasta_core ã‚’ç¢ºèª | Phase 3 å®Œäº†å¾Œ |
| GitHub Release ã«ã‚¢ã‚»ãƒƒãƒˆãŒæ·»ä»˜ã•ã‚ŒãŸã‹ | Release ãƒšãƒ¼ã‚¸ã§ç¢ºèª | Phase 6 å®Œäº†å¾Œ |
| .nar ãƒ•ã‚¡ã‚¤ãƒ«ãŒæ­£å¸¸ã‹ | arekaã§èª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆ | ãƒªãƒªãƒ¼ã‚¹å¾Œï¼ˆä»»æ„ï¼‰ |

## ç¹°ã‚Šè¿”ã—å®Ÿè¡Œã®ä»•æ§˜ç‰¹æ€§

æœ¬ä»•æ§˜ã¯ Requirements 7 ã«åŸºã¥ãã€ä»¥ä¸‹ã®ç‰¹æ®Šãªé‹ç”¨ãƒ¢ãƒ‡ãƒ«ã‚’æŒã¤:

- `/kiro-spec-impl release-workflow` ãŒå®Ÿè¡Œã•ã‚Œã‚‹ãŸã³ã«ã€å…¨ã‚¿ã‚¹ã‚¯ã®çŠ¶æ…‹ã¯åˆæœŸåŒ–ã•ã‚Œã‚‹ (7.1)
- `spec.json` ã® `phase` ã¯ `completed` ã«é·ç§»ã›ãšã€`ready_for_implementation` ã‚’ç¶­æŒã™ã‚‹ (7.2)
- å„å®Ÿè¡Œã¯å‰å›ã®å®Ÿè¡ŒçŠ¶æ…‹ã«ä¾å­˜ã—ãªã„ç‹¬ç«‹ã—ãŸä½œæ¥­ã¨ã—ã¦å‹•ä½œã™ã‚‹ (7.3)
- å®Ÿè¡Œå®Œäº†æ™‚ã«ã‚µãƒãƒªãƒ¼ã‚’å ±å‘Šã™ã‚‹ (7.4)
