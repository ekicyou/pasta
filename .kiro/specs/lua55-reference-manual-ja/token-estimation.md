# トークン数見積もり

> 作成日: 2026-01-29
> 目的: AI翻訳時のトークン制限（100k tokens/call）に収まるか確認

## 換算ルール

- 英語テキスト: 1KB ≈ 250 tokens
- 日本語テキスト: 1KB ≈ 200 tokens
- GLOSSARY.md: 約 7KB ≈ 1,750 tokens（日本語混在）
- プロンプト固定部: 約 2,000 tokens

## 翻訳方式

| 分類 | サイズ | 翻訳プロンプト構成 |
|-----|--------|------------------|
| 小章 | <10KB | EN全文 + JA参考全文 + GLOSSARY + 固定部 |
| 中章 | 10-40KB | EN全文 + 用語抽出リスト + GLOSSARY + 固定部 |
| 大章 | >40KB | 節単位分割して小章扱い |

---

## 主要章トークン見積もり

### 単一ファイル章（サブ分割なし）

| 章 | EN Size | EN Tokens | JA Size | JA Tokens | 合計Tokens | 分類 | 判定 |
|---|---------|-----------|---------|-----------|-----------|------|------|
| 1章 Introduction | 2.3KB | 575 | 3.2KB | 640 | 4,965 | 小章 | ✅ |
| 2章 Basic Concepts | 40.1KB | 10,025 | 47.5KB | 9,500 | 23,275 | 中章 | ✅ |
| 5章 Auxiliary Library | 37.7KB | 9,425 | 42.4KB | 8,480 | 21,655 | 中章 | ✅ |
| 7章 Standalone | 6.4KB | 1,600 | 7.3KB | 1,460 | 6,810 | 小章 | ✅ |
| 8章 Incompatibilities | 3.8KB | 950 | 7.6KB | 1,520 | 6,220 | 小章 | ✅ |
| 9章 Complete Syntax | 3.8KB | 950 | 3.2KB | 640 | 5,340 | 小章 | ✅ |

※ 合計Tokens = EN Tokens + JA Tokens + GLOSSARY(1,750) + 固定部(2,000)

### 3章 The Language（サブ分割）

| 節 | EN Size | EN Tokens | JA Size | JA Tokens | 合計Tokens | 判定 |
|---|---------|-----------|---------|-----------|-----------|------|
| §3.1 Lexical Conventions | 7.0KB | 1,750 | 8.2KB | 1,640 | 7,140 | ✅ |
| §3.2 Variables | 1.3KB | 325 | 1.8KB | 360 | 4,435 | ✅ |
| §3.3 Statements | 16.1KB | 4,025 | 17.0KB | 3,400 | 11,175 | ✅ |
| §3.4 Expressions | 27.3KB | 6,825 | 30.3KB | 6,060 | 16,635 | ✅ |

### 4章 C API（サブ分割）

| 節 | EN Size | EN Tokens | JA Size | JA Tokens | 合計Tokens | 判定 |
|---|---------|-----------|---------|-----------|-----------|------|
| §4.1 The Stack | 6.3KB | 1,575 | 8.1KB | 1,620 | 6,945 | ✅ |
| §4.2 C Closures | 1.1KB | 275 | 1.4KB | 280 | 4,305 | ✅ |
| §4.3 Registry | 1.7KB | 425 | 2.2KB | 440 | 4,615 | ✅ |
| §4.4 Error Handling in C | 3.5KB | 875 | 4.2KB | 840 | 5,465 | ✅ |
| §4.5 Handling Yields in C | 5.8KB | 1,450 | 6.8KB | 1,360 | 6,560 | ✅ |
| §4.6 Functions and Types | 78.3KB | 19,575 | 87.5KB | 17,500 | 40,825 | ⚠️ |
| §4.7 The Debug Interface | 17.3KB | 4,325 | 20.3KB | 4,060 | 12,135 | ✅ |

**注意**: §4.6は約40k tokensで制限内だが、大きい。中章方式（用語抽出リストのみ）で対応可能。

### 6章 Standard Libraries（サブ分割）

| 節 | EN Size | EN Tokens | JA Size | JA Tokens | 合計Tokens | 判定 |
|---|---------|-----------|---------|-----------|-----------|------|
| §6.1 Loading Libraries in C | 2.8KB | 700 | - | 0 | 4,450 | ✅ 5.5のみ |
| §6.2 Basic Functions | 16.3KB | 4,075 | 19.3KB | 3,860 | 11,685 | ✅ |
| §6.3 Coroutine Manipulation | 4.0KB | 1,000 | 4.7KB | 940 | 5,690 | ✅ |
| §6.4 Modules | 12.5KB | 3,125 | 16.0KB | 3,200 | 10,075 | ✅ |
| §6.5 String Manipulation | 25.4KB | 6,350 | 30.5KB | 6,100 | 16,200 | ✅ |
| §6.6 UTF-8 Support | 4.3KB | 1,075 | 5.0KB | 1,000 | 5,825 | ✅ |
| §6.7 Table Manipulation | 4.9KB | 1,225 | 5.1KB | 1,020 | 5,995 | ✅ |
| §6.8 Mathematical Functions | 7.7KB | 1,925 | 8.0KB | 1,600 | 7,275 | ✅ |
| §6.9 Input and Output | 10.8KB | 2,700 | 13.3KB | 2,660 | 9,110 | ✅ |
| §6.10 Operating System | 8.1KB | 2,025 | 9.9KB | 1,980 | 7,755 | ✅ |
| §6.11 Debug Library | 10.6KB | 2,650 | 12.8KB | 2,560 | 8,960 | ✅ |

---

## サマリー

| カテゴリ | ファイル数 | 最大Tokens | 判定 |
|---------|----------|-----------|------|
| 小章（<10KB） | 12 | 7,140 | ✅ 余裕あり |
| 中章（10-40KB） | 14 | 23,275 | ✅ 余裕あり |
| 大章（>40KB） | 1 (§4.6) | 40,825 | ⚠️ 制限内だが注意 |

### 結論

**全ファイルが100k tokens制限内に収まる** ✅

- 最大: §4.6 Functions and Types（約40.8k tokens）
- 制限: 100k tokens/call
- マージン: 約59k tokens

### 翻訳方式決定

| 章/節 | 方式 | EN全文 | JA参考 |
|------|------|--------|--------|
| 1章, 7章, 8章, 9章 | 小章 | ✅ | ✅ 全文 |
| 2章, 5章 | 中章 | ✅ | 用語抽出リストのみ |
| §3.1-3.4 | 小章 | ✅ | ✅ 全文 |
| §4.1-4.5, 4.7 | 小章 | ✅ | ✅ 全文 |
| §4.6 | 中章 | ✅ | 用語抽出リストのみ |
| §6.1 | 小章 | ✅ | なし（5.5新設） |
| §6.2-6.11 | 小章/中章 | ✅ | ✅ 全文 or 用語リスト |

---

## 次のステップ

1. **タスク4.1**: 1章翻訳開始（小章方式）
2. 各章翻訳完了後、GLOSSARY.mdに新規用語追加
3. Phase 2で用語統一レビュー実施
