<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Lua 5.5 Reference Manual - Chapter 07</title>
</head>
<body>
<h1>7 &ndash; <a name="7">Lua Standalone</a></h1>

<p>
Although Lua has been designed as an extension language,
to be embedded in a host C&nbsp;program,
it is also frequently used as a standalone language.
An interpreter for Lua as a standalone language,
called simply <code>lua</code>,
is provided with the standard distribution.
The standalone interpreter includes
all standard libraries.
Its usage is:

<pre>
     lua [options] [script [args]]
</pre><p>
The options are:

<ul>
<li><b><code>-e <em>stat</em></code></b>:  execute string <em>stat</em>;</li>
<li><b><code>-i</code></b>:  enter interactive mode after running <em>script</em>;</li>
<li><b><code>-l <em>mod</em></code></b>:  "require" <em>mod</em> and assign the
  result to global <em>mod</em>;</li>
<li><b><code>-l <em>g=mod</em></code></b>:  "require" <em>mod</em> and assign the
  result to global <em>g</em>;</li>
<li><b><code>-v</code></b>:  print version information;</li>
<li><b><code>-E</code></b>:  ignore environment variables;</li>
<li><b><code>-W</code></b>:  turn warnings on;</li>
<li><b><code>--</code></b>:  stop handling options;</li>
<li><b><code>-</code></b>:  execute <code>stdin</code> as a file and stop handling options.</li>
</ul>

<p>
After handling its options, <code>lua</code> runs the given <em>script</em>.
When called without arguments,
<code>lua</code> behaves as <code>lua -v -i</code>
when the standard input (<code>stdin</code>) is a terminal,
and as <code>lua -</code> otherwise.


<p>
When called without the option <code>-E</code>,
the interpreter checks for an environment variable <a name="pdf-LUA_INIT_5_5"><code>LUA_INIT_5_5</code></a>
(or <a name="pdf-LUA_INIT"><code>LUA_INIT</code></a> if the versioned name is not defined)
before running any argument.
If the variable content has the format <code>@<em>filename</em></code>,
then <code>lua</code> executes the file.
Otherwise, <code>lua</code> executes the string itself.


<p>
When called with the option <code>-E</code>,
Lua does not consult any environment variables.
In particular,
the values of <a href="#pdf-package.path"><code>package.path</code></a> and <a href="#pdf-package.cpath"><code>package.cpath</code></a>
are set with the default paths defined in <code>luaconf.h</code>.
To signal to the libraries that this option is on,
the stand-alone interpreter sets the field
<code>"LUA_NOENV"</code> in the registry to a true value.
Other libraries may consult this field for the same purpose.


<p>
The options <code>-e</code>, <code>-l</code>, and <code>-W</code> are handled in
the order they appear.
For instance, an invocation like

<pre>
     $ lua -e 'a=1' -llib1 script.lua
</pre><p>
will first set <code>a</code> to 1, then require the library <code>lib1</code>,
and finally run the file <code>script.lua</code> with no arguments.
(Here <code>$</code> is the shell prompt. Your prompt may be different.)


<p>
Before running any code,
<code>lua</code> collects all command-line arguments
in a global table called <code>arg</code>.
The script name goes to index 0,
the first argument after the script name goes to index 1,
and so on.
Any arguments before the script name
(that is, the interpreter name plus its options)
go to negative indices.
For instance, in the call

<pre>
     $ lua -la b.lua t1 t2
</pre><p>
the table is like this:

<pre>
     arg = { [-2] = "lua", [-1] = "-la",
             [0] = "b.lua",
             [1] = "t1", [2] = "t2" }
</pre><p>
If there is no script in the call,
the interpreter name goes to index 0,
followed by the other arguments.
For instance, the call

<pre>
     $ lua -e "print(arg[1])"
</pre><p>
will print "<code>-e</code>".
If there is a script,
the script is called with arguments
<code>arg[1]</code>, &middot;&middot;&middot;, <code>arg[#arg]</code>.
Like all chunks in Lua,
the script is compiled as a variadic function.


<p>
In interactive mode,
Lua repeatedly prompts and waits for a line.
After reading a line,
Lua first tries to interpret the line as an expression.
If it succeeds, it prints its value.
Otherwise, it interprets the line as a chunk.
If you write an incomplete chunk,
the interpreter waits for its completion
by issuing a different prompt.


<p>
Note that, as each complete line is read as a new chunk,
local variables do not outlive lines.
To steer clear of confusion,
the interpreter gives a warning if a line starts with the
reserved word <b>local</b>:

<pre>
     &gt; x = 20      -- global 'x'
     &gt; local x = 10; print(x)
         --&gt; warning: locals do not survive across lines in interactive mode
         --&gt; 10
     &gt; print(x)     -- back to global 'x'
         --&gt; 20
     &gt; do       -- incomplete chunk
     &gt;&gt; local x = 10; print(x)    -- '&gt;&gt;' prompts for line completion
     &gt;&gt; print(x)
     &gt;&gt; end     -- chunk completed
        --&gt; 10
        --&gt; 10
</pre>

<p>
If the global variable <a name="pdf-_PROMPT"><code>_PROMPT</code></a> contains a string,
then its value is used as the prompt.
Similarly, if the global variable <a name="pdf-_PROMPT2"><code>_PROMPT2</code></a> contains a string,
its value is used as the secondary prompt
(issued during incomplete statements).


<p>
In case of unprotected errors in the script,
the interpreter reports the error to the standard error stream.
If the error object is not a string but
has a metamethod <code>__tostring</code>,
the interpreter calls this metamethod to produce the final message.
Otherwise, the interpreter converts the error object to a string
and adds a stack traceback to it.
When warnings are on,
they are simply printed in the standard error output.


<p>
When finishing normally,
the interpreter closes its main Lua state
(see <a href="#lua_close"><code>lua_close</code></a>).
The script can avoid this step by
calling <a href="#pdf-os.exit"><code>os.exit</code></a> to terminate.


<p>
To allow the use of Lua as a
script interpreter in Unix systems,
Lua skips the first line of a file chunk if it starts with <code>#</code>.
Therefore, Lua scripts can be made into executable programs
by using <code>chmod +x</code> and the&nbsp;<code>#!</code> form,
as in

<pre>
     #!/usr/local/bin/lua
</pre><p>
Of course,
the location of the Lua interpreter may be different in your machine.
If <code>lua</code> is in your <code>PATH</code>,
then

<pre>
     #!/usr/bin/env lua
</pre><p>
is a more portable solution.




</body>
</html>
