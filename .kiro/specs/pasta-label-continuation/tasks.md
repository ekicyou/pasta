# pasta-label-continuation 作業項目と議題進行

## フェーズ: 要件定義（承認前）

本仕様に関する修正点・疑問点・不安点を収拾し、議題を1つずつクローズしていきます。各議題クローズ時に本書を更新し、不要になった要件の集約・削除提案や次議題の提示を併記します。

---

## 自明な修正（要件ドキュメント側）
- 現時点で自明な修正は不要（EARS準拠、継続コンテキスト、先頭省略エラーが網羅済み）。設計以降で文法拡張の詳細化を行う。

---

## 議題1: 無名「＊」の解決レイヤー
- **論点**: パース層だけで直近グローバルシーン名の継続を扱うか、トランスパイラ層で扱うか。
- **結論（クローズ）**: パース層で解決する方針に合意。
- **理由**:
  - 無名「＊」は同一ファイル内の構文糖衣であり、構文正規化（AST確定）時に解決するのが最適。
  - エラー（ファイル先頭での省略）を行番号つきで報告でき、後段は既存の重複シーン登録（連番付与）を自然に再利用可能。
- **要件影響**: 既存要件（継続解決、先頭省略エラー、明示名でコンテキスト更新）は妥当。要件の削除・集約は不要。
- **次に反映すべき設計方針**（参考）:
  - 文法: `global_label_marker ~ (label_name?)` を許容（設計フェーズで具体化）。
  - パース: ファイル内コンテキストを保持し、無名時に直近名を補完。最初の無名は `ParseError`。

---

## 次の議題（要確認事項の提示）

### 議題2: 無名「＊」行の許容フォーマット（クローズ）
- **結論**: 行末の空白のみ許容、コメント併記は構文エラー。
- **根拠（DSL確認）**: `src/parser/pasta.pest` では `comment_line = WHITESPACE* ~ ("＃" | "#") ~ ...` により、行頭（空白後）に限りコメント行を認識。インライン（途中以降）の `#` はコメントとして解釈されない。
- **要件反映**: requirements.md に「フォーマット制約」の受入基準を追加済み（無名行は空白のみ許容、コメント不可／行頭コメントのみ有効）。
- **影響**: 実装時は無名「＊」パース時に行内コメントを拒否する（設計フェーズで文法オプション化する場合は別途検討）。

### 議題3: エラー文言の定型
- **論点**: 先頭無名「＊」に対するエラーの文言定型を仕様に明記するか。
- **提案**: 例）「最初のグローバルシーンでシーン名が省略されています。直前のグローバルシーンが存在しません。」（行・列番号併記）。
- **要件修正の必要性**: 表現の明文化を追加可能（機能要件の範囲内）。

---

## レビュー観点（合意が必要な点）
- 議題3のエラー文言定型の明文化の要否

---

## 変更履歴（このドキュメント）
- 2025-12-21: 初版作成。議題1クローズを記録、議題2/3を提示。
