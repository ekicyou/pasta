# Implementation Gap Analysis

**Feature**: documentation-consolidation  
**Date**: 2026-01-22  
**Phase**: Requirements Generated

---

## Executive Summary

本ギャップ分析は、散在するドキュメントの統合・整理に向けた実装戦略を評価します。

**主な発見**:
- ✅ **既存資産**: pasta_lua/README.md が作成済み（最新、詳細、包括的）
- ⚠️ **欠落資産**: pasta_core, pasta_shiori の README.md が未作成
- ⚠️ **構造的課題**: GRAMMAR.md と SPECIFICATION.md の重複、AGENTS.md とステアリングの関係が曖昧
- ✅ **堅牢なステアリング**: `.kiro/steering/` は5ファイルで構造化済み

**推奨アプローチ**: **Option B (新規作成中心)** + **Option A (既存改善)**のハイブリッド

**リスク**: Low - ドキュメント作業であり、既存パターンが明確

---

## 1. Current State Investigation

### 1.1 既存ドキュメント資産

#### ルートレベル (4ファイル)

| ファイル           | 行数  | 対象読者     | 主要トピック                         | 状態       |
| ------------------ | ----- | ------------ | ------------------------------------ | ---------- |
| `README.md`        | ~100  | 開発者全般   | アーキテクチャ概要、パーサー移行履歴 | ⚠️ 要改善   |
| `AGENTS.md`        | ~100  | AI開発ツール | Kiro仕様駆動開発、ワークフロー       | ⚠️ 要改善   |
| `GRAMMAR.md`       | 634   | DSLユーザー  | Pasta DSL文法リファレンス            | ⚠️ 重複あり |
| `SPECIFICATION.md` | 1,273 | 実装者       | 正式言語仕様（権威的）               | ✅ 良好     |

**問題点**:
- `README.md`: ドキュメントマップなし、クイックスタートなし
- `AGENTS.md`: ステアリングとの関係が曖昧、セクション構成が簡素
- `GRAMMAR.md`: SPECIFICATION.md との重複（特に基本構文セクション）

#### ステアリング (.kiro/steering/ - 5ファイル)

| ファイル       | 行数 | 責務                         | 状態   |
| -------------- | ---- | ---------------------------- | ------ |
| `product.md`   | ~80  | ビジョン、フェーズ、優先順位 | ✅ 良好 |
| `tech.md`      | 131  | 技術スタック、依存関係       | ✅ 良好 |
| `structure.md` | 195  | ディレクトリ構造、命名規則   | ✅ 良好 |
| `grammar.md`   | 102  | DSL文法要約、仕様参照        | ✅ 良好 |
| `workflow.md`  | ~100 | 開発ワークフロー、DoD        | ✅ 良好 |

**状態**: 堅牢、責務分離が明確、重複最小

#### クレート別 README (1/3存在)

| クレート       | README存在 | 状態     | 備考                               |
| -------------- | ---------- | -------- | ---------------------------------- |
| `pasta_core`   | ❌          | **欠落** | パーサー・レジストリの中核クレート |
| `pasta_lua`    | ✅          | **優秀** | 276行、詳細なディレクトリ構成含む  |
| `pasta_shiori` | ❌          | **欠落** | SHIORI DLL統合                     |

**pasta_lua/README.md の特徴**:
- ✅ ディレクトリ構成の詳細な説明
- ✅ 設定ファイル（pasta.toml）の完全なドキュメント
- ✅ 使用例とコードサンプル
- ✅ 組み込みモジュール一覧
- → **テンプレートとして活用可能**

#### その他のドキュメント

| カテゴリ               | ファイル数 | 例                                      | 備考         |
| ---------------------- | ---------- | --------------------------------------- | ------------ |
| 仕様完了アーカイブ     | ~100+      | `.kiro/specs/completed/*/*.md`          | 保守対象外   |
| プロンプトテンプレート | ~10        | `.github/prompts/*.prompt.md`           | 開発ツール用 |
| テストフィクスチャ     | 1          | `tests/fixtures/README.md`              | 良好         |
| 内部ドキュメント       | 3          | `crates/pasta_lua/scripts/README.md` 等 | 簡素         |

### 1.2 ドキュメント相互参照状況

**クロスリファレンス分析**（`grep "SPECIFICATION.md\|README.md\|GRAMMAR.md"` による）:

| From → To                         | 参照数 | 状態                   |
| --------------------------------- | ------ | ---------------------- |
| GRAMMAR.md → SPECIFICATION.md     | ✅ 1    | トップに権威的参照あり |
| README.md → GRAMMAR.md            | ❌ 0    | **欠落**               |
| README.md → SPECIFICATION.md      | ❌ 0    | **欠落**               |
| AGENTS.md → steering/*            | ❌ 暗黙 | **明示的リンクなし**   |
| pasta_lua/README.md → root README | ❌ 0    | **バックリンク欠落**   |

**孤立ドキュメント**（他から参照されていない）:
- `benches/PERFORMANCE_DELETED.md` - アーカイブ扱い
- `crates/pasta_shiori/src/util/shiori.md` - 内部仕様書（問題なし）
- `crates/pasta_lua/scriptlibs/README.md` - 内部ドキュメント
- `crates/pasta_lua/scripts/README.md` - 内部ドキュメント

### 1.3 アーキテクチャパターン・規約

**ドキュメント構造規約**（既存パターンから抽出）:

1. **セクション構成**（pasta_lua/README.md パターン）:
   ```markdown
   # クレート名
   概要
   ## 概要
   ## アーキテクチャ
   ## ディレクトリ構成
   ## 設定ファイル
   ## 使用方法
   ## 関連クレート
   ```

2. **ステアリングファイル構成**:
   - Markdown見出し階層（## → ###）
   - テーブル形式の情報整理
   - コードブロック使用（```で囲む）

3. **命名規則**:
   - README.md: 全て大文字
   - その他: ハイフン区切り小文字（例: `gap-analysis.md`）

---

## 2. Requirements Feasibility Analysis

### 2.1 技術的ニーズ vs 既存資産

| 要求                      | 必要な資産                    | 既存状況              | ギャップ             |
| ------------------------- | ----------------------------- | --------------------- | -------------------- |
| Req 1: インベントリ       | 全`.md`ファイルリスト         | ✅ file_search可能     | None                 |
| Req 2: 階層構造           | ドキュメント構造定義          | ⚠️ 暗黙的              | **明示的定義が必要** |
| Req 3: ルート整理         | README, AGENTS, GRAMMAR, SPEC | ✅ 全て存在            | **内容改善必要**     |
| Req 4: クレートREADME     | pasta_core, pasta_shiori      | ❌ 欠落                | **新規作成必要**     |
| Req 5: ステアリング最適化 | 5ファイル構造                 | ✅ 良好                | **微調整のみ**       |
| Req 6: 相互参照           | クロスリンク                  | ❌ 不十分              | **リンク追加必要**   |
| Req 7: オンボーディング   | 学習パス定義                  | ❌ なし                | **新規作成必要**     |
| Req 8: 保守ガイドライン   | 更新ルール                    | ⚠️ workflow.mdに部分的 | **拡充必要**         |

### 2.2 制約と未知数

**制約**:
1. **SPECIFICATION.md の権威性**: 変更不可、参照のみ
2. **完了仕様アーカイブ**: `.kiro/specs/completed/` は保守対象外（Out of Scope）
3. **言語**: 日本語のみ（多言語対応は Out of Scope）

**未知数** (Research Needed):
- ❓ `README.md` の理想的な長さ（詳細 vs 簡潔のバランス）
- ❓ `AGENTS.md` とステアリングの役割分担の最適解
- → **設計フェーズで決定**

### 2.3 複雑性シグナル

| 側面             | 複雑性       | 理由                           |
| ---------------- | ------------ | ------------------------------ |
| データモデル     | **単純**     | マークダウンファイルのみ       |
| ビジネスロジック | **なし**     | ドキュメント編集作業           |
| 外部統合         | **なし**     | 外部システム連携なし           |
| ワークフロー     | **シンプル** | ファイル作成・編集・リンク追加 |

**評価**: シンプルなCRUD的作業（Create/Read/Update/Delete ドキュメント）

---

## 3. Implementation Approach Options

### Option A: 既存ドキュメント改善中心

**対象**:
- README.md の拡充（ドキュメントマップ、オンボーディングパス追加）
- AGENTS.md の再構成（ステアリング関係明示）
- GRAMMAR.md の重複削減（SPECIFICATION.md 参照強化）
- ステアリングファイルの微調整

**どのファイルを編集するか**:
| ファイル      | 変更内容                                                   | 影響度 |
| ------------- | ---------------------------------------------------------- | ------ |
| README.md     | ドキュメントマップセクション追加、オンボーディングパス追加 | Medium |
| AGENTS.md     | ステアリング参照セクション追加、構造再編                   | Medium |
| GRAMMAR.md    | 重複セクション削除、SPECIFICATION.md参照強化               | Low    |
| steering/*.md | AGENTS.md からの参照追記                                   | Low    |

**互換性評価**:
- ✅ 既存リンク維持（パス変更なし）
- ✅ 後方互換性保証（既存参照者への影響なし）
- ⚠️ GRAMMAR.md 削減時、削除セクションへのリンクが壊れる可能性（要確認）

**複雑性と保守性**:
- ✅ 既存ファイルサイズ増加は許容範囲内
- ✅ 単一責任原則維持（各ファイルの責務変わらず）
- ✅ 認知負荷低（慣れ親しんだファイル）

**Trade-offs**:
- ✅ 最小限の変更で効果的
- ✅ 既存参照者への影響小
- ✅ レビュー負担軽減
- ❌ クレートREADME欠落は解決不可
- ❌ 根本的な構造改善には不十分

**適用シーン**: Req 3, 5, 6 の一部

---

### Option B: 新規ドキュメント作成中心

**対象**:
- `pasta_core/README.md` の新規作成
- `pasta_shiori/README.md` の新規作成
- オンボーディングパス専用ドキュメント（または README.md の新セクション）
- ドキュメント保守ガイドライン（または workflow.md 拡充）

**新規作成の根拠**:
1. **pasta_core/README.md**: 中核クレートであり、独立したドキュメントが必須
2. **pasta_shiori/README.md**: SHIORI統合は複雑な領域、専用ドキュメントで解説
3. **オンボーディングパス**: README.md に含めるとサイズ肥大化、分離が望ましい（設計で判断）

**統合ポイント**:
| 新規ドキュメント       | 統合先               | インターフェース                 |
| ---------------------- | -------------------- | -------------------------------- |
| pasta_core/README.md   | ルートREADME         | 「クレート」セクションからリンク |
| pasta_shiori/README.md | ルートREADME         | 「クレート」セクションからリンク |
| オンボーディングパス   | README.md または独立 | ルートREADMEから参照             |

**責務境界**:
- **pasta_core/README.md**: パーサー・レジストリのAPI、使用例、内部構造
- **pasta_shiori/README.md**: SHIORI DLL統合、プロトコル概要、Lua連携
- **オンボーディングパス**: 学習経路、推奨読書順、開発環境セットアップ

**Trade-offs**:
- ✅ クレートREADME網羅率100%達成
- ✅ 責務分離明確
- ✅ pasta_lua/README.md をテンプレート活用可能
- ❌ ファイル数増加（ナビゲーション複雑化の可能性）
- ❌ 初期作成コスト高

**適用シーン**: Req 4, 7 の主要部分

---

### Option C: ハイブリッドアプローチ（推奨）

**組み合わせ戦略**:

| フェーズ | アクション             | Option     | 対象要求 |
| -------- | ---------------------- | ---------- | -------- |
| Phase 1  | クレートREADME新規作成 | B          | Req 4    |
| Phase 2  | ルートREADME拡充       | A          | Req 3, 7 |
| Phase 3  | AGENTS.md 再構成       | A          | Req 3, 5 |
| Phase 4  | 相互参照整備           | A          | Req 6    |
| Phase 5  | 保守ガイドライン作成   | B または A | Req 8    |

**段階的実装**:

**Phase 1: クレートREADME作成** (Req 4)
- `pasta_core/README.md` 作成（pasta_lua/README.md をテンプレート）
- `pasta_shiori/README.md` 作成
- ルートREADMEから各クレートREADMEへのリンク追加

**Phase 2: ルートREADME拡充** (Req 3, 7)
- ドキュメントマップセクション追加
- オンボーディングパス（ユーザー/開発者/AI向け）追加
- クイックスタート追加

**Phase 3: AGENTS.md 再構成** (Req 3, 5)
- ステアリング参照セクション明示
- Kiro仕様駆動開発ワークフローの詳細化
- steering/*.md との相互リンク

**Phase 4: 相互参照整備** (Req 6)
- 全ドキュメントのクロスリファレンス追加
- 孤立ドキュメント解消（内部ドキュメントを除く）
- GRAMMAR.md → SPECIFICATION.md 参照強化

**Phase 5: 保守ガイドライン** (Req 8)
- workflow.md に「ドキュメント更新チェックリスト」セクション追加、または
- 新規 `docs/MAINTENANCE.md` 作成（設計で判断）

**リスク軽減**:
- ✅ フェーズ毎に検証可能（段階的レビュー）
- ✅ Phase 1完了時点で Req 4 達成（早期価値提供）
- ✅ 各フェーズが独立（並行作業可能）

**Trade-offs**:
- ✅ バランスの取れたアプローチ
- ✅ 段階的な品質向上
- ✅ リスク分散
- ❌ 全フェーズ完了までの期間長い
- ❌ 複数フェーズ管理の複雑性

**適用シーン**: 全要求 (Req 1-8)

---

## 4. Out-of-Scope for Gap Analysis

**設計フェーズに繰り越す調査事項**:
- ❓ オンボーディングパスを README.md 内に含めるか、独立ファイルにするか
- ❓ 保守ガイドラインを workflow.md に統合するか、独立ファイルにするか
- ❓ GRAMMAR.md の具体的な削減範囲（どのセクションを残すか）

---

## 5. Implementation Complexity & Risk

### 5.1 工数見積もり

| フェーズ | タスク数 | 見積もり      | 根拠                                 |
| -------- | -------- | ------------- | ------------------------------------ |
| Phase 1  | 3        | **S (1-2日)** | pasta_lua/README.md テンプレート活用 |
| Phase 2  | 3        | **S (1-2日)** | 既存セクション拡充                   |
| Phase 3  | 2        | **S (1日)**   | 既存ファイル再構成                   |
| Phase 4  | 5        | **M (2-3日)** | 全ドキュメント走査・リンク追加       |
| Phase 5  | 1        | **S (半日)**  | チェックリスト作成                   |
| **合計** | **14**   | **M (3-7日)** | 段階的実装、並行作業可能             |

**S (1-3日)** の理由:
- 既存パターン明確（pasta_lua/README.md）
- ドキュメント作業（コード変更なし）
- 外部依存なし

### 5.2 リスク評価

| リスク種別           | レベル     | 理由                                               |
| -------------------- | ---------- | -------------------------------------------------- |
| **技術的リスク**     | **Low**    | マークダウン編集のみ、技術的複雑性なし             |
| **統合リスク**       | **Low**    | ファイル追加・編集のみ、既存コード影響なし         |
| **スコープクリープ** | **Medium** | ドキュメント改善の範囲が拡大しやすい（要境界管理） |
| **品質リスク**       | **Low**    | レビュー容易、テスト不要                           |

**総合リスク**: **Low**

リスク軽減策:
- ✅ 段階的フェーズでスコープ管理
- ✅ 各フェーズ完了時にレビュー
- ✅ Out of Scope を明示（Req Out of Scope 参照）

---

## 6. Recommendations for Design Phase

### 6.1 推奨アプローチ

**Option C (ハイブリッド)** を推奨します。

**理由**:
1. **即時価値**: Phase 1 でクレートREADME完備（Req 4 達成）
2. **段階的改善**: 各フェーズが独立、リスク分散
3. **既存資産活用**: pasta_lua/README.md がテンプレート
4. **スコープ管理**: フェーズ毎に境界明確

### 6.2 重要な設計判断

設計フェーズで決定すべき事項：

| #   | 判断事項                 | 選択肢                                   | 推奨                 |
| --- | ------------------------ | ---------------------------------------- | -------------------- |
| 1   | オンボーディングパス配置 | (A) README.md 内 vs (B) 独立ファイル     | (A) README.md 内     |
| 2   | 保守ガイドライン配置     | (A) workflow.md 拡充 vs (B) 独立ファイル | (A) workflow.md 拡充 |
| 3   | GRAMMAR.md 削減範囲      | 具体的なセクションリスト                 | 設計で詳細化         |

**推奨 (A)** の理由:
- ファイル数増加を抑制（ナビゲーション簡素化）
- README.md / workflow.md は既に確立されたエントリーポイント

### 6.3 設計フェーズで深掘りすべき領域

1. **ドキュメントマップ構造**:
   - 階層レベル（Level 0-3）の具体的な定義
   - 各レベルでのドキュメントリスト

2. **オンボーディングパス詳細**:
   - ユーザー/開発者/AI向けの具体的な読書順
   - 各パスの推定所要時間

3. **相互参照リンク一覧**:
   - 全ドキュメント間のリンク関係図
   - 孤立ドキュメント解消策

4. **保守チェックリスト**:
   - API変更時のドキュメント更新手順
   - 仕様変更とドキュメントの対応表

### 6.4 Research Items

**繰り越し調査項目**: なし

本ギャップ分析で全ての技術的不明点を解消しました。

---

## 7. Conclusion

**実装可能性**: ✅ **High** - 全要求は既存パターンと資産を活用して実装可能

**推奨戦略**: Option C (ハイブリッド) による段階的実装

**次のステップ**: 設計フェーズで「6.2 重要な設計判断」の決定と、各フェーズの詳細タスク定義

**成功の鍵**:
1. pasta_lua/README.md をテンプレートとして活用
2. 段階的フェーズ実装でリスク管理
3. Out of Scope の厳守（スコープクリープ防止）
