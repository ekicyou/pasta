# LLM参照を禁じる。このドキュメントは人間用です。LLMは参考にせず、書き込みも禁止

## 要件定義分析後の質問（保存用テンプレート）

要件定義及びギャップ分析レポートを踏まえて、修正点・疑問点・不安点などを作業として収拾せよ。自明な指摘は修正してコミット。設計判断となる項目は設計判断とする。最後に、開発者への確認が少しでも必要な項目については、1 議題ずつディスカッションを進行せよ。議題が１つクローズするごとに更新しコミット、次の議題に移れ。更新するときは、これまでの議論で明らかになった点を書くとともに、不要になった要件の集約・削除なども行い、次の議題の提示前に修正内容の要約を報告してくださいね。すべての議題が終了したら、次のコマンドを教えて。なお、MEMO.mdはLLM参照・変更禁止。

## 設計分析後の質問

設計及び設計分析レポートを踏まえて、修正点・疑問点・不安点などを作業として収拾せよ。自明な修正点は修正してコミット。開発者への確認が少しでも必要な項目については、1 議題ずつディスカッションを進行せよ。議題が１つクローズするごとに更新しコミット、次の議題に移れ。更新するときは、これまでの議論で明らかになった点を書くとともに、不要になった要件の集約・削除なども行い、次の議題の提示前に修正内容の要約を報告してくださいね。すべての議題が終了したら、次のコマンドを教えて。なお、MEMO.mdはLLM参照・変更禁止。

## 実装完了処理
ステアリング（workflow.md）を読み込んだら以下を実施。実装完了を承認します。完了フローを実施。お疲れ様でした！

# ACT_IMPL.callの本格実装

`act:call(SCENE.__global_name__, "グローバル単語呼び出し", {}, table.unpack(args))`などと、トランスパイルされる`ACT_IMPL.call()`メソッドについて、本格的な実装に置き換える。

## 基本

+ 入力引数
  + self(=act)
  + global_scene_name
  + key
  + attrs 属性テーブル
  + ... 可変長引数（handlerにそのまま渡す）
+ 処理
  + 検索処理により、関数ハンドラー`handler`を取得する。
  + handler == nilだったときは何もしない。（将来的にログを出す）
  + `return handler(act, ...)`として呼び出す。

## 検索処理

以下の優先順位で最初に見つけた有効な関数を結果とする。

1. `self.current_scene[key]`
2. `SCENE.search(key, global_scene_name, attrs)`
3. `requre("pasta.global")[key]`
4. `SCENE.search(key, nil, attrs)`

## 備考
入力引数`attrs`は現在は使用していないが、将来的に`SCENE.search(key, global_scene_name, attrs)`などとしてsearchの第三引数として使われる。



##