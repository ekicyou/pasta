(function(){define(["engine/aglio_dic","engine/olio_story_picker","engine/jsutil","jquery"],function(a,d){var b,c;c=(function(){function e(f){this.parent=f;this.picker=this.parent.picker;this.chain=void 0}e.prototype.start=function(f){return this.parent.start(f)};e.prototype.breakChain=function(){var f;if((f=this.chain)!=null){if(typeof f.reject==="function"){f.reject()}}return this.chain=void 0};e.prototype.起動=function(){return this.一般会話()};e.prototype.通常起動=function(){};e.prototype.初回起動=function(){};e.prototype.会話=function(){};e.prototype.一般会話=function(){var h,f,g;console.log("[PeperoncinoDispatcher::events::一般会話]");h=(f=this.chain)!=null?f.next():void 0;if(!(h!=null)){if((g=this.chain)!=null){if(typeof g.resolve==="function"){g.resolve()}}this.chain=this.picker.nextStory(["会話"]);console.log(["次の会話",this.chain]);h=this.chain.next()}return this.start(h)};e.prototype.時刻00分=function(){};return e})();return b=(function(){function e(f){this.dic=f!=null?f:a;console.log("[PeperoncinoDispatcher::constructor]");this.order={};this.order.sys={dispTime:15*1000};this.picker=new d(this.dic,this.order);this.events=new c(this);try{this.events.起動()}catch(g){console.log(g)}}e.prototype.start=function(g){var f;if((f=this.nowSeq)!=null){if(typeof f.close==="function"){f.close()}}this.nowSeq=g;g.closeScrap();$.timeout(500).done(function(){return g.run()});g.playedPromise().always(function(){return console.log("再生終了")});g.closedPromise().always(function(){return console.log("表示終了")});return g};e.prototype.createSeq=function(h,f){var g;g=this.dic.createScrap(h,f);return this.picker.createSeq(g)};e.prototype.played=function(g){var f;if((f=this.nowSeq)!=null){if(typeof f.played==="function"){f.played(g)}}};e.prototype.close=function(g){var f;if(((f=this.nowSeq)!=null?f.close:void 0)!=null){this.nowSeq.close(g);this.nowSeq=void 0}};e.prototype.breakChain=function(){return this.events.breakChain()};e.prototype.setNextSpanAction=function(h){var g,i,j,k,l,m,n,o,f=this;l=new Date;m=l/1000;g=l/this.spanMS|0;j=(g+1)*this.spanMS;k=j/1000;o=(k-m)*1000;n=o/this.spanMS;if(n<0.8){j=(g+2)*this.spanMS}i=new Date(j);if(typeof console!=="undefined"&&console!==null){console.log("now  :",l)}if(typeof console!=="undefined"&&console!==null){console.log("next :",i)}this.nextSpanDisposable.disposable=Rx.Observable.timer(i-l).subscribe(function(p){f.nextSpanDisposable.disposable=void 0;if(typeof console!=="undefined"&&console!==null){console.log("今！ :",new Date)}return h(p)})};e.prototype.actNextSpan=function(f){if(typeof console!=="undefined"&&console!==null){console.log("[PeperoncinoDispatcher::actNextSpan] ",f)}};e.prototype.touch=function(h){var f,g;console.log("タッチ検出！",[h]);if(((f=this.nowSeq)!=null?typeof f.state==="function"?f.state():void 0:void 0)==="played"){this.close();this.events.起動()}else{if(((g=this.nowSeq)!=null?typeof g.state==="function"?g.state():void 0:void 0)==="play"){this.played()}else{this.events.起動()}}};return e})()})}).call(this);