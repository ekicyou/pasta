(function(){define(["engine/aglio_dic","engine/puttanesca_sequencer","engine/jsutil"],function(a,e){var d,b,c;
c=function(f){return typeof f==="function"
};
b=function(f){return Object.prototype.toString.call(f)==="[object Array]"
};
d=(function(){function f(g,h){this.dic=g!=null?g:a;
this.essence=h!=null?h:{};
this.nowStoryThis=void 0
}f.prototype.nextStory=function(i,h){var g;
if(h==null){h=e
}g=this.dic.selectScrap(i);
if(!g){console.log("[OlioStoryPicker::nextStory] キーワードが見つかりませんでした。",i);
return void 0
}return this.createSeq(g,h)
};
f.prototype.createSeq=function(h,i){var j,g=this;
if(i==null){i=e
}j=$.Deferred();
j.sequencerConstructor=i;
j.sequencer=void 0;
j.essence=this.essence;
j.scrap=h;
j.next=function(){return g.nextScrap(j)
};
j.isClose=false;
j.Z=function(){return this.isClose=true
};
j.close=function(){return this.Z()
};
j.isSeparate=false;
j.Y=function(){return this.isSeparate=true
};
j.separate=function(){return this.Y()
};
j.S=function(k){return j.sequencer.section(k)
};
j.section=function(k){return this.S(k)
};
j.P=function(k){return j.sequencer.period(k)
};
j.period=function(k){return this.P(k)
};
j.E=function(k){return j.sequencer.emote(k)
};
j.emote=function(k){return this.E(k)
};
j.B=function(){return j.sequencer.br()
};
j.br=function(){return this.B()
};
j.T=function(k){return j.sequencer.talk(k)
};
j.talk=function(k){return this.T(k)
};
j.jumpTags=void 0;
j.J=function(k){return j.jumpTags=k
};
j.jump=function(k){return this.J(k)
};
j.W=function(k){return g.popWord(k)
};
j.popWord=function(k){return this.W(k)
};
j.callScrap=function(){j.isSeparate=false;
while(j.scrap!=null){j.jumpTags=void 0;
j.scrap.callback.call(j,j.essence);
j.scrap=j.isClose?void 0:j.jumpTags!=null?g.dic.selectScrap(j.jumpTags):j.scrap.next();
if(j.isSeparate===true){return
}}};
j.always(function(){var k;
if((k=j.sequencer)!=null){k.close()
}});
return this.nowStoryThis=j
};
f.prototype.nextScrap=function(h){var g;
if(h==null){h=this.nowStoryThis
}if((g=h.sequencer)!=null){if(typeof g.close==="function"){g.close()
}}h.sequencer=void 0;
if((h!=null?h.scrap:void 0)!=null){h.sequencer=new h.sequencerConstructor();
h.callScrap();
return h.sequencer
}else{h.resolve();
if(h===this.nowStoryThis){this.nowStoryThis=void 0
}return void 0
}};
f.prototype.jump=function(g){return console.log("ジャンプ:",g)
};
f.prototype.popWord=function(g){return console.log("単語取得:",g)
};
return f
})();
return d
})
}).call(this);